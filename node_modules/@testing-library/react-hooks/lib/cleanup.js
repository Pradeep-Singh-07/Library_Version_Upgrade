"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cleanup = cleanup;
exports.addCleanup = addCleanup;
exports.removeCleanup = removeCleanup;

var _flushMicrotasks = _interopRequireDefault(require("./flush-microtasks"));

let cleanupCallbacks = [];

async function cleanup() {
  await (0, _flushMicrotasks.default)();

  for (const callback of cleanupCallbacks) {
    await callback();
  }

  cleanupCallbacks = [];
}

function addCleanup(callback) {
  cleanupCallbacks.unshift(callback);
  return () => removeCleanup(callback);
}

function removeCleanup(callback) {
  cleanupCallbacks = cleanupCallbacks.filter(cb => cb !== callback);
}