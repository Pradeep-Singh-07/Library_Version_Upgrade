!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jabra={})}(this,(function(e){"use strict";var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},t(e,n)};function n(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function a(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function c(e){return this instanceof c?(this.v=e,this):new c(e)}function u(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof c?Promise.resolve(n.value.v).then(u,l):h(o[0][2],n)}catch(e){h(o[0][3],e)}var n}function u(e){a("next",e)}function l(e){a("throw",e)}function h(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function l(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=o(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function h(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function d(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}function p(e){return"function"==typeof e}function f(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var v=f((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function g(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var E=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=o(c),l=u.next();!l.done;l=u.next()){l.value.remove(this)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else c.remove(this);var h=this.initialTeardown;if(p(h))try{h()}catch(e){i=e instanceof v?e.errors:[e]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=o(d),g=f.next();!g.done;g=f.next()){var E=g.value;try{b(E)}catch(e){i=null!=i?i:[],e instanceof v?i=a(a([],s(i)),s(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{g&&!g.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}}if(i)throw new v(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)b(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&g(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&g(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),y=E.EMPTY;function m(e){return e instanceof E||e&&"closed"in e&&p(e.remove)&&p(e.add)&&p(e.unsubscribe)}function b(e){p(e)?e():e.unsubscribe()}var w={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},_={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=_.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,a([e,t],s(n))):setTimeout.apply(void 0,a([e,t],s(n)))},clearTimeout:function(e){var t=_.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function T(e){_.setTimeout((function(){throw e}))}function O(){}var C=R("C",void 0,void 0);function R(e,t,n){return{kind:e,value:t,error:n}}function N(e){e()}var S=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,m(t)&&t.add(n)):n.destination=P,n}return n(t,e),t.create=function(e,t,n){return new D(e,t,n)},t.prototype.next=function(e){this.isStopped?U(function(e){return R("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?U(R("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?U(C,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(E),I=Function.prototype.bind;function A(e,t){return I.call(e,t)}var L=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){H(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){H(e)}else H(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){H(e)}},e}(),D=function(e){function t(t,n,r){var i,o,s=e.call(this)||this;p(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&w.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&A(t.next,o),error:t.error&&A(t.error,o),complete:t.complete&&A(t.complete,o)}):i=t;return s.destination=new L(i),s}return n(t,e),t}(S);function H(e){T(e)}function U(e,t){var n=w.onStoppedNotification;n&&_.setTimeout((function(){return n(e,t)}))}var P={closed:!0,next:O,error:function(e){throw e},complete:O},k="function"==typeof Symbol&&Symbol.observable||"@@observable";function x(e){return e}function F(e){return 0===e.length?x:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var G=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,i=this,o=(r=e)&&r instanceof S||function(e){return e&&p(e.next)&&p(e.error)&&p(e.complete)}(r)&&m(r)?e:new D(e,t,n);return N((function(){var e=i,t=e.operator,n=e.source;o.add(t?t.call(o,n):n?i._subscribe(o):i._trySubscribe(o))})),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=M(t))((function(t,r){var i=new D({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[k]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return F(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=M(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function M(e){var t;return null!==(t=null!=e?e:w.Promise)&&void 0!==t?t:Promise}function B(e){return function(t){if(function(e){return p(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function W(e,t,n,r,i){return new K(e,t,n,r,i)}var K=function(e){function t(t,n,r,i,o,s){var a=e.call(this,t)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return n(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(S),V=f((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Y=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n(t,e),t.prototype.lift=function(e){var t=new j(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new V},t.prototype.next=function(e){var t=this;N((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=o(t.currentObservers),s=i.next();!s.done;s=i.next()){s.value.next(e)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;N((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;N((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?y:(this.currentObservers=null,o.push(e),new E((function(){t.currentObservers=null,g(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new G;return e.source=this,e},t.create=function(e,t){return new j(e,t)},t}(G),j=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return n(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:y},t}(Y),q=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Y),z={now:function(){return(z.delegate||Date).now()},delegate:void 0},$=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=z);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return n(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,o=n._infiniteTimeWindow,s=n._timestampProvider,a=n._windowTime;r||(i.push(t),!o&&i.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,o=(i?1:2)*t;if(t<1/0&&o<r.length&&r.splice(0,r.length-o),!i){for(var s=n.now(),a=0,c=1;c<r.length&&r[c]<=s;c+=2)a=c;a&&r.splice(0,a+1)}},t}(Y),Q=function(e){function t(t,n){return e.call(this)||this}return n(t,e),t.prototype.schedule=function(e,t){return this},t}(E),X={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=X.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,a([e,t],s(n))):setInterval.apply(void 0,a([e,t],s(n)))},clearInterval:function(e){var t=X.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},J=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return n(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),X.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&X.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,g(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Q),Z=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=z.now,e}(),ee=new(function(e){function t(t,n){void 0===n&&(n=Z.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return n(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Z))(J),te=ee,ne=new G((function(e){return e.complete()}));function re(e){return e&&p(e.schedule)}function ie(e){return e[e.length-1]}function oe(e){return p(ie(e))?e.pop():void 0}function se(e){return re(ie(e))?e.pop():void 0}function ae(e,t){return"number"==typeof ie(e)?e.pop():t}var ce=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ue(e){return p(null==e?void 0:e.then)}function le(e){return p(e[k])}function he(e){return Symbol.asyncIterator&&p(null==e?void 0:e[Symbol.asyncIterator])}function de(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var pe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function fe(e){return p(null==e?void 0:e[pe])}function ve(e){return u(this,arguments,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,c(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,c(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,c(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function ge(e){return p(null==e?void 0:e.getReader)}function Ee(e){if(e instanceof G)return e;if(null!=e){if(le(e))return i=e,new G((function(e){var t=i[k]();if(p(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(ce(e))return r=e,new G((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(ue(e))return n=e,new G((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,T)}));if(he(e))return ye(e);if(fe(e))return t=e,new G((function(e){var n,r;try{for(var i=o(t),s=i.next();!s.done;s=i.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}));if(ge(e))return ye(ve(e))}var t,n,r,i;throw de(e)}function ye(e){return new G((function(t){(function(e,t){var n,o,s,a;return r(this,void 0,void 0,(function(){var r,c;return i(this,(function(i){switch(i.label){case 0:i.trys.push([0,5,6,11]),n=l(e),i.label=1;case 1:return[4,n.next()];case 2:if((o=i.sent()).done)return[3,4];if(r=o.value,t.next(r),t.closed)return[2];i.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=i.sent(),s={error:c},[3,11];case 6:return i.trys.push([6,,9,10]),o&&!o.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:i.sent(),i.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function me(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function be(e,t){return void 0===t&&(t=0),B((function(n,r){n.subscribe(W(r,(function(n){return me(r,e,(function(){return r.next(n)}),t)}),(function(){return me(r,e,(function(){return r.complete()}),t)}),(function(n){return me(r,e,(function(){return r.error(n)}),t)})))}))}function we(e,t){return void 0===t&&(t=0),B((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function _e(e,t){if(!e)throw new Error("Iterable cannot be null");return new G((function(n){me(n,t,(function(){var r=e[Symbol.asyncIterator]();me(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Te(e,t){if(null!=e){if(le(e))return function(e,t){return Ee(e).pipe(we(t),be(t))}(e,t);if(ce(e))return function(e,t){return new G((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(ue(e))return function(e,t){return Ee(e).pipe(we(t),be(t))}(e,t);if(he(e))return _e(e,t);if(fe(e))return function(e,t){return new G((function(n){var r;return me(n,t,(function(){r=e[pe](),me(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return p(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(ge(e))return function(e,t){return _e(ve(e),t)}(e,t)}throw de(e)}function Oe(e,t){return t?Te(e,t):Ee(e)}function Ce(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=se(e);return Oe(e,n)}function Re(e,t){var n=p(e)?e:function(){return e},r=function(e){return e.error(n())};return new G(t?function(e){return t.schedule(r,0,e)}:r)}var Ne=f((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Se(e,t){var n="object"==typeof t;return new Promise((function(r,i){var o,s=!1;e.subscribe({next:function(e){o=e,s=!0},error:i,complete:function(){s?r(o):n?r(t.defaultValue):i(new Ne)}})}))}function Ie(e,t){var n="object"==typeof t;return new Promise((function(r,i){var o=new D({next:function(e){r(e),o.unsubscribe()},error:i,complete:function(){n?r(t.defaultValue):i(new Ne)}});e.subscribe(o)}))}function Ae(e){return e instanceof Date&&!isNaN(e)}var Le=f((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function De(e,t){var n=Ae(e)?{first:e}:"number"==typeof e?{each:e}:e,r=n.first,i=n.each,o=n.with,s=void 0===o?He:o,a=n.scheduler,c=void 0===a?null!=t?t:ee:a,u=n.meta,l=void 0===u?null:u;if(null==r&&null==i)throw new TypeError("No timeout provided.");return B((function(e,t){var n,o,a=null,u=0,h=function(e){o=me(t,c,(function(){try{n.unsubscribe(),Ee(s({meta:l,lastValue:a,seen:u})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(W(t,(function(e){null==o||o.unsubscribe(),u++,t.next(a=e),i>0&&h(i)}),void 0,void 0,(function(){(null==o?void 0:o.closed)||null==o||o.unsubscribe(),a=null}))),!u&&h(null!=r?"number"==typeof r?r:+r-c.now():i)}))}function He(e){throw new Le(e)}function Ue(e,t){return B((function(n,r){var i=0;n.subscribe(W(r,(function(n){r.next(e.call(t,n,i++))})))}))}function Pe(e,t,n){return void 0===n&&(n=1/0),p(t)?Pe((function(n,r){return Ue((function(e,i){return t(n,e,r,i)}))(Ee(e(n,r)))}),n):("number"==typeof t&&(n=t),B((function(t,r){return function(e,t,n,r,i,o,s,a){var c=[],u=0,l=0,h=!1,d=function(){!h||c.length||u||t.complete()},p=function(e){return u<r?f(e):c.push(e)},f=function(e){o&&t.next(e),u++;var a=!1;Ee(n(e,l++)).subscribe(W(t,(function(e){null==i||i(e),o?p(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();s?me(t,s,(function(){return f(e)})):f(e)};c.length&&u<r;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(W(t,p,(function(){h=!0,d()}))),function(){null==a||a()}}(t,r,e,n)})))}function ke(e){return void 0===e&&(e=1/0),Pe(x,e)}function xe(){return ke(1)}function Fe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xe()(Oe(e,se(e)))}function Ge(e){return new G((function(t){Ee(e()).subscribe(t)}))}function Me(e,t,n){void 0===e&&(e=0),void 0===n&&(n=te);var r=-1;return null!=t&&(re(t)?n=t:r=t),new G((function(t){var i=Ae(e)?+e-n.now():e;i<0&&(i=0);var o=0;return n.schedule((function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function Be(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=se(e),r=ae(e,1/0),i=e;return i.length?1===i.length?Ee(i[0]):ke(r)(Oe(i,n)):ne}var We,Ke,Ve,Ye,je,qe,ze=new G(O),$e=Array.isArray;function Qe(e){return 1===e.length&&$e(e[0])?e[0]:e}function Xe(e,t){return function(n,r){return!e.call(t,n,r)}}function Je(e,t){return B((function(n,r){var i=0;n.subscribe(W(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function Ze(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=Qe(e)).length?Ee(e[0]):new G(et(e))}function et(e){return function(t){for(var n=[],r=function(r){n.push(Ee(e[r]).subscribe(W(t,(function(e){if(n){for(var i=0;i<n.length;i++)i!==r&&n[i].unsubscribe();n=null}t.next(e)}))))},i=0;n&&!t.closed&&i<e.length;i++)r(i)}}function tt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=oe(e),r=Qe(e);return r.length?new G((function(e){var t=r.map((function(){return[]})),i=r.map((function(){return!1}));e.add((function(){t=i=null}));for(var o=function(o){Ee(r[o]).subscribe(W(e,(function(r){if(t[o].push(r),t.every((function(e){return e.length}))){var c=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,a([],s(c))):c),t.some((function(e,t){return!e.length&&i[t]}))&&e.complete()}}),(function(){i[o]=!0,!t[o].length&&e.complete()})))},c=0;!e.closed&&c<r.length;c++)o(c);return function(){t=i=null}})):ne}function nt(e){return B((function(t,n){var r,i=null,o=!1;i=t.subscribe(W(n,void 0,void 0,(function(s){r=Ee(e(s,nt(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):o=!0}))),o&&(i.unsubscribe(),i=null,r.subscribe(n))}))}function rt(e,t){return p(t)?Pe(e,t,1):Pe(e,1)}function it(e){return B((function(t,n){var r=!1;t.subscribe(W(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))}function ot(e){return e<=0?function(){return ne}:B((function(t,n){var r=0;t.subscribe(W(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function st(e,t){return t?function(n){return Fe(t.pipe(ot(1),B((function(e,t){e.subscribe(W(t,O))}))),n.pipe(st(e)))}:Pe((function(t,n){return e(t,n).pipe(ot(1),function(e){return Ue((function(){return e}))}(t))}))}function at(e,t){void 0===t&&(t=ee);var n=Me(e,t);return st((function(){return n}))}function ct(e,t){return void 0===t&&(t=x),e=null!=e?e:ut,B((function(n,r){var i,o=!0;n.subscribe(W(r,(function(n){var s=t(n);!o&&e(i,s)||(o=!1,i=s,r.next(n))})))}))}function ut(e,t){return e===t}function lt(e){return void 0===e&&(e=ht),B((function(t,n){var r=!1;t.subscribe(W(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))}function ht(){return new Ne}function dt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Je((function(t,n){return e(t,n,r)})):x,ot(1),n?it(t):lt((function(){return new Ne})))}}function pt(e){return e<=0?function(){return ne}:B((function(t,n){var r=[];t.subscribe(W(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var i=o(r),s=i.next();!s.done;s=i.next()){var a=s.value;n.next(a)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))}function ft(e){return B((function(t,n){var r,i,o=!1,s=function(){r=t.subscribe(W(n,void 0,void 0,(function(t){i||(i=new Y,e(i).subscribe(W(n,(function(){return r?s():o=!0})))),i&&i.next(t)}))),o&&(r.unsubscribe(),r=null,o=!1,s())};s()}))}function vt(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Y}:t,r=e.resetOnError,i=void 0===r||r,o=e.resetOnComplete,s=void 0===o||o,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,r,o,a=0,u=!1,l=!1,h=function(){null==r||r.unsubscribe(),r=void 0},d=function(){h(),t=o=void 0,u=l=!1},p=function(){var e=t;d(),null==e||e.unsubscribe()};return B((function(e,f){a++,l||u||h();var v=o=null!=o?o:n();f.add((function(){0!==--a||l||u||(r=gt(p,c))})),v.subscribe(f),!t&&a>0&&(t=new D({next:function(e){return v.next(e)},error:function(e){l=!0,h(),r=gt(d,i,e),v.error(e)},complete:function(){u=!0,h(),r=gt(d,s),v.complete()}}),Ee(e).subscribe(t))}))(e)}}function gt(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var i=new D({next:function(){i.unsubscribe(),e()}});return t.apply(void 0,a([],s(n))).subscribe(i)}}else e()}function Et(e,t,n){var r,i,o,s,a=!1;return e&&"object"==typeof e?(r=e.bufferSize,s=void 0===r?1/0:r,i=e.windowTime,t=void 0===i?1/0:i,a=void 0!==(o=e.refCount)&&o,n=e.scheduler):s=null!=e?e:1/0,vt({connector:function(){return new $(s,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function yt(e){return Je((function(t,n){return e<=n}))}function mt(e,t){return B((function(n,r){var i=null,o=0,s=!1,a=function(){return s&&!i&&r.complete()};n.subscribe(W(r,(function(n){null==i||i.unsubscribe();var s=0,c=o++;Ee(e(n,c)).subscribe(i=W(r,(function(e){return r.next(t?t(n,e,c,s++):e)}),(function(){i=null,a()})))}),(function(){s=!0,a()})))}))}function bt(){return mt(x)}function wt(e){return B((function(t,n){Ee(e).subscribe(W(n,(function(){return n.complete()}),O)),!n.closed&&t.subscribe(n)}))}function _t(e,t,n){var r=p(e)||t||n?{next:e,error:t,complete:n}:e;return r?B((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(W(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):x}class Tt extends Error{constructor(e,t){super(e),this.type=t,this.type=t,Object.setPrototypeOf(this,new.target.prototype)}}function Ot(t,n,r=e.LogLevel.ERROR,i=e.StackLayer.JS_LIB){n?null==n||n.write({level:r,layer:i,message:t}):n||r!==e.LogLevel.ERROR||console.error(t)}function Ct(e){return void 0!==e}e.LogLevel=void 0,(We=e.LogLevel||(e.LogLevel={})).ERROR="error",We.WARNING="warning",We.INFO="info",e.StackLayer=void 0,(Ke=e.StackLayer||(e.StackLayer={})).CHROME_EXTENSION="chrome-extension",Ke.NATIVE_CONSOLE="native-console",Ke.JS_LIB="js-lib",e.ErrorType=void 0,(Ve=e.ErrorType||(e.ErrorType={})).SDK_USAGE_ERROR="sdk-usage-error",Ve.FEATURE_NOT_SUPPORTED="feature-not-supported",Ve.DEVICE_ERROR="device-error",Ve.UNEXPECTED_ERROR="unexpected-error",Ve.INIT_ERROR="init-error";class Rt{constructor(e,t){this.compare=t,this.remove=new Y,this.itemRemoved=this.remove,this.items=new q([]),this.itemList=this.items,this.itemAdded=e.pipe(Ue((e=>(this.addItem(e),e))),vt()),this.itemAdded.subscribe({next:e=>{e.onDisconnect.pipe(dt(),Ue((()=>this.removeItem(e.id))),Je(Ct)).subscribe((e=>this.remove.next(e)))},error:O}),this.itemRemoved.subscribe({error:O})}getValue(){return[...this.items.getValue()]}addItem(t){if(this.items.getValue().filter((e=>e.id.equals(t.id))).length>0)throw new Tt("This item has already been added.",e.ErrorType.UNEXPECTED_ERROR);const n=this.items.getValue().concat([t]);n.sort(this.compare),this.items.next(n)}removeItem(t){const n=this.getValue(),r=n.findIndex((e=>e.id.equals(t)));if(-1===r)throw new Tt("Item not found and therefore cannot be removed.",e.ErrorType.UNEXPECTED_ERROR);const i=n.splice(r,1)[0];return this.items.next(n),i}}class Nt{constructor(t,n){var r;this.sdkVersion=null!==(r="4.2.1")?r:"0.0.1-local",this.consoleAppVersion=t.pipe(dt((e=>"ready"===e.event)),Ue((e=>e.version)),De(1e3),Et(1),nt((()=>Ce(null)))),this.chromeExtensionVersion=t.pipe(dt((e=>"chrome-extension-ready"===e.event)),Ue((e=>e.version)),De(1e3),Et(1),nt((()=>Ce(null)))),tt(this.consoleAppVersion,this.chromeExtensionVersion).subscribe((t=>{const r=`sdkVersion: ${this.sdkVersion} | chromeHostVersion: ${t[0]}`;let i;i="undefined"!=typeof process?`${r} | nodeVersion: ${process.version} | platform: ${process.platform}`:`${r} | chromeExtensionVersion: ${t[1]} | browserUserAgent: ${window.navigator.userAgent}`,Ot(i,n,e.LogLevel.INFO)}))}}class St{constructor(e,t,n){this.deviceDetector=e,this.deviceAdded=this.deviceDetector.deviceObservables.itemAdded,this.deviceRemoved=this.deviceDetector.deviceObservables.itemRemoved,this.deviceList=this.deviceDetector.deviceObservables.itemList,Ye.set(this,void 0),this._transport=t,this._readyEvents=t.consoleAppEvent.pipe(Je((e=>"ready"===e.event||"chrome-extension-ready"===e.event)),Et(2)),this._readyEvents.subscribe(),this._config=n,this.transportContext=t.context,d(this,Ye,new Nt(this._readyEvents,null==n?void 0:n.logger),"f")}getVersion(){return h(this,Ye,"f").sdkVersion}getChromehostVersion(){return Ie(h(this,Ye,"f").consoleAppVersion)}getChromeExtensionVersion(){return Ie(h(this,Ye,"f").chromeExtensionVersion)}}Ye=new WeakMap,e.TransportContext=void 0,(je=e.TransportContext||(e.TransportContext={})).NODE="node",je.CHROME_EXTENSION="chrome-extension",je.WEB_HID="web-hid",e.RequestedBrowserTransport=void 0,(qe=e.RequestedBrowserTransport||(e.RequestedBrowserTransport={})).CHROME_EXTENSION="chrome-extension",qe.WEB_HID="web-hid",qe.CHROME_EXTENSION_WITH_WEB_HID_FALLBACK="chrome-extension-with-web-hid-fallback";const It="Failed to dynamically import file. Please contact a Jabra representative as we would love to learn about scenarios where this could happen!";function At(t,n=e.RequestedBrowserTransport.CHROME_EXTENSION,i){return r(this,void 0,void 0,(function*(){if(n!==e.RequestedBrowserTransport.WEB_HID){const r=yield Promise.resolve().then((function(){return pi})).catch((()=>{throw new Tt(It,e.ErrorType.UNEXPECTED_ERROR)})),o=yield r.TransportChromeExtension.checkInstallation();if(o.ok)return Ot("Using Chrome extension for transport.",t,e.LogLevel.INFO),new r.TransportChromeExtension(t,i);if(n===e.RequestedBrowserTransport.CHROME_EXTENSION)throw new Tt(o.message,e.ErrorType.INIT_ERROR);n===e.RequestedBrowserTransport.CHROME_EXTENSION_WITH_WEB_HID_FALLBACK&&Ot(o.message,t,e.LogLevel.INFO)}return Ot("Using WebHID for transport.",t,e.LogLevel.INFO),function(t,n){return r(this,void 0,void 0,(function*(){const r=yield Promise.resolve().then((function(){return mr})).catch((()=>{throw new Tt(It,e.ErrorType.UNEXPECTED_ERROR)})),i=yield Promise.resolve().then((function(){return di})).catch((()=>{throw new Tt(It,e.ErrorType.UNEXPECTED_ERROR)})),o=r.initHandler(t);return new i.WebHidTransport(o,t,n)}))}(t,i)}))}class Lt{constructor(e,t){this.log=e.consoleAppEvent.pipe(Je((e=>"log"===e.event)),Ue((e=>({message:e.message,level:e.level,layer:e.layer})))),this.log.subscribe((e=>Ot(e.message,t,e.level,e.layer)))}}const Dt=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920];class Ht{constructor(e){this.config=e,this.messageShown=!1}validateOrganizationKey(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.partnerKey))return void this.logWarning("No partner key provided.");this.validateCrc(this.config.partnerKey)||this.logWarning("Invalid partner key.")}validateAppId(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.appId))return void this.logWarning("No app identifier provided.");if(this.config.appId.length<3)return void this.logWarning("The appId should be minimum 3 characters.",!1);if(this.config.appId.length>100)return void this.logWarning("The appId should be no longer than 100 characters.",!1);/^[A-Za-z0-9\-_]+$/.test(this.config.appId)||this.logWarning("The appId is invalid. Should consist of letters, numbers, underscores or dashes",!1)}validateAppName(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.appName))return void this.logWarning("No app name provided. Will fallback to use appId as name.",!1);if(!/^[\x20-\x7F]*$/.test(this.config.appName))return void this.logWarning("The app name can only contain ASCII characters",!1);if(this.config.appName.length>100)return void this.logWarning("The app name should be no longer than 100 characters.",!1);/^[A-Za-z0-9]+[A-Za-z0-9 &-]*$/g.test(this.config.appName)||this.logWarning("The appName is invalid. Name should consist of letters, numbers, spaces, ampersands and dashes. Name should not begin with spaces, ampersands or dashes.",!1)}logWarning(e,t=!0){if(this.messageShown)return;this.messageShown=!0;t?console.warn(`\n        ${e}\n        \n        Add keys to the config object on initialization.\n        E.g. await init({\n          partnerKey: 'my-partner-key-from-developer-zone',\n          appId: 'my-self-chosen-app-id',\n          appName: 'My App Name'\n        });\n\n        Please obtain a valid partner key from https://developer.jabra.com.\n        The key will ensure interoperability with other Jabra apps and services, and mitigate\n        some co-existence issues with other softphone applications.\n\n        The package will continue to work without the keys, but we do not recommend production release\n        without it. Read more on the Developer Zone.\n      \n      `):console.warn(e)}validateCrc(e){const[t,...n]=e.split("-"),r=function(e){let t,n,r=65535;for(n=0;n<e.length;n+=1){const i=e.charCodeAt(n);if(i>255)throw new RangeError;t=255&(i^r>>8),r=Dt[t]^r<<8}return 65535&(0^r)}(n.join("-")).toString(16).padStart(4,"0");return t===r}}var Ut,Pt,kt,xt,Ft,Gt,Mt,Bt;!function(e){e[e.MS_OC=0]="MS_OC",e[e.CISCO=1]="CISCO",e[e.AVAYA=2]="AVAYA",e[e.SIEMENS=3]="SIEMENS",e[e.ALCATEL=4]="ALCATEL",e[e.IBM=5]="IBM",e[e.AASTRA=6]="AASTRA",e[e.SKYPE=7]="SKYPE",e[e.GENERIC=8]="GENERIC",e[e.NORTEL=9]="NORTEL",e[e.JABRA=10]="JABRA",e[e.NEC=11]="NEC",e[e.SHORETEL=12]="SHORETEL",e[e.OTHER=255]="OTHER"}(Ut||(Ut={}));class Wt{constructor(e,t){this.gnpReadCommand=e,this.serialize=t,this.command=e.command,this.subCommand=e.subCommand}deserialize(e){return this.gnpReadCommand.deserialize(e)}}!function(e){e[e.GN_PROTOCOL=65280]="GN_PROTOCOL"}(Pt||(Pt={})),function(e){e[e.DATA=1]="DATA"}(kt||(kt={}));class Kt{constructor(e,t,n,r,i,o=new Uint8Array,s=0){this.destination=e,this.source=t,this.type=n,this.command=r,this.subCommand=i,this.payload=o,this.sequenceNumber=s}}!function(e){e[e.PC_ADDR=0]="PC_ADDR",e[e.BASE_ADDR=1]="BASE_ADDR",e[e.HS1_ADDR=4]="HS1_ADDR",e[e.HS_BT_USB_ADDR=8]="HS_BT_USB_ADDR",e[e.HS_CRADLE_ADDR=10]="HS_CRADLE_ADDR",e[e.CRADLE_ADDR=21]="CRADLE_ADDR"}(xt||(xt={})),function(e){e[e.EVENT=0]="EVENT",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE",e[e.REPLY=3]="REPLY"}(Ft||(Ft={})),function(e){e[e.IDENT=2]="IDENT",e[e.DFU=7]="DFU",e[e.DEVICE=13]="DEVICE",e[e.FWU=15]="FWU",e[e.STATUS=18]="STATUS",e[e.CONFIG=19]="CONFIG",e[e.NACK=254]="NACK",e[e.ACK=255]="ACK"}(Gt||(Gt={})),function(e){e[e.CONFIG_PREFERRED_SOFTPHONE=34]="CONFIG_PREFERRED_SOFTPHONE",e[e.ID=1]="ID",e[e.IDENT_GET_AVAILABLE_SOFTPHONES=16]="IDENT_GET_AVAILABLE_SOFTPHONES",e[e.TYPE=2]="TYPE",e[e.NAME=0]="NAME",e[e.PID=17]="PID",e[e.ATTACH_EVENT=1]="ATTACH_EVENT",e[e.DETACH_EVENT=2]="DETACH_EVENT"}(Mt||(Mt={})),function(e){e[e.NO_ERROR_CODE=0]="NO_ERROR_CODE",e[e.BAD_STATE=243]="BAD_STATE",e[e.TRANSMIT_FAILED=244]="TRANSMIT_FAILED",e[e.ILLEGAL_ADDR=245]="ILLEGAL_ADDR",e[e.UNKNOWN_CMD=246]="UNKNOWN_CMD",e[e.FILE_NOT_FOUND=247]="FILE_NOT_FOUND",e[e.INTERNAL_ERROR=248]="INTERNAL_ERROR",e[e.REPLY_ERROR=249]="REPLY_ERROR",e[e.ILLEGAL_PARAM=250]="ILLEGAL_PARAM",e[e.OUT_OF_SEQUENCE=251]="OUT_OF_SEQUENCE",e[e.NO_SPACE=252]="NO_SPACE",e[e.ACCESS_DENIED=253]="ACCESS_DENIED",e[e.NO_MORE_DATA=254]="NO_MORE_DATA",e[e.UNKNOWN_SUB_CMD=255]="UNKNOWN_SUB_CMD"}(Bt||(Bt={}));const Vt={command:Gt.DEVICE,subCommand:Mt.ATTACH_EVENT,serialize:e=>Uint8Array.from([5,0])};function Yt(t){const n=t.payload,r=n[0],i=n.length-1;if(i!==r)throw new Tt(`Invalid response. Expected length: ${r}, actual: ${i}`,e.ErrorType.DEVICE_ERROR);const o=n.slice(1);return String.fromCharCode(...Array.from(o))}class jt{constructor(){var t;this.command=Gt.IDENT,this.subCommand=Mt.IDENT_GET_AVAILABLE_SOFTPHONES,this.deserialize=(t=e=>e,n=>{const r=n.payload,i=r[0],o=r.length-1;if(o!==i)throw new Tt(`Invalid response. Expected length: ${i}, actual: ${o}`,e.ErrorType.DEVICE_ERROR);const s=[];return r.slice(1).forEach((e=>{s.push(t(e))})),s})}}const qt={command:Gt.IDENT,subCommand:Mt.NAME,deserialize:Yt},zt={command:Gt.IDENT,subCommand:Mt.PID,deserialize:function(e){const t=e instanceof Kt?e.payload:e;return new DataView(t.buffer).getUint16(0,!0)}},$t={command:Gt.CONFIG,subCommand:Mt.CONFIG_PREFERRED_SOFTPHONE,deserialize:e=>e.payload[0],serialize:e=>Uint8Array.of(e)},Qt={command:Gt.IDENT,subCommand:Mt.TYPE,deserialize:e=>e.source},Xt={command:Gt.IDENT,subCommand:Mt.ID,deserialize:Yt};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Jt(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var Zt,en,tn=Jt((function(e){
/*!
    **  Pure-UUID -- Pure JavaScript Based Universally Unique Identifier (UUID)
    **  Copyright (c) 2004-2020 Dr. Ralf S. Engelschall <rse@engelschall.com>
    **
    **  Permission is hereby granted, free of charge, to any person obtaining
    **  a copy of this software and associated documentation files (the
    **  "Software"), to deal in the Software without restriction, including
    **  without limitation the rights to use, copy, modify, merge, publish,
    **  distribute, sublicense, and/or sell copies of the Software, and to
    **  permit persons to whom the Software is furnished to do so, subject to
    **  the following conditions:
    **
    **  The above copyright notice and this permission notice shall be included
    **  in all copies or substantial portions of the Software.
    **
    **  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    **  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    **  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
    **  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
    **  CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
    **  TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
    **  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
    */
e.exports=function(){var e=function(e,t,n,r,i,o){for(var s=function(e,t){var n=e.toString(16);return n.length<2&&(n="0"+n),t&&(n=n.toUpperCase()),n},a=t;a<=n;a++)i[o++]=s(e[a],r);return i},t=function(e,t,n,r,i){for(var o=t;o<=n;o+=2)r[i++]=parseInt(e.substr(o,2),16)},n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),r=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0],i=function(e,t){if(t%4!=0)throw new Error("z85_encode: invalid input length (multiple of 4 expected)");for(var r="",i=0,o=0;i<t;)if(o=256*o+e[i++],i%4==0){for(var s=52200625;s>=1;){var a=Math.floor(o/s)%85;r+=n[a],s/=85}o=0}return r},o=function(e,t){var n=e.length;if(n%5!=0)throw new Error("z85_decode: invalid input length (multiple of 5 expected)");void 0===t&&(t=new Array(4*n/5));for(var i=0,o=0,s=0;i<n;){var a=e.charCodeAt(i++)-32;if(a<0||a>=r.length)break;if(s=85*s+r[a],i%5==0){for(var c=16777216;c>=1;)t[o++]=Math.trunc(s/c%256),c/=256;s=0}}return t},s=function(e,t){var n={ibits:8,obits:8,obigendian:!0};for(var r in t)void 0!==n[r]&&(n[r]=t[r]);for(var i,o,s,a=[],c=0,u=0,l=0,h=e.length;0===u&&(o=e.charCodeAt(c++)),i=o>>n.ibits-(u+8)&255,u=(u+8)%n.ibits,n.obigendian?0===l?s=i<<n.obits-8:s|=i<<n.obits-8-l:0===l?s=i:s|=i<<l,!(0==(l=(l+8)%n.obits)&&(a.push(s),c>=h)););return a},a=function(e,t){var n={ibits:32,ibigendian:!0};for(var r in t)void 0!==n[r]&&(n[r]=t[r]);var i="",o=4294967295;n.ibits<32&&(o=(1<<n.ibits)-1);for(var s=e.length,a=0;a<s;a++)for(var c=e[a]&o,u=0;u<n.ibits;u+=8)n.ibigendian?i+=String.fromCharCode(c>>n.ibits-8-u&255):i+=String.fromCharCode(c>>u&255);return i},c=8,u=8,l=256,h=function(e,t,n,r,i,o,s,a){return[a,s,o,i,r,n,t,e]},d=function(){return h(0,0,0,0,0,0,0,0)},p=function(e){return e.slice(0)},f=function(e){for(var t=d(),n=0;n<c;n++)t[n]=Math.floor(e%l),e/=l;return t},v=function(e){for(var t=0,n=c-1;n>=0;n--)t*=l,t+=e[n];return Math.floor(t)},g=function(e,t){for(var n=0,r=0;r<c;r++)n+=e[r]+t[r],e[r]=Math.floor(n%l),n=Math.floor(n/l);return n},E=function(e,t){for(var n=0,r=0;r<c;r++)n+=e[r]*t,e[r]=Math.floor(n%l),n=Math.floor(n/l);return n},y=function(e,t){var n,r,i,o=new Array(c+c);for(n=0;n<c+c;n++)o[n]=0;for(n=0;n<c;n++){for(i=0,r=0;r<c;r++)i+=e[n]*t[r]+o[n+r],o[n+r]=i%l,i/=l;for(;r<c+c-n;r++)i+=o[n+r],o[n+r]=i%l,i/=l}for(n=0;n<c;n++)e[n]=o[n];return o.slice(c,c)},m=function(e,t){for(var n=0;n<c;n++)e[n]&=t[n];return e},b=function(e,t){for(var n=0;n<c;n++)e[n]|=t[n];return e},w=function(e,t){var n=d();if(t%u!=0)throw new Error("ui64_rorn: only bit rotations supported with a multiple of digit bits");for(var r=Math.floor(t/u),i=0;i<r;i++){for(var o=c-1-1;o>=0;o--)n[o+1]=n[o];for(n[0]=e[0],o=0;o<c-1;o++)e[o]=e[o+1];e[o]=0}return v(n)},_=function(e,t){if(t>c*u)throw new Error("ui64_ror: invalid number of bits to shift");var n,r=new Array(c+c);for(n=0;n<c;n++)r[n+c]=e[n],r[n]=0;var i=Math.floor(t/u),o=t%u;for(n=i;n<c+c-1;n++)r[n-i]=(r[n]>>>o|r[n+1]<<u-o)&(1<<u)-1;for(r[c+c-1-i]=r[c+c-1]>>>o&(1<<u)-1,n=c+c-1-i+1;n<c+c;n++)r[n]=0;for(n=0;n<c;n++)e[n]=r[n+c];return r.slice(0,c)},T=function(e,t){if(t>c*u)throw new Error("ui64_rol: invalid number of bits to shift");var n,r=new Array(c+c);for(n=0;n<c;n++)r[n+c]=0,r[n]=e[n];var i=Math.floor(t/u),o=t%u;for(n=c-1-i;n>0;n--)r[n+i]=(r[n]<<o|r[n-1]>>>u-o)&(1<<u)-1;for(r[0+i]=r[0]<<o&(1<<u)-1,n=0+i-1;n>=0;n--)r[n]=0;for(n=0;n<c;n++)e[n]=r[n];return r.slice(c,c)},O=function(e,t){for(var n=0;n<c;n++)e[n]^=t[n]},C=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},R=function(e,t){return e<<t&4294967295|e>>>32-t&4294967295},N=function(e,t){function n(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function r(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var i=Array(80),o=1732584193,s=-271733879,a=-1732584194,c=271733878,u=-1009589776,l=0;l<e.length;l+=16){for(var h=o,d=s,p=a,f=c,v=u,g=0;g<80;g++){i[g]=g<16?e[l+g]:R(i[g-3]^i[g-8]^i[g-14]^i[g-16],1);var E=C(C(R(o,5),n(g,s,a,c)),C(C(u,i[g]),r(g)));u=c,c=a,a=R(s,30),s=o,o=E}o=C(o,h),s=C(s,d),a=C(a,p),c=C(c,f),u=C(u,v)}return[o,s,a,c,u]},S=function(e){return a(N(s(e,{ibits:8,obits:32,obigendian:!0}),8*e.length),{ibits:32,ibigendian:!0})},I=function(e,t){function n(e,t,n,r,i,o){return C(R(C(C(t,e),C(r,o)),i),n)}function r(e,t,r,i,o,s,a){return n(t&r|~t&i,e,t,o,s,a)}function i(e,t,r,i,o,s,a){return n(t&i|r&~i,e,t,o,s,a)}function o(e,t,r,i,o,s,a){return n(t^r^i,e,t,o,s,a)}function s(e,t,r,i,o,s,a){return n(r^(t|~i),e,t,o,s,a)}e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,c=-271733879,u=-1732584194,l=271733878,h=0;h<e.length;h+=16){var d=a,p=c,f=u,v=l;a=r(a,c,u,l,e[h+0],7,-680876936),l=r(l,a,c,u,e[h+1],12,-389564586),u=r(u,l,a,c,e[h+2],17,606105819),c=r(c,u,l,a,e[h+3],22,-1044525330),a=r(a,c,u,l,e[h+4],7,-176418897),l=r(l,a,c,u,e[h+5],12,1200080426),u=r(u,l,a,c,e[h+6],17,-1473231341),c=r(c,u,l,a,e[h+7],22,-45705983),a=r(a,c,u,l,e[h+8],7,1770035416),l=r(l,a,c,u,e[h+9],12,-1958414417),u=r(u,l,a,c,e[h+10],17,-42063),c=r(c,u,l,a,e[h+11],22,-1990404162),a=r(a,c,u,l,e[h+12],7,1804603682),l=r(l,a,c,u,e[h+13],12,-40341101),u=r(u,l,a,c,e[h+14],17,-1502002290),a=i(a,c=r(c,u,l,a,e[h+15],22,1236535329),u,l,e[h+1],5,-165796510),l=i(l,a,c,u,e[h+6],9,-1069501632),u=i(u,l,a,c,e[h+11],14,643717713),c=i(c,u,l,a,e[h+0],20,-373897302),a=i(a,c,u,l,e[h+5],5,-701558691),l=i(l,a,c,u,e[h+10],9,38016083),u=i(u,l,a,c,e[h+15],14,-660478335),c=i(c,u,l,a,e[h+4],20,-405537848),a=i(a,c,u,l,e[h+9],5,568446438),l=i(l,a,c,u,e[h+14],9,-1019803690),u=i(u,l,a,c,e[h+3],14,-187363961),c=i(c,u,l,a,e[h+8],20,1163531501),a=i(a,c,u,l,e[h+13],5,-1444681467),l=i(l,a,c,u,e[h+2],9,-51403784),u=i(u,l,a,c,e[h+7],14,1735328473),a=o(a,c=i(c,u,l,a,e[h+12],20,-1926607734),u,l,e[h+5],4,-378558),l=o(l,a,c,u,e[h+8],11,-2022574463),u=o(u,l,a,c,e[h+11],16,1839030562),c=o(c,u,l,a,e[h+14],23,-35309556),a=o(a,c,u,l,e[h+1],4,-1530992060),l=o(l,a,c,u,e[h+4],11,1272893353),u=o(u,l,a,c,e[h+7],16,-155497632),c=o(c,u,l,a,e[h+10],23,-1094730640),a=o(a,c,u,l,e[h+13],4,681279174),l=o(l,a,c,u,e[h+0],11,-358537222),u=o(u,l,a,c,e[h+3],16,-722521979),c=o(c,u,l,a,e[h+6],23,76029189),a=o(a,c,u,l,e[h+9],4,-640364487),l=o(l,a,c,u,e[h+12],11,-421815835),u=o(u,l,a,c,e[h+15],16,530742520),a=s(a,c=o(c,u,l,a,e[h+2],23,-995338651),u,l,e[h+0],6,-198630844),l=s(l,a,c,u,e[h+7],10,1126891415),u=s(u,l,a,c,e[h+14],15,-1416354905),c=s(c,u,l,a,e[h+5],21,-57434055),a=s(a,c,u,l,e[h+12],6,1700485571),l=s(l,a,c,u,e[h+3],10,-1894986606),u=s(u,l,a,c,e[h+10],15,-1051523),c=s(c,u,l,a,e[h+1],21,-2054922799),a=s(a,c,u,l,e[h+8],6,1873313359),l=s(l,a,c,u,e[h+15],10,-30611744),u=s(u,l,a,c,e[h+6],15,-1560198380),c=s(c,u,l,a,e[h+13],21,1309151649),a=s(a,c,u,l,e[h+4],6,-145523070),l=s(l,a,c,u,e[h+11],10,-1120210379),u=s(u,l,a,c,e[h+2],15,718787259),c=s(c,u,l,a,e[h+9],21,-343485551),a=C(a,d),c=C(c,p),u=C(u,f),l=C(l,v)}return[a,c,u,l]},A=function(e){return a(I(s(e,{ibits:8,obits:32,obigendian:!1}),8*e.length),{ibits:32,ibigendian:!1})},L=function(e){this.mul=h(88,81,244,45,76,149,127,45),this.inc=h(20,5,123,126,247,103,129,79),this.mask=h(0,0,0,0,255,255,255,255),this.state=p(this.inc),this.next(),m(this.state,this.mask),e=f(void 0!==e?e>>>0:4294967295*Math.random()>>>0),b(this.state,e),this.next()};L.prototype.next=function(){var e=p(this.state);y(this.state,this.mul),g(this.state,this.inc);var t=p(e);_(t,18),O(t,e),_(t,27);var n=p(e);_(n,59),m(t,this.mask);var r=v(n),i=p(t);return T(i,32-r),_(t,r),O(t,i),v(t)};var D=new L,H=function(e,t){for(var n=[],r=0;r<e;r++)n[r]=D.next()%t;return n},U=0,P=0,k=function(){if(1===arguments.length&&"string"==typeof arguments[0])this.parse.apply(this,arguments);else if(arguments.length>=1&&"number"==typeof arguments[0])this.make.apply(this,arguments);else{if(arguments.length>=1)throw new Error("UUID: constructor: invalid arguments");for(var e=0;e<16;e++)this[e]=0}};return"undefined"!=typeof Uint8Array?k.prototype=new Uint8Array(16):Buffer?k.prototype=Buffer.alloc(16):k.prototype=new Array(16),k.prototype.constructor=k,k.prototype.make=function(e){var t,n=this;if(1===e){var r=(new Date).getTime();r!==U?P=0:P++,U=r;var i,o=f(r);E(o,1e4),g(o,h(1,178,29,210,19,129,64,0)),P>0&&g(o,f(P)),i=w(o,8),n[3]=255&i,i=w(o,8),n[2]=255&i,i=w(o,8),n[1]=255&i,i=w(o,8),n[0]=255&i,i=w(o,8),n[5]=255&i,i=w(o,8),n[4]=255&i,i=w(o,8),n[7]=255&i,i=w(o,8),n[6]=15&i;var s=H(2,255);n[8]=s[0],n[9]=s[1];var a=H(6,255);for(a[0]|=1,a[0]|=2,t=0;t<6;t++)n[10+t]=a[t]}else if(4===e){var c=H(16,255);for(t=0;t<16;t++)this[t]=c[t]}else{if(3!==e&&5!==e)throw new Error("UUID: make: invalid version");var u="",l="object"==typeof arguments[1]&&arguments[1]instanceof k?arguments[1]:(new k).parse(arguments[1]);for(t=0;t<16;t++)u+=String.fromCharCode(l[t]);u+=arguments[2];var d=3===e?A(u):S(u);for(t=0;t<16;t++)n[t]=d.charCodeAt(t)}return n[6]&=15,n[6]|=e<<4,n[8]&=63,n[8]|=128,n},k.prototype.format=function(t){var n,r;return"z85"===t?n=i(this,16):"b16"===t?(r=Array(32),e(this,0,15,!0,r,0),n=r.join("")):void 0!==t&&"std"!==t||(r=new Array(36),e(this,0,3,!1,r,0),r[8]="-",e(this,4,5,!1,r,9),r[13]="-",e(this,6,7,!1,r,14),r[18]="-",e(this,8,9,!1,r,19),r[23]="-",e(this,10,15,!1,r,24),n=r.join("")),n},k.prototype.toString=function(e){return this.format(e)},k.prototype.toJSON=function(){return this.format("std")},k.prototype.parse=function(e,n){if("string"!=typeof e)throw new Error("UUID: parse: invalid argument (type string expected)");if("z85"===n)o(e,this);else if("b16"===n)t(e,0,35,this,0);else if(void 0===n||"std"===n){var r={nil:"00000000-0000-0000-0000-000000000000","ns:DNS":"6ba7b810-9dad-11d1-80b4-00c04fd430c8","ns:URL":"6ba7b811-9dad-11d1-80b4-00c04fd430c8","ns:OID":"6ba7b812-9dad-11d1-80b4-00c04fd430c8","ns:X500":"6ba7b814-9dad-11d1-80b4-00c04fd430c8"};if(void 0!==r[e])e=r[e];else if(!e.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))throw new Error('UUID: parse: invalid string representation (expected "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx")');t(e,0,7,this,0),t(e,9,12,this,4),t(e,14,17,this,6),t(e,19,22,this,8),t(e,24,35,this,10)}return this},k.prototype.export=function(){for(var e=Array(16),t=0;t<16;t++)e[t]=this[t];return e},k.prototype.import=function(e){if(!("object"==typeof e&&e instanceof Array))throw new Error("UUID: import: invalid argument (type Array expected)");if(16!==e.length)throw new Error("UUID: import: invalid argument (Array of length 16 expected)");for(var t=0;t<16;t++){if("number"!=typeof e[t])throw new Error("UUID: import: invalid array element #"+t+" (type Number expected)");if(!isFinite(e[t])||Math.floor(e[t])!==e[t])throw new Error("UUID: import: invalid array element #"+t+" (Number with integer value expected)");if(!(e[t]>=0&&e[t]<=255))throw new Error("UUID: import: invalid array element #"+t+" (Number with integer value in range 0...255 expected)");this[t]=e[t]}return this},k.prototype.compare=function(e){if("object"!=typeof e)throw new Error("UUID: compare: invalid argument (type UUID expected)");if(!(e instanceof k))throw new Error("UUID: compare: invalid argument (type UUID expected)");for(var t=0;t<16;t++){if(this[t]<e[t])return-1;if(this[t]>e[t])return 1}return 0},k.prototype.equal=function(e){return 0===this.compare(e)},k.prototype.fold=function(e){if(void 0===e)throw new Error("UUID: fold: invalid argument (number of fold operations expected)");if(e<1||e>4)throw new Error("UUID: fold: invalid argument (1-4 fold operations expected)");for(var t=16/Math.pow(2,e),n=new Array(t),r=0;r<t;r++){for(var i=0,o=0;r+o<16;o+=t)i^=this[r+o];n[r]=i}return n},k.PCG=L,k}(),e.exports.default=e.exports}));class nn{constructor(e){this.transport=e,this.gnpLockAcquired=e.consoleAppEvent.pipe(Je((e=>"response-gnp-lock"===e.event)),Ue((e=>e.token)),Et(1)),this.gnpLockAcquired.subscribe()}acquireGnpLock(e){const t=new tn(4).toString(),n={action:"request-gnp-lock",id:e,token:t},r=this.gnpLockAcquired.pipe(dt((e=>e===t)));return this.transport.writeAction(n),r}releaseGnpLock(e,t){const n={action:"release-gnp-lock",id:e,token:t};this.transport.writeAction(n)}}e.ReportType=void 0,(Zt=e.ReportType||(e.ReportType={}))[Zt.INPUT=0]="INPUT",Zt[Zt.OUTPUT=1]="OUTPUT",Zt[Zt.FEATURE=2]="FEATURE",e.ValueType=void 0,(en=e.ValueType||(e.ValueType={})).ABSOLUTE="absolute",en.RELATIVE="relative";class rn{constructor(e){this.id=e}equals(e){return this.id===e.id}startsWith(e){return this.id.startsWith(e.id)}toString(){return this.id}}function on(e,t,n){const r=e.toString(16).padStart(4,"0"),i=t.toString(16).padStart(4,"0");return new rn(`${r}:${i}:${n}`)}class sn{constructor(e,t,n,r){this.id=e,this.usagePage=t,this.usage=n,this.value=r}isArray(){return Array.isArray(this.value)}static deserialize(e,t){return new sn(new rn(e),t.usagePage,t.usage,t.value)}}class an{constructor(e,t,n){this.descriptor=t,this.transport=n,this.transportId=e.transportId,this.input=n.consoleAppEvent.pipe(Je((e=>e.id===this.transportId)),an.inputReportsFilter)}output(e,t,n){const r={action:"hid-output",id:this.transportId,usagePage:e,usage:t,value:n};this.transport.writeAction(r)}getFeatureReport(e,t){const n=new tn(4).toString(),r={action:"request-hid-feature",id:this.transportId,token:n,usagePage:e,usage:t};return this.transport.writeAction(r),this.transport.consoleAppEvent.pipe(dt((e=>"response-hid-feature"===e.event&&e.token===n)),Ue((e=>e.value)))}setFeatureReport(e,t,n){const r={action:"set-hid-feature",id:this.transportId,usagePage:e,usage:t,value:n};this.transport.writeAction(r)}findDescriptor(e,t,n){return this.descriptor.find((r=>r.usagePage===e&&r.usage===t&&r.reportType===n))}}function cn(e){return t=>t.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=oe(e);return B((function(t,r){for(var i=e.length,o=new Array(i),c=e.map((function(){return!1})),u=!1,l=function(t){Ee(e[t]).subscribe(W(r,(function(e){o[t]=e,u||c[t]||(c[t]=!0,(u=c.every(x))&&(c=null))}),O))},h=0;h<i;h++)l(h);t.subscribe(W(r,(function(e){if(u){var t=a([e],s(o));r.next(n?n.apply(void 0,a([],s(t))):t)}})))}))}(e),Je((([e,t])=>t)),Ue((([e,t])=>e)))}an.inputReportsFilter=e=>e.pipe(Je((e=>"hid-input"===e.event)),Ue((e=>sn.deserialize(e.id,e))));class un{static typeFromAttr(e){return e>>6}static packetLengthFromAttr(e){return e&this.lengthMask}static deserialize(e){const t=e[0],n=e[1],r=e[2],i=this.typeFromAttr(e[3]),o=e[4],s=e[5],a=this.packetLengthFromAttr(e[3]),c=e.slice(6,a);return new Kt(t,n,i,o,s,c,r)}}un.lengthMask=63;class ln{constructor(){this.data=[]}hasHeader(){return this.data.length>=ln.gnpPacketHeaderLength}expectedPacketLength(){if(!this.hasHeader())throw new Tt("Unable to get expected packet length without a full header",e.ErrorType.UNEXPECTED_ERROR);return un.packetLengthFromAttr(this.data[3])}appendData(e){this.hasHeader()&&this.expectedPacketLength()>ln.gnpPacketMaxLength&&(this.data=[]),this.data=this.data.concat(e)}hasFullPacket(){if(!this.hasHeader())return!1;const e=this.expectedPacketLength();return this.data.length>=e}getPacketAndReset(){if(!this.hasFullPacket())throw new Tt("Trying to get packet but buffer is not complete",e.ErrorType.UNEXPECTED_ERROR);const t=un.deserialize(Uint8Array.from(this.data));return this.data=[],t}}ln.gnpPacketHeaderLength=6,ln.gnpPacketMaxLength=63;class hn{static attrFromTypeAndPayloadLength(e,t){return(e<<6)+(t+6)}static serialize(e){const t=new Uint8Array(6);t[0]=e.destination,t[1]=e.source,t[2]=e.sequenceNumber,t[3]=this.attrFromTypeAndPayloadLength(e.type,e.payload.length),t[4]=e.command,t[5]=e.subCommand;const n=new Uint8Array(t.length+e.payload.length);return n.set(t),n.set(e.payload,t.length),n}}const dn=()=>{};function pn(e){return _t((t=>e()),(t=>e()),(()=>dn))}const fn=()=>{return t=e=>e.command===Gt.NACK,n=t=>{const n=t.subCommand in Bt?Bt[t.subCommand]:t.subCommand;return new Tt(`Got NACK response. Reason: ${n}`,e.ErrorType.DEVICE_ERROR)},e=>e.pipe(Ue((e=>t(e)?Re(n(e)):Ce(e))),bt());var t,n},vn=e=>dt((t=>t.type===Ft.REPLY&&t.sequenceNumber===e.sequenceNumber&&t.destination===e.source&&t.source===e.destination));class gn{constructor(e,t,n,r,i=0){this.hidChannel=e,this.gnpLock=t,this.transportId=n,this.primaryAddress=r,this.lockQueue=[],this.packets=e.input.pipe(gn.inputFilter),this.events=this.packets.pipe(gn.eventsFilter),this.nextSequenceNumber=i}static get inputFilter(){return e=>{const t=e.pipe(Je((e=>e.usagePage===Pt.GN_PROTOCOL&&e.usage===kt.DATA&&e.isArray()))),n=new ln;return t.pipe(Pe((e=>{const t=e.value;if(n.appendData(t),n.hasFullPacket()){return Ce(n.getPacketAndReset())}return ze})),vt())}}static supportsGnpOverHid(t){return void 0!==t.findDescriptor(Pt.GN_PROTOCOL,kt.DATA,e.ReportType.OUTPUT)}getNextSequenceNumber(){const e=this.nextSequenceNumber;return this.nextSequenceNumber=(this.nextSequenceNumber+1)%255,e}doWithGnpLockHeld(e){this.lockQueue.push(e),this.lockQueue.length>1||this.processLockQueue()}processLockQueue(){this.gnpLock.acquireGnpLock(this.transportId).subscribe((t=>{(0,this.lockQueue[0])((t=>{var n;const r=null===(n=this.hidChannel.findDescriptor(Pt.GN_PROTOCOL,kt.DATA,e.ReportType.OUTPUT))||void 0===n?void 0:n.reportSize;if(!r)throw new Tt("Cannot send GNP packets to this device.",e.ErrorType.DEVICE_ERROR);const i=hn.serialize(t);let o=0;do{const e=Math.min(i.length-o,r),t=i.subarray(o,o+e);o+=t.length,this.hidChannel.output(Pt.GN_PROTOCOL,kt.DATA,Array.from(t))}while(o<i.length)}),this.packets,(()=>{this.gnpLock.releaseGnpLock(this.transportId,t),this.lockQueue.splice(0,1),this.lockQueue.length>0&&this.processLockQueue()}))}))}sendEvent(e,t,n=this.primaryAddress){const r=new Kt(n,xt.PC_ADDR,Ft.EVENT,e.command,e.subCommand,e.serialize(t),0);this.doWithGnpLockHeld(((e,t,n)=>{e(r),n()}))}read(e,t=this.primaryAddress,n=2500){const r=new Wt(e,(e=>new Uint8Array));return this.readWithParams(r,null,t,n)}readWithParams(e,t,n=this.primaryAddress,r=2500){const i=new Kt(n,xt.PC_ADDR,Ft.READ,e.command,e.subCommand,e.serialize(t),this.getNextSequenceNumber()),o=new Y;return this.doWithGnpLockHeld(((t,n,s)=>{n.pipe(vn(i),fn(),dt((e=>e.command===i.command&&e.subCommand===i.subCommand)),De(r),pn(s),Ue((t=>e.deserialize(t)))).subscribe(o),t(i)})),o}write(e,t,n=this.primaryAddress,r=2500){const i=new Kt(n,xt.PC_ADDR,Ft.WRITE,e.command,e.subCommand,e.serialize(t),this.getNextSequenceNumber()),o=new Y;return this.doWithGnpLockHeld(((e,t,n)=>{t.pipe(vn(i),fn(),dt((e=>e.command===Gt.ACK)),De(r),pn(n),Ue((()=>!0))).subscribe(o),e(i)})),o}}gn.eventsFilter=e=>e.pipe(Je((e=>e.type===Ft.EVENT)));class En{constructor(e,t){this.parentGnpChannel=e,this.primaryAddress=t,this.events=e.events.pipe(Je((e=>e.source===this.primaryAddress)))}sendEvent(e,t,n){this.parentGnpChannel.sendEvent(e,t,this.primaryAddress)}read(e,t,n){return this.parentGnpChannel.read(e,this.primaryAddress,n)}readWithParams(e,t,n,r){return this.parentGnpChannel.readWithParams(e,t,this.primaryAddress,r)}write(e,t,n,r){return this.parentGnpChannel.write(e,t,this.primaryAddress,r)}}function yn(t,n,r,i){if(!gn.supportsGnpOverHid(t))return Re((()=>new Tt("Device does not support GNP commands.",e.ErrorType.DEVICE_ERROR)));const o=Ce(xt.HS_BT_USB_ADDR,xt.BASE_ADDR,xt.CRADLE_ADDR,xt.HS1_ADDR,xt.HS_CRADLE_ADDR).pipe(Ue(((e,i)=>Ge((()=>{const o=new gn(t,new nn(n),r,e,i);return o.read(Qt,e,500).pipe(Ue((e=>o)),nt((()=>ne)))})))),xe(),ot(1),lt((()=>new Tt("GNP probe failed.",e.ErrorType.DEVICE_ERROR))));return Ze(i.pipe(Pe((t=>Re((()=>new Tt("Device was suddenly disconnected.",e.ErrorType.DEVICE_ERROR)))))),o).pipe(vt())}function mn(e,t){return new En(e,t)}class bn{constructor(){this.primaryAddress=xt.BASE_ADDR,this.events=ze}subscribeToEvent(t,n){return Re((()=>new Tt("This device does not support GNP commands.",e.ErrorType.FEATURE_NOT_SUPPORTED)))}sendEvent(t,n,r){throw new Tt("This device does not support GNP commands.",e.ErrorType.FEATURE_NOT_SUPPORTED)}read(t,n,r){return Re((()=>new Tt("This device does not support GNP commands.",e.ErrorType.FEATURE_NOT_SUPPORTED)))}readWithParams(t,n,r,i){return Re((()=>new Tt("This device does not support GNP commands.",e.ErrorType.FEATURE_NOT_SUPPORTED)))}write(t,n,r,i){return Re((()=>new Tt("This device does not support GNP commands.",e.ErrorType.FEATURE_NOT_SUPPORTED)))}}class wn{constructor(e){this.transportId=e,this.isChild=!1}equals(e){return this.isChild===e.isChild&&this.transportId===e.transportId}toString(){return this.transportId}}class _n{constructor(e,t){this.parentId=e,this.gnpAddress=t,this.isChild=!0,this.transportId=e.transportId}equals(e){if(this.isChild===e.isChild){const t=e;return this.parentId.equals(t.parentId)&&this.gnpAddress===t.gnpAddress}return!1}toString(){return`0x${e=this.gnpAddress,e.toString(16).padStart(2,"0").toUpperCase()}@${this.transportId}`;var e}}var Tn,On,Cn;e.TrackingOptions=void 0,(Tn=e.TrackingOptions||(e.TrackingOptions={})).NO_TRACKING="no-tracking",Tn.TRACK_ERRORS="track-errors",Tn.TRACK_USAGE="track-usage",Tn.TRACK_ALL="track-all",e.ConnectionType=void 0,(On=e.ConnectionType||(e.ConnectionType={}))[On.BLUETOOTH=0]="BLUETOOTH",On[On.INDIRECT=1]="INDIRECT",On[On.USB=2]="USB",e.DeviceType=void 0,(Cn=e.DeviceType||(e.DeviceType={}))[Cn.BASE=0]="BASE",Cn[Cn.HEADSET=1]="HEADSET",Cn[Cn.DESKSTAND=2]="DESKSTAND",Cn[Cn.OTHER=3]="OTHER",Cn[Cn.DONGLE=4]="DONGLE",Cn[Cn.PC=5]="PC",Cn[Cn.EHS=6]="EHS",Cn[Cn.USB=7]="USB",Cn[Cn.SPEAKER_PHONE=8]="SPEAKER_PHONE",Cn[Cn.INDICATOR=9]="INDICATOR",Cn[Cn.MOBILE=10]="MOBILE",Cn[Cn.NONE=11]="NONE",Cn[Cn.LOCAL=12]="LOCAL",Cn[Cn.DISPLAY=13]="DISPLAY",Cn[Cn.HS_CRADLE=14]="HS_CRADLE",Cn[Cn.HS_CRADLE2=15]="HS_CRADLE2",Cn[Cn.MOBILE_IAP=16]="MOBILE_IAP",Cn[Cn.CRADLE=17]="CRADLE",Cn[Cn.VIDEO=18]="VIDEO",Cn[Cn.NOT_GN=252]="NOT_GN",Cn[Cn.ANY_GN=253]="ANY_GN",Cn[Cn.NOT_INIT=254]="NOT_INIT",Cn[Cn.ANY=255]="ANY";class Rn{constructor(e,t,n,r,i,o,s,a,c,u,l){this.id=e,this.type=t,this.hidChannel=n,this.events=r,this.primaryAddress=i,this.sendEvent=o,this.read=s,this.readWithParams=a,this.write=c,this.onDisconnect=u,this.parentConnectionId=l,this.onDisconnect.subscribe({error:O})}static createConnection(e,t,n,r,i,o){const s=r.sendEvent.bind(r),a=r.read.bind(r),c=r.readWithParams.bind(r),u=r.write.bind(r);return new Rn(e,t,n,r.events,r.primaryAddress,s,a,c,u,i,o)}}const Nn=(e=3,t=500)=>n=>n.pipe(Pe(((n,r)=>{const i=r+1;return i>e?Re((()=>n)):Me(i*i*t)})));function Sn(e,t,n,r=1e3,i=3,o=100){return Ge((()=>e.read(t,n,r))).pipe(ft(Nn(i,o)))}function In(e,t,n){const{deviceType:r,address:i}=n;return{transportId:t.transportId,vid:t.vid,pid:Sn(e,zt,i),name:Sn(e,qt,i),serialNumber:Sn(e,Xt,i),capabilities:t.capabilities,deviceType:r,connectionGnpAddress:i}}class An{constructor(e,t,n=In,r=Rn.createConnection,i=mn){this.parentConnection=t,this.connectionCreator=r,this.createChildGnpChannel=i;const o=t.events.pipe(Je((e=>e.command===Gt.DEVICE&&e.subCommand===Mt.ATTACH_EVENT)),Ue((e=>({deviceType:e.payload[0],address:e.payload[1]})))).pipe(Ue(n.bind(null,t,e)));this.connectionEvents=o.pipe(Ue((e=>{const n=Ze(t.events.pipe(dt((t=>t.command===Gt.DEVICE&&t.subCommand===Mt.DETACH_EVENT&&t.payload[1]===e.connectionGnpAddress)),Ue(O)),t.onDisconnect);return{attach:e,detach:n}})),Pe((e=>tt(Ce(e.attach),this.createConnection(e.attach,e.detach)))),Ue((([e,t])=>({event:e,connection:t}))),wt(t.onDisconnect)),t.sendEvent(Vt,[])}createConnection(t,n){const r=t.connectionGnpAddress,i=this.createChildGnpChannel(this.parentConnection,r),o=new _n(this.parentConnection.id,r);return Ce(this.connectionCreator(o,e.ConnectionType.INDIRECT,this.parentConnection.hidChannel,i,n,this.parentConnection.id))}}const Ln={command:Gt.IDENT,subCommand:Mt.TYPE,deserialize:t=>{const{payload:n}=t,r=n[0];if(r<1||r>=n.length)throw new Tt("Cannot get device type.",e.ErrorType.DEVICE_ERROR);return n[1]}};function Dn(t,n,r,i=e.LogLevel.ERROR,o=e.StackLayer.JS_LIB){const s=`${t} ${function(e){if(e instanceof Tt){const t=e;return`JabraError: ${t.message} (type: ${t.type})`}if(e instanceof Error){const t=e;return`Error: ${t.message} (name: ${t.name})`}return`Unknown error: ${e}`}(n)}`;Ot(s,r,i,o)}function Hn(e){return new An(e.event,e.connection).connectionEvents}class Un{constructor(t,n,r=((e,t,n)=>new an(e,t,n)),i=yn,o=Hn,s=Rn.createConnection){this.transport=t,this.logger=n,this.createHidChannel=r,this.createRootGnpChannel=i,this.connectionCreator=s;const a=this.transport.consoleAppEvent.pipe(Je((e=>"attach"===e.event)),Ue(Un.createAttachEvent),nt(((e,t)=>(Dn("",e,this.logger),t)))).pipe(Ue((e=>{const t=this.transport.consoleAppEvent.pipe(Je((e=>"detach"===e.event)),dt((t=>Un.getTransportId(t)===e.transportId)),Ue(O),Et());return t.subscribe(),{attach:e,detach:t}})),Pe((e=>this.createConnection(e.attach,e.detach))),vt()),c=a.pipe(Je((t=>t.event.deviceType===e.DeviceType.DONGLE)),Je((e=>gn.supportsGnpOverHid(e.connection.hidChannel))),Pe((e=>o(e))));this.connectionEvents=Be(a,c).pipe(vt())}static convertToReportType(t){switch(t){case"input":return e.ReportType.INPUT;case"output":return e.ReportType.OUTPUT;case"feature":return e.ReportType.FEATURE;default:throw new Tt(`${t} is not a valid ReportType`,e.ErrorType.UNEXPECTED_ERROR)}}static convertToValueType(t){switch(t){case"absolute":return e.ValueType.ABSOLUTE;case"relative":return e.ValueType.RELATIVE;default:throw new Tt(`${t} Not a valid ValueType`,e.ErrorType.UNEXPECTED_ERROR)}}static createDescriptor(e){return e.map((e=>({reportType:Un.convertToReportType(e.reportType),usagePage:e.usagePage,usage:e.usage,valueType:Un.convertToValueType(e.valueType),reportSize:e.reportSize})))}static getMandatoryField(t,n){const r=t[n];if(void 0===r)throw new Tt(`JSON event lacks required field "${n}: ${JSON.stringify(t)}`,e.ErrorType.UNEXPECTED_ERROR);return r}static getTransportId(e){return Un.getMandatoryField(e,"id")}static createAttachEvent(e){return{transportId:Un.getTransportId(e),vid:Un.getMandatoryField(e,"vid"),pid:Ce(Un.getMandatoryField(e,"pid")),name:Ce(Un.getMandatoryField(e,"name")),serialNumber:Ce(Un.getMandatoryField(e,"serialNumber")),capabilities:Un.createDescriptor(Un.getMandatoryField(e,"descriptor"))}}createConnection(t,n,r=3,i=100){const{capabilities:o,transportId:s}=t,a=new wn(s),c=this.createHidChannel(a,o,this.transport),u=this.createRootGnpChannel(c,this.transport,s,n).pipe(nt(((t,n)=>(t.type&&t.type===e.ErrorType.DEVICE_ERROR&&this.transport.context===e.TransportContext.WEB_HID&&Ot("Child devices are not yet supported when using WebHID.",this.logger,e.LogLevel.WARNING,e.StackLayer.JS_LIB),Ce(new bn)))),vt()),l=u.pipe(Pe((e=>e.read(Ln))),ft(Nn(r,i)),nt((t=>Ce(e.DeviceType.ANY))));return tt(u,l).pipe(wt(n),Ue((([r,i])=>({event:Object.assign(Object.assign({},t),{deviceType:i,connectionGnpAddress:r.primaryAddress}),connection:this.connectionCreator(a,e.ConnectionType.USB,c,r,n)}))))}}var Pn,kn,xn,Fn,Gn;class Mn{constructor(e,t,n,r,i,o){this.vendorId=e,this.productId=t,this.serialNumber=n,this.name=r,this.type=i,kn.set(this,void 0),d(this,kn,new Rt(o,h(Mn,Pn,"m",Fn)),"f"),this.connectionAdded=h(this,kn,"f").itemAdded,this.connectionRemoved=h(this,kn,"f").itemRemoved,this.connectionList=h(this,kn,"f").itemList,this.onDisconnect=h(this,kn,"f").itemList.pipe(yt(1),dt((e=>0===e.length)),Ue(O),vt())}get id(){return on(this.vendorId,this.productId,this.serialNumber)}get currentConnections(){return h(this,kn,"f").getValue()}get browserLabel(){return`${this.vendorId.toString(16).padStart(4,"0")}:${this.productId.toString(16).padStart(4,"0")}`}}Pn=Mn,kn=new WeakMap,Fn=function(e,t){return h(Mn,Pn,"f",xn).indexOf(e.type)-h(Mn,Pn,"f",xn).indexOf(t.type)},xn={value:[e.ConnectionType.USB,e.ConnectionType.INDIRECT,e.ConnectionType.BLUETOOTH]};class Bn{constructor(e){this.deviceObservables=new Rt(e)}static exceptionToUndefined(e){try{return e()}catch(e){if(e instanceof Tt)return;throw e}}connectionExists(e){return void 0!==Bn.exceptionToUndefined((()=>this.findConnectionById(e)))}findConnectionById(t){for(const e of this.deviceObservables.getValue())for(const n of e.currentConnections)if(n.id.equals(t))return n;throw new Tt(`Could not find connection with id ${t.toString()}`,e.ErrorType.UNEXPECTED_ERROR)}findDeviceByDeviceId(e){return this.deviceObservables.getValue().find((t=>t.id.startsWith(e)||e.startsWith(t.id)))}}class Wn{constructor(e,t){this.logger=t;const[n,r]=(i=e.pipe(Je((e=>!this.deviceCollection.connectionExists(e.connection.id))),rt((e=>this.force(e)))),[Je(o=({event:e,pid:t,serialNumber:n})=>!this.deviceCollection.findDeviceByDeviceId(on(e.event.vid,t,n)),s)(Ee(i)),Je(Xe(o,s))(Ee(i))]);var i,o,s;const a=n.pipe(Ue((e=>Wn.createDevice(e,r))));this.deviceCollection=new Bn(a),this.deviceObservables=this.deviceCollection.deviceObservables}force(t){const{name:n,pid:r,serialNumber:i}=t.event,o=t.connection.onDisconnect.pipe((c=Re((()=>new Error(`Connection with ID ${t.connection.id} disconnected`))),p(u)?rt((function(){return c}),u):rt((function(){return c}))));var c,u;return tt(n,r,i).pipe(Ue((([e,n,r])=>({event:t,name:e,pid:n,serialNumber:r}))),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length?B((function(t,n){et(a([t],s(e)))(n)})):x}(o),nt((t=>(Ot(`Failed to retrieve child connection information. Error: ${t}`,this.logger,e.LogLevel.WARNING,e.StackLayer.JS_LIB),ne))))}static createDevice(e,t){const{event:n,pid:r,name:i,serialNumber:o}=e,{vid:s,deviceType:a}=n.event,c=t.pipe(Je((t=>Wn.isSameDevice(e,t))),Ue((e=>e.event.connection))),u=Fe(Ce(n.connection),c);return new Mn(s,r,o,i,a,u)}static isSameDevice(e,t){const n=on(e.event.event.vid,e.pid,e.serialNumber),r=on(t.event.event.vid,t.pid,t.serialNumber);return n.startsWith(r)||r.startsWith(n)}static create(e,t){const n=new Un(e,t);return new Wn(n.connectionEvents)}}class Kn{constructor(e,t,n,r){this.deviceId=e,this.usagePage=t,this.usage=n,this.value=r}}class Vn{constructor(e,t){this.token=e,this.value=t}}!function(e){e.UsageReport=class{constructor(e,t){this.usage=e,this.value=t}}}(Gn||(Gn={}));class Yn{static rawUsageFrom(e,t){return(e<<16|t)>>>0}static usagePageFromRaw(e){return e>>>16}static usageFromRaw(e){return e<<16>>>16}}class jn{constructor(e){this.devices=new Map,this.deviceInputSubscriptions=new Map,this.onHidInput=new Y,this.onGetFeatureReportResponse=new Y;const t=new Y;this.deviceAdded=t;const n=new Y;this.deviceRemoved=n,e.deviceAdded.subscribe((e=>{if(!this.devices.has(e.id)){this.devices.set(e.id,e);const n=e.inputHandler.inputReports.pipe(Ue((t=>new Kn(e.id,Yn.usagePageFromRaw(t.usage),Yn.usageFromRaw(t.usage),t.value)))).subscribe((e=>this.onHidInput.next(e)));this.deviceInputSubscriptions.set(e.id,n),t.next(e)}})),e.deviceRemoved.subscribe((e=>{var t;const r=this.devices.get(e);r&&(this.devices.delete(e),null===(t=this.deviceInputSubscriptions.get(e))||void 0===t||t.unsubscribe(),this.deviceInputSubscriptions.delete(e),n.next(r))}))}sendOutputUsage(e,t,n,r){var i;const o=Yn.rawUsageFrom(t,n);null===(i=this.devices.get(e))||void 0===i||i.outputHandler.sendOutputUsage(o,r)}setFeatureUsage(e,t,n,r){var i;const o=Yn.rawUsageFrom(t,n);null===(i=this.devices.get(e))||void 0===i||i.featureHandler.setFeatureUsage(o,r)}getFeatureUsage(e,t,n,i){var o;return r(this,void 0,void 0,(function*(){const r=Yn.rawUsageFrom(n,i),s=yield null===(o=this.devices.get(e))||void 0===o?void 0:o.featureHandler.getFeatureUsage(r);void 0!==s&&this.onGetFeatureReportResponse.next(new Vn(t,s))}))}}var qn,zn=Jt((function(e){!function(t){var n=function(e,t,n){if(!(e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&e instanceof Buffer))throw new Error("Must specify a valid ArrayBuffer or Buffer.");t=t||0,n=n||e.byteLength||e.length,this._view=new Uint8Array(e.buffer||e,t,n),this.bigEndian=!1};n._scratch=new DataView(new ArrayBuffer(8)),Object.defineProperty(n.prototype,"buffer",{get:function(){return"undefined"!=typeof Buffer?Buffer.from(this._view.buffer):this._view.buffer},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"byteLength",{get:function(){return this._view.length},enumerable:!0,configurable:!1}),n.prototype._setBit=function(e,t){t?this._view[e>>3]|=1<<(7&e):this._view[e>>3]&=~(1<<(7&e))},n.prototype.getBits=function(e,t,n){var r=8*this._view.length-e;if(t>r)throw new Error("Cannot get "+t+" bit(s) from offset "+e+", "+r+" available");for(var i=0,o=0;o<t;){var s=t-o,a=7&e,c=this._view[e>>3],u=Math.min(s,8-a);this.bigEndian?(i<<=u,i|=c>>8-u-a&~(255<<u)):i|=(c>>a&~(255<<u))<<o,e+=u,o+=u}return n?(32!==t&&i&1<<t-1&&(i|=-1^(1<<t)-1),i):i>>>0},n.prototype.setBits=function(e,t,n){var r=8*this._view.length-e;if(n>r)throw new Error("Cannot set "+n+" bit(s) from offset "+e+", "+r+" available");for(var i=0;i<n;){var o,s,a,c=n-i,u=7&e,l=e>>3,h=Math.min(c,8-u);if(this.bigEndian){s=t>>n-i-h&(o=~(-1<<h));var d=8-u-h;a=~(o<<d),this._view[l]=this._view[l]&a|s<<d}else s=t&(o=~(255<<h)),t>>=h,a=~(o<<u),this._view[l]=this._view[l]&a|s<<u;e+=h,i+=h}},n.prototype.getBoolean=function(e){return 0!==this.getBits(e,1,!1)},n.prototype.getInt8=function(e){return this.getBits(e,8,!0)},n.prototype.getUint8=function(e){return this.getBits(e,8,!1)},n.prototype.getInt16=function(e){return this.getBits(e,16,!0)},n.prototype.getUint16=function(e){return this.getBits(e,16,!1)},n.prototype.getInt32=function(e){return this.getBits(e,32,!0)},n.prototype.getUint32=function(e){return this.getBits(e,32,!1)},n.prototype.getFloat32=function(e){return n._scratch.setUint32(0,this.getUint32(e)),n._scratch.getFloat32(0)},n.prototype.getFloat64=function(e){return n._scratch.setUint32(0,this.getUint32(e)),n._scratch.setUint32(4,this.getUint32(e+32)),n._scratch.getFloat64(0)},n.prototype.setBoolean=function(e,t){this.setBits(e,t?1:0,1)},n.prototype.setInt8=n.prototype.setUint8=function(e,t){this.setBits(e,t,8)},n.prototype.setInt16=n.prototype.setUint16=function(e,t){this.setBits(e,t,16)},n.prototype.setInt32=n.prototype.setUint32=function(e,t){this.setBits(e,t,32)},n.prototype.setFloat32=function(e,t){n._scratch.setFloat32(0,t),this.setBits(e,n._scratch.getUint32(0),32)},n.prototype.setFloat64=function(e,t){n._scratch.setFloat64(0,t),this.setBits(e,n._scratch.getUint32(0),32),this.setBits(e+32,n._scratch.getUint32(4),32)},n.prototype.getArrayBuffer=function(e,t){for(var n=new Uint8Array(t),r=0;r<t;r++)n[r]=this.getUint8(e+8*r);return n};var r=function(e,t){return function(){if(this._index+t>this._length)throw new Error("Trying to read past the end of the stream");var n=this._view[e](this._index);return this._index+=t,n}},i=function(e,t){return function(n){this._view[e](this._index,n),this._index+=t}};function o(e,t,n){if(0===t)return"";var r=0,i=[],o=!0,s=!!t;for(t||(t=Math.floor((e._length-e._index)/8));r<t;){var a=e.readUint8();if(0===a&&(o=!1,!s))break;o&&i.push(a),r++}var c=String.fromCharCode.apply(null,i);if(!n)return c;try{return decodeURIComponent(escape(c))}catch(e){return c}}var s=function(e,t,r){var i=e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&e instanceof Buffer;if(!(e instanceof n||i))throw new Error("Must specify a valid BitView, ArrayBuffer or Buffer");this._view=i?new n(e,t,r):e,this._index=0,this._startIndex=0,this._length=8*this._view.byteLength};Object.defineProperty(s.prototype,"index",{get:function(){return this._index-this._startIndex},set:function(e){this._index=e+this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"length",{get:function(){return this._length-this._startIndex},set:function(e){this._length=e+this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"bitsLeft",{get:function(){return this._length-this._index},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"byteIndex",{get:function(){return Math.ceil(this._index/8)},set:function(e){this._index=8*e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buffer",{get:function(){return this._view.buffer},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"bigEndian",{get:function(){return this._view.bigEndian},set:function(e){this._view.bigEndian=e},enumerable:!0,configurable:!1}),s.prototype.readBits=function(e,t){var n=this._view.getBits(this._index,e,t);return this._index+=e,n},s.prototype.writeBits=function(e,t){this._view.setBits(this._index,e,t),this._index+=t},s.prototype.readBoolean=r("getBoolean",1),s.prototype.readInt8=r("getInt8",8),s.prototype.readUint8=r("getUint8",8),s.prototype.readInt16=r("getInt16",16),s.prototype.readUint16=r("getUint16",16),s.prototype.readInt32=r("getInt32",32),s.prototype.readUint32=r("getUint32",32),s.prototype.readFloat32=r("getFloat32",32),s.prototype.readFloat64=r("getFloat64",64),s.prototype.writeBoolean=i("setBoolean",1),s.prototype.writeInt8=i("setInt8",8),s.prototype.writeUint8=i("setUint8",8),s.prototype.writeInt16=i("setInt16",16),s.prototype.writeUint16=i("setUint16",16),s.prototype.writeInt32=i("setInt32",32),s.prototype.writeUint32=i("setUint32",32),s.prototype.writeFloat32=i("setFloat32",32),s.prototype.writeFloat64=i("setFloat64",64),s.prototype.readASCIIString=function(e){return function(e,t){return o(e,t,!1)}(this,e)},s.prototype.readUTF8String=function(e){return function(e,t){return o(e,t,!0)}(this,e)},s.prototype.writeASCIIString=function(e,t){!function(e,t,n){for(var r=n||t.length+1,i=0;i<r;i++)e.writeUint8(i<t.length?t.charCodeAt(i):0)}(this,e,t)},s.prototype.writeUTF8String=function(e,t){!function(e,t,n){for(var r=function(e){var t,n,r=[];for(t=0;t<e.length;t++)(n=e.charCodeAt(t))<=127?r.push(n):n<=2047?(r.push(n>>6|192),r.push(63&n|128)):n<=65535?(r.push(n>>12|224),r.push(n>>6&63|128),r.push(63&n|128)):(r.push(n>>18|240),r.push(n>>12&63|128),r.push(n>>6&63|128),r.push(63&n|128));return r}(t),i=n||r.length+1,o=0;o<i;o++)e.writeUint8(o<r.length?r[o]:0)}(this,e,t)},s.prototype.readBitStream=function(e){var t=new s(this._view);return t._startIndex=this._index,t._index=this._index,t.length=e,this._index+=e,t},s.prototype.writeBitStream=function(e,t){var n;for(t||(t=e.bitsLeft);t>0;)n=Math.min(t,32),this.writeBits(e.readBits(n),n),t-=n},s.prototype.readArrayBuffer=function(e){var t=this._view.getArrayBuffer(this._index,e);return this._index+=8*e,t},s.prototype.writeArrayBuffer=function(e,t){this.writeBitStream(new s(e),8*t)},e.exports&&(e.exports={BitView:n,BitStream:s})}()}));class $n{constructor(e,t){this.device=e,this.inputReportDescriptors=t;const n=new Map;this.inputReportDescriptors.forEach((e=>{e.usages.forEach(((e,t)=>{n.set(t,[0])}))}));const r=new Y;this.inputReports=r,this.device.oninputreport=e=>{if(e.currentTarget!==this.device)return;const t=this.inputReportDescriptors.get(e.reportId);if(!t)return;const i=new zn.BitView(e.data.buffer);i.bigEndian=!1;Array.from(t.usages.entries(),$n.makeWebHidInputReport.bind(this,i)).filter((e=>$n.compareReportToCachedValue(e,n))).forEach((e=>{n.set(e.usage,e.value),r.next(e)}))}}static makeWebHidInputReport(e,[t,n]){let r=n.offset,i=n.size,o=[];for(;i>0;)o.push(e.getBits(r,Math.min(i,8))),r+=8,i-=8;return o=n.onInput(o),new Gn.UsageReport(t,o)}static compareReportToCachedValue(e,t){const n=t.get(e.usage);if(!n)return!0;if(n.length!==e.value.length)return!0;return n.some(((t,n)=>e.value[n]!==t))}}class Qn{constructor(e){this.report=e}reportSizeInBits(){return this.report.fullReportSize}reportSizeInBytes(){return Math.ceil(this.reportSizeInBits()/8)}createBitViewIfNeeded(){if(!this.bitView){const e=this.reportSizeInBytes(),t=new ArrayBuffer(e);this.bitView=new zn.BitView(t),this.bitView.bigEndian=!1}return this.bitView}getUsageInformationOrThrow(t){if(!this.report.usages.has(t))throw new Tt(`Unable to write usage (0x${t.toString(16).padStart(8,"0")}). It is not known by the device.`,e.ErrorType.UNEXPECTED_ERROR);return this.report.usages.get(t)}writeUsage(e,t){const n=this.getUsageInformationOrThrow(e);let r=this.createBitViewIfNeeded();if(!n.absolute){const e=function(e){const t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}(r.buffer);r=new zn.BitView(e)}let i=n.offset,o=n.size;return t.forEach((e=>{r.setBits(i,e,o),i+=8,o-=8})),r.buffer}}class Xn{constructor(e,t,n){this.device=e,this.outputReports=t,this.outputUsages=n,this.outputCacheByReportId=new Map}getReportIdForUsage(t){if(!this.outputUsages.has(t))throw new Tt(`Unknown usagePage: 0x${t.toString(16).padStart(8,"0")}.`,e.ErrorType.UNEXPECTED_ERROR);return this.outputUsages.get(t)}getReportLayoutForReportId(t){if(!this.outputReports.has(t))throw new Tt(`Unknown reportId: ${t}.`,e.ErrorType.UNEXPECTED_ERROR);return this.outputReports.get(t)}getUsageInReportForUsage(t){const n=this.getReportIdForUsage(t),r=this.getReportLayoutForReportId(n);if(!r.usages.has(t))throw new Tt(`Unknown rawUsage inside ReportLayout: ${t}.`,e.ErrorType.UNEXPECTED_ERROR);return r.usages.get(t)}getOrCreateCacheForReportId(e){if(!this.outputCacheByReportId.has(e)){const t=this.getReportLayoutForReportId(e),n=new Qn(t);this.outputCacheByReportId.set(e,n)}return this.outputCacheByReportId.get(e)}sendOutputUsage(e,t){return r(this,void 0,void 0,(function*(){const n=this.getReportIdForUsage(e),r=this.getOrCreateCacheForReportId(n),i=this.getUsageInReportForUsage(e).onOutput(t),o=r.writeUsage(e,i);yield this.device.sendReport(n,o)}))}}class Jn{constructor(e=new Map,t=0){this.usages=e,this.fullReportSize=t}}class Zn{constructor(e,t,n){this.offset=e,this.size=t,this.absolute=n}onInput(e){return e}onOutput(e){return e}}class er{constructor(e,t,n,r){this.offset=e,this.size=t,this.absolute=n,this.rangeIndex=r}onInput(t){if(t.length>1)throw new Tt(`Usages of type ${er.name} should not hold more than 1 byte of information.`,e.ErrorType.UNEXPECTED_ERROR);return t[0]===this.rangeIndex?[1]:[0]}onOutput(t){if(t.length>1)throw new Tt(`Usages of type ${er.name} should not hold more than 1 byte of information.`,e.ErrorType.UNEXPECTED_ERROR);return t[0]>0?[this.rangeIndex]:t}}class tr{constructor(e){const t=new Map;this.buildReportLayouts(e.collections,"input",t),this.inputReports=t,this.inputUsages=tr.buildUsageMap(t);const n=new Map;this.buildReportLayouts(e.collections,"output",n),this.outputReports=n,this.outputUsages=tr.buildUsageMap(n);const r=new Map;this.buildReportLayouts(e.collections,"feature",r),this.featureReports=r,this.featureUsages=tr.buildUsageMap(r)}static buildUsageMap(e){const t=new Map;return e.forEach(((e,n)=>{e.usages.forEach(((e,r)=>{t.set(r,n)}))})),t}buildReportLayouts(e,t,n){e.forEach((e=>{var r;null===(r=tr.reportsOfType(e,t))||void 0===r||r.forEach((e=>{var t;const r=e.reportId;n.has(r)||n.set(r,new Jn);const i=n.get(r);let o=0;null===(t=e.items)||void 0===t||t.forEach((e=>{let t=e.usages;if(e.isRange){t=[];for(let n=e.usageMinimum;n<=e.usageMaximum;n+=1)t.push(n)}let n,r=o;if(e.isRange&&e.isArray&&(n=1),t.length>0){if(t.filter((e=>i.usages.has(e))).length===t.length)return}t.forEach((t=>{let o;o=n?new er(r,e.reportSize,e.isAbsolute,n):new Zn(r,e.reportSize,e.isAbsolute),i.usages.set(t,o),n?n+=1:r+=e.reportSize}));const s=e.reportCount*e.reportSize;i.fullReportSize+=s,o+=s}))})),e.children&&this.buildReportLayouts(e.children,t,n)}))}static reportsOfType(t,n){if("input"===n)return t.inputReports;if("output"===n)return t.outputReports;if("feature"===n)return t.featureReports;throw new Tt(`Unexpected report type: ${n}!`,e.ErrorType.UNEXPECTED_ERROR)}}class nr{constructor(e,t,n){this.device=e,this.featureReports=t,this.featureUsages=n,this.outputCacheByReportId=new Map}getReportIdForUsage(t){if(!this.featureUsages.has(t))throw new Tt(`Unknown usagePage: 0x${t.toString(16).padStart(8,"0")}.`,e.ErrorType.UNEXPECTED_ERROR);return this.featureUsages.get(t)}getReportLayoutForReportId(t){if(!this.featureReports.has(t))throw new Tt(`Unknown reportId: ${t}.`,e.ErrorType.UNEXPECTED_ERROR);return this.featureReports.get(t)}getUsageInReportForUsage(t){const n=this.getReportIdForUsage(t),r=this.getReportLayoutForReportId(n);if(!r.usages.has(t))throw new Tt(`Unknown rawUsage inside ReportLayout: ${t}.`,e.ErrorType.UNEXPECTED_ERROR);return r.usages.get(t)}getOrCreateCacheForReportId(e){if(!this.outputCacheByReportId.has(e)){const t=this.getReportLayoutForReportId(e),n=new Qn(t);this.outputCacheByReportId.set(e,n)}return this.outputCacheByReportId.get(e)}getFeatureUsage(e){return r(this,void 0,void 0,(function*(){const t=this.getReportIdForUsage(e),n=yield this.device.receiveFeatureReport(t),r=this.getUsageInReportForUsage(e),i=[];for(let e=1;e<=Math.ceil(r.size/8);e+=1)i.push(n.getUint8(e));return i}))}setFeatureUsage(e,t){return r(this,void 0,void 0,(function*(){const n=this.getReportIdForUsage(e),r=this.getOrCreateCacheForReportId(n),i=this.getUsageInReportForUsage(e).onOutput(t),o=r.writeUsage(e,i);yield this.device.sendFeatureReport(n,o)}))}}class rr{constructor(e,t,n,r){this.name=e,this.vid=t,this.pid=n,this.id=r.sessionId;const i=new tr(r);this.inputReports=i.inputReports,this.outputReports=i.outputReports,this.featureReports=i.featureReports,this.inputHandler=new $n(r,i.inputReports),this.outputHandler=new Xn(r,i.outputReports,i.outputUsages),this.featureHandler=new nr(r,i.featureReports,i.featureUsages)}}!function(e){e[e.VENDOR_ID=2830]="VENDOR_ID",e.PAIRING_CHANNEL="jabra-webhid-pairing-channel"}(qn||(qn={}));class ir{constructor(e,t){this.hid=e,this.broadcastChannel=t,this.deviceAddedSubject=new Y,this.deviceAdded=this.deviceAddedSubject,this.deviceRemovedSubject=new Y,this.deviceRemoved=this.deviceRemovedSubject}setupListeners(){this.hid.onconnect=e=>this.onConnect(e),this.hid.ondisconnect=e=>this.onDisconnect(e),this.broadcastChannel.onmessage=()=>this.getPairedDevices()}addNewDevice(e){return r(this,void 0,void 0,(function*(){if(ir.hasGeneratedDeviceId(e))return;ir.getOrGenerateDeviceId(e);const t=new rr(e.productName,e.vendorId,e.productId,e);e.opened||(yield e.open()),this.deviceAddedSubject.next(t)}))}onConnect(e){return r(this,void 0,void 0,(function*(){setTimeout((()=>r(this,void 0,void 0,(function*(){yield this.addNewDevice(e.device)}))),1e3)}))}onDisconnect(e){const t=ir.getOrGenerateDeviceId(e.device);this.deviceRemovedSubject.next(t)}getPairedDevices(){return r(this,void 0,void 0,(function*(){(yield this.hid.getDevices()).filter((e=>e.vendorId===qn.VENDOR_ID)).forEach((e=>r(this,void 0,void 0,(function*(){yield this.addNewDevice(e)}))))}))}static hasGeneratedDeviceId(e){return void 0!==e.sessionId}static getOrGenerateDeviceId(e){if(!ir.hasGeneratedDeviceId(e)){const t=new tn(4).toString();return e.sessionId=t,t}return e.sessionId}}class or{constructor(e,t,n,r,i){this.usagePage=e,this.usage=t,this.valueType=n,this.reportType=r,this.reportSize=i}}class sr{constructor(e){this.deviceManagement=e,this.events=new Y,this.setupDeviceHandler()}setupDeviceHandler(){this.deviceManagement.deviceAdded.subscribe((e=>{this.events.next({event:"attach",id:e.id,vid:e.vid,pid:e.pid,name:e.name,serialNumber:e.id,descriptor:sr.generateDescriptors(e)})})),this.deviceManagement.deviceRemoved.subscribe((e=>{this.events.next({event:"detach",id:e.id})})),this.deviceManagement.onHidInput.subscribe((e=>{const t=1===e.value.length?e.value[0]:e.value;this.events.next({event:"hid-input",id:e.deviceId,usagePage:e.usagePage,usage:e.usage,value:t})})),this.deviceManagement.onGetFeatureReportResponse.subscribe((e=>{const t=1===e.value.length?e.value[0]:e.value;this.events.next({event:"response-hid-feature",token:e.token,value:t})}))}static generateDescriptors(e){let t=sr.convertReportLayoutsToDescriptors(e.inputReports,"input");return t=t.concat(sr.convertReportLayoutsToDescriptors(e.outputReports,"output")),t=t.concat(sr.convertReportLayoutsToDescriptors(e.featureReports,"feature")),t}static convertReportLayoutsToDescriptors(e,t){const n=[];return e.forEach((e=>{e.usages.forEach(((e,r)=>{const i=Yn.usagePageFromRaw(r);65280===i&&"output"===t||n.push(new or(i,Yn.usageFromRaw(r),e.absolute?"absolute":"relative",t,Math.ceil(e.size/8)))}))})),n}}class ar{constructor(e,t,n){this.deviceManagement=e,this.callLockManagement=t,this.logger=n,this.gnpLockAcquired=new Y,this.callLockAcquired=new Y,this.softphoneInFocus=new Y,this.events=Be(this.gnpLockAcquired.pipe(at(0)),this.callLockAcquired.pipe(at(0)),this.softphoneInFocus)}onNewSdkInput(t){if(!t.action)throw new Tt("Provided input has no action property.",e.ErrorType.UNEXPECTED_ERROR);switch(t.action){case"hid-output":{const e=Array.isArray(t.value)?t.value:[t.value];this.deviceManagement.sendOutputUsage(t.id,t.usagePage,t.usage,e);break}case"request-hid-feature":this.deviceManagement.getFeatureUsage(t.id,t.token,t.usagePage,t.usage);break;case"set-hid-feature":{const e=Array.isArray(t.value)?t.value:[t.value];this.deviceManagement.setFeatureUsage(t.id,t.usagePage,t.usage,e);break}case"request-gnp-lock":this.gnpLockAcquired.next({event:"response-gnp-lock",token:t.token}),Ot("GNP lock requested with WebHID backend. This should not happen!",this.logger,e.LogLevel.ERROR,e.StackLayer.NATIVE_CONSOLE);break;case"release-gnp-lock":break;case"request-call-lock":this.callLockManagement.tryAcquireCallLock(t.id).then((e=>{this.callLockAcquired.next({event:"response-call-lock",id:t.id,acquired:e})}));break;case"release-call-lock":this.callLockManagement.releaseCallLock(t.id);break;case"set-softphone-info":this.softphoneInFocus.next({event:"softphone-in-focus",infocus:!1}),this.softphoneInFocus.complete();break;default:throw new Tt(`Provided action is not recognized - ${t.action}.`,e.ErrorType.UNEXPECTED_ERROR)}}}class cr{constructor(e,t,n){this.navigatorLocks=e,this.logger=n,this.releaseGlobalLock=null,this.localLockedDevices=new Set,t.deviceRemoved.subscribe((e=>{this.localLockedDevices.has(e.id)&&this.releaseCallLock(e.id)}))}tryAcquireCallLock(e){return r(this,void 0,void 0,(function*(){return!(yield this.checkWebLocksSupport())||(this.localLockedDevices.size>0&&!this.localLockedDevices.has(e)?(this.localLockedDevices.add(e),!0):new Promise((t=>{this.navigatorLocks.request("jabra-call-lock",{ifAvailable:!0},(n=>n?(this.localLockedDevices.add(e),t(!0),new Promise((e=>{this.releaseGlobalLock=e}))):(t(!1),Promise.resolve())))})))}))}releaseCallLock(e){this.localLockedDevices.delete(e),this.releaseGlobalLock&&0===this.localLockedDevices.size&&this.releaseGlobalLock()}checkWebLocksSupport(){return r(this,void 0,void 0,(function*(){const t=yield this.navigatorLocks.query().catch((()=>{Ot("WebLocks unsupported. The cross-tab call lock is disabled.",this.logger,e.LogLevel.WARNING)}));return Boolean(t)}))}}class ur{constructor(e,t,n,r){this.scanner=e,this.deviceEventHandler=t,this.sdkInputEventHandler=n,this.logger=r,this.readyEvent=new Y,this.events=new G,this.events=Be(this.readyEvent,this.deviceEventHandler.events,this.sdkInputEventHandler.events)}start(){this.readyEvent.next({event:"ready",version:null,jabraDirectInstalled:!1}),this.readyEvent.complete(),this.scanner.getPairedDevices(),this.scanner.setupListeners()}sendMessage(e){var t;null===(t=this.sdkInputEventHandler)||void 0===t||t.onNewSdkInput(e)}}var lr,hr,dr,pr,fr,vr,gr,Er,yr,mr=Object.freeze({__proto__:null,initHandler:function(t){if("undefined"==typeof window)throw new Tt("WebHID is not supported outside of a browser environment.",e.ErrorType.INIT_ERROR);if(void 0===window.navigator||void 0===window.navigator.hid)throw new Tt("WebHID is not supported on this platform/browser.",e.ErrorType.INIT_ERROR);if(void 0===window.navigator.locks)throw new Tt("WebLocks is not supported on this platform/browser.",e.ErrorType.INIT_ERROR);const n=window.navigator.hid,r=window.navigator.locks,i=new BroadcastChannel(qn.PAIRING_CHANNEL),o=new ir(n,i),s=new jn(o),a=new sr(s),c=new ar(s,new cr(r,s,t));return new ur(o,a,c,t)}});e.SignalType=void 0,(lr=e.SignalType||(e.SignalType={}))[lr.HOOK_SWITCH=32]="HOOK_SWITCH",lr[lr.GN_PSEUDO_HOOK_SWITCH=65531]="GN_PSEUDO_HOOK_SWITCH",lr[lr.FLASH=33]="FLASH",lr[lr.ALT_HOLD=35]="ALT_HOLD",lr[lr.REDIAL=36]="REDIAL",lr[lr.ONLINE=42]="ONLINE",lr[lr.SPEAKER_PHONE=43]="SPEAKER_PHONE",lr[lr.PHONE_MUTE=47]="PHONE_MUTE",lr[lr.SEND=49]="SEND",lr[lr.SPEED_DIAL=80]="SPEED_DIAL",lr[lr.VOICE_MAIL=112]="VOICE_MAIL",lr[lr.ANSWER_ON_OFF=116]="ANSWER_ON_OFF",lr[lr.LINE_BUSY=151]="LINE_BUSY",lr[lr.RINGER=158]="RINGER",lr[lr.PHONE_KEY_0=176]="PHONE_KEY_0",lr[lr.PHONE_KEY_1=177]="PHONE_KEY_1",lr[lr.PHONE_KEY_2=178]="PHONE_KEY_2",lr[lr.PHONE_KEY_3=179]="PHONE_KEY_3",lr[lr.PHONE_KEY_4=180]="PHONE_KEY_4",lr[lr.PHONE_KEY_5=181]="PHONE_KEY_5",lr[lr.PHONE_KEY_6=182]="PHONE_KEY_6",lr[lr.PHONE_KEY_7=183]="PHONE_KEY_7",lr[lr.PHONE_KEY_8=184]="PHONE_KEY_8",lr[lr.PHONE_KEY_9=185]="PHONE_KEY_9",lr[lr.PHONE_KEY_STAR=186]="PHONE_KEY_STAR",lr[lr.PHONE_KEY_POUND=187]="PHONE_KEY_POUND",lr[lr.ALT_VOLUME_UP=233]="ALT_VOLUME_UP",lr[lr.ALT_VOLUME_DOWN=234]="ALT_VOLUME_DOWN",lr[lr.REJECT_CALL=65533]="REJECT_CALL";class br{constructor(e,t,n){this.type=e,this.value=t,this.valueType=n}toString(){return void 0===e.SignalType[this.type]?`Unknown signal: type: ${this.type}, value: ${this.value}, valueType: ${this.valueType}`:`Signal: type: ${e.SignalType[this.type]}, value: ${this.value}, valueType: ${this.valueType}`}}!function(e){e[e.BUTTON=9]="BUTTON",e[e.CONSUMER=12]="CONSUMER",e[e.LED=8]="LED",e[e.TELEPHONY=11]="TELEPHONY",e[e.GN_CONSUMER=65312]="GN_CONSUMER",e[e.GN_EXT_BUTTONS=65360]="GN_EXT_BUTTONS",e[e.GN_LED=65344]="GN_LED",e[e.GN_MISC=65376]="GN_MISC",e[e.GN_TELEPHONY=65328]="GN_TELEPHONY"}(hr||(hr={})),function(e){e[e.MUTE=9]="MUTE",e[e.OFF_HOOK=23]="OFF_HOOK",e[e.RING=24]="RING",e[e.MESSAGE_WAIT=25]="MESSAGE_WAIT",e[e.HOLD=32]="HOLD",e[e.MIC_MUTE=33]="MIC_MUTE",e[e.ONLINE=42]="ONLINE",e[e.HID_OFFLINE=43]="HID_OFFLINE"}(dr||(dr={})),function(e){e[e.HOOK_SWITCH=32]="HOOK_SWITCH",e[e.FLASH=33]="FLASH",e[e.HOLD=35]="HOLD",e[e.REDIAL=36]="REDIAL",e[e.ONLINE=42]="ONLINE",e[e.SPEAKER_PHONE=43]="SPEAKER_PHONE",e[e.MUTE=47]="MUTE",e[e.HID_SEND=49]="HID_SEND",e[e.SPEED_DIAL=80]="SPEED_DIAL",e[e.VOICE_MAIL=112]="VOICE_MAIL",e[e.ANSWER_ON_OFF=116]="ANSWER_ON_OFF",e[e.LINE_BUSY=151]="LINE_BUSY",e[e.RINGER=158]="RINGER",e[e.PHONE_KEY_0=176]="PHONE_KEY_0",e[e.PHONE_KEY_1=177]="PHONE_KEY_1",e[e.PHONE_KEY_2=178]="PHONE_KEY_2",e[e.PHONE_KEY_3=179]="PHONE_KEY_3",e[e.PHONE_KEY_4=180]="PHONE_KEY_4",e[e.PHONE_KEY_5=181]="PHONE_KEY_5",e[e.PHONE_KEY_6=182]="PHONE_KEY_6",e[e.PHONE_KEY_7=183]="PHONE_KEY_7",e[e.PHONE_KEY_8=184]="PHONE_KEY_8",e[e.PHONE_KEY_9=185]="PHONE_KEY_9",e[e.PHONE_KEY_STAR=186]="PHONE_KEY_STAR",e[e.PHONE_KEY_POUND=187]="PHONE_KEY_POUND",e[e.HID_ALT_VOLUME_UP=233]="HID_ALT_VOLUME_UP",e[e.HID_ALT_VOLUME_DOWN=234]="HID_ALT_VOLUME_DOWN",e[e.GN_PSEUDO_HOOK_SWITCH=65531]="GN_PSEUDO_HOOK_SWITCH",e[e.GN_OUT_OF_RANGE=65532]="GN_OUT_OF_RANGE",e[e.GN_REJECT_CALL=65533]="GN_REJECT_CALL",e[e.GN_TELEPHONY_CONT_SET=65535]="GN_TELEPHONY_CONT_SET"}(pr||(pr={}));class wr{constructor(e,t,n,r,i){this.hidChannel=e,this.onDisconnect=t,this.isSoftphoneInFocus=n,this.lockHeld=r,this.logger=i,this.cachedSignals=new Map}setup(){const e=this.filter().pipe(vt());return e.subscribe(),e}filter(){const t=this.hidChannel.input.pipe(Je((e=>e.usagePage===hr.GN_TELEPHONY&&!e.isArray())),Pe((t=>{const n=this.hidChannel.findDescriptor(t.usagePage,t.usage,e.ReportType.INPUT);return(null==n?void 0:n.valueType)?Ce(Object.assign(Object.assign({},t),{valueType:n.valueType})):(Dn("",new Tt(`Unable to find value-type in descriptor for UsagePage: ${t.usagePage} and Usage: ${t.usage}`,e.ErrorType.FEATURE_NOT_SUPPORTED),this.logger),ne)})),Je((t=>{if(t.valueType===e.ValueType.RELATIVE)return Boolean(t.value);return this.cachedSignals.get(t.usage)!==t.value})),_t((e=>{this.cachedSignals.set(e.usage,e.value)})),wt(this.onDisconnect),vt()),n=[e.SignalType.HOOK_SWITCH,e.SignalType.REDIAL],r=t.pipe(cn(this.isSoftphoneInFocus),Je((e=>n.includes(e.usage)&&!this.lockHeld.getValue())));return Be(t.pipe(Je((e=>this.lockHeld.getValue()))),r).pipe(Ue((e=>new br(e.usage,0!==e.value,e.valueType))),nt((e=>(Ot(e.message,this.logger),ne))))}}class _r{constructor(e,t,n,r,i,o){this.device=e,this.onDisconnect=n,fr.set(this,void 0),vr.set(this,new q(!1)),gr.set(this,void 0),Er.set(this,!1),this.deviceSignals=new Y,d(this,fr,r,"f"),h(this,fr,"f").lockHeld.subscribe(h(this,vr,"f")),d(this,gr,t,"f"),this.onDisconnect.pipe(dt(),Ue((()=>!0))).subscribe((e=>{d(this,Er,e,"f")}));const s=new wr(h(this,gr,"f"),this.onDisconnect,i,h(this,vr,"f"),o);this.deviceSignals=s.setup()}checkCallLockHeld(t){if(!h(this,vr,"f").getValue())throw new Tt(t,e.ErrorType.SDK_USAGE_ERROR)}checkCallLockNotHeld(t){if(h(this,vr,"f").getValue())throw new Tt(t,e.ErrorType.SDK_USAGE_ERROR)}checkHasDisconnected(){if(h(this,Er,"f"))throw new Tt("CallControl cannot be performed as the connection has disconnected.",e.ErrorType.SDK_USAGE_ERROR)}takeCallLock(){return this.checkHasDisconnected(),this.checkCallLockNotHeld("Trying to take the call lock, but it is already held!"),Se(h(this,fr,"f").tryTakeCallLock())}releaseCallLock(){this.checkHasDisconnected(),this.checkCallLockHeld("Trying to release the call lock, but it is not held!"),h(this,fr,"f").releaseCallLock()}offHook(t){this.checkHasDisconnected(),this.checkCallLockHeld("Calls can only be started and stopped when the call lock is held.");const n=h(this,gr,"f").findDescriptor(hr.GN_LED,dr.OFF_HOOK,e.ReportType.OUTPUT);if(!n)throw new Tt(`Device ${this.device.name} does not support any offHook functionality.`,e.ErrorType.FEATURE_NOT_SUPPORTED);const r=t?1:0;h(this,gr,"f").output(n.usagePage,n.usage,r)}ring(t){this.checkHasDisconnected(),this.checkCallLockHeld("The ringer state can only be modified when the call lock is held.");const n=h(this,gr,"f").findDescriptor(hr.GN_LED,dr.RING,e.ReportType.OUTPUT),r=h(this,gr,"f").findDescriptor(hr.GN_TELEPHONY,pr.RINGER,e.ReportType.OUTPUT);if(!n&&!r)throw new Tt(`Device ${this.device.name} does not support any ring functionality.`,e.ErrorType.FEATURE_NOT_SUPPORTED);if(r){const e=t?1:0;h(this,gr,"f").output(r.usagePage,r.usage,e)}if(n){const e=t?1:0;h(this,gr,"f").output(n.usagePage,n.usage,e)}}mute(t){this.checkHasDisconnected(),this.checkCallLockHeld("The mute state can only be modified when the call lock is held.");let n=h(this,gr,"f").findDescriptor(hr.GN_LED,dr.MIC_MUTE,e.ReportType.OUTPUT);if(n||(n=h(this,gr,"f").findDescriptor(hr.GN_LED,dr.MUTE,e.ReportType.OUTPUT)),!n)throw new Tt(`Device ${this.device.name} does not support any mute functionality.`,e.ErrorType.FEATURE_NOT_SUPPORTED);const r=t?1:0;h(this,gr,"f").output(n.usagePage,n.usage,r)}hold(t){this.checkHasDisconnected(),this.checkCallLockHeld("The hold state can only be modified when the call lock is held.");const n=h(this,gr,"f").findDescriptor(hr.GN_LED,dr.HOLD,e.ReportType.OUTPUT);if(!n)throw new Tt(`Device ${this.device.name} does not support hold functionality.`,e.ErrorType.FEATURE_NOT_SUPPORTED);const r=t?1:0;h(this,gr,"f").output(n.usagePage,n.usage,r)}}fr=new WeakMap,vr=new WeakMap,gr=new WeakMap,Er=new WeakMap,function(e){e[e.STD_TELEPHONY=0]="STD_TELEPHONY",e[e.GN_TELEPHONY=1]="GN_TELEPHONY"}(yr||(yr={}));const Tr={[Ut.SKYPE]:yr.GN_TELEPHONY,[Ut.CISCO]:yr.GN_TELEPHONY,[Ut.AVAYA]:yr.GN_TELEPHONY,[Ut.SIEMENS]:yr.GN_TELEPHONY,[Ut.IBM]:yr.GN_TELEPHONY,[Ut.AASTRA]:yr.GN_TELEPHONY,[Ut.JABRA]:yr.GN_TELEPHONY,[Ut.NEC]:yr.GN_TELEPHONY,[Ut.SHORETEL]:yr.GN_TELEPHONY,[Ut.MS_OC]:yr.STD_TELEPHONY,[Ut.ALCATEL]:yr.STD_TELEPHONY,[Ut.OTHER]:yr.STD_TELEPHONY,[Ut.NORTEL]:null,[Ut.GENERIC]:null};function Or(e,t){const n=e.read($t).pipe(Ue((e=>Tr[e]===t))),r=e.read(new jt).pipe(Ue((e=>e.find((e=>Tr[e]===t))))).pipe(Ue((t=>t?e.write($t,t):Ce(!1))),bt());return n.pipe((i=Ce(!0),o=r,e=>e.pipe(Ue((e=>e?i:o)),bt())));var i,o}class Cr{constructor(e,t,n){this.connectionCallLock=e,this.device=t,this.logger=n,this.lockHeld=new q(!1),this.currentLocks=new q(new Set),this.lockReleaseEvent=new Y}tryTakeCallLock(){const{currentConnections:e}=this.device,t=new Set,n=Ge((()=>Oe(e).pipe(rt((e=>this.takeSingleCallLock(e).pipe(nt((e=>(Dn("DeviceCallLock:",e,this.logger),Ce(""))))))),_t((e=>t.add(e)))))).pipe(function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Je((function(t,n){return e(t,n,r)})):x,pt(1),n?it(t):lt((function(){return new Ne})))}}(),Ue((n=>(t.delete(""),this.currentLocks.next(t),t.size!==e.length?(this.releaseCallLock(),!1):(this.lockHeld.next(!0),!0)))),Et());return n.subscribe((e=>{e&&(this.acquireLockOnNextConnectionEmit(),this.releaseLockOnRemovedConnectionEmit())})),n}acquireLockOnNextConnectionEmit(){this.device.connectionAdded.pipe(wt(this.lockReleaseEvent)).subscribe((t=>{this.takeSingleCallLock(t).pipe(wt(this.lockReleaseEvent),Ue((e=>(this.currentLocks.getValue().add(e),this.currentLocks.next(this.currentLocks.getValue()),O))),ft(Nn())).subscribe({error:t=>{Ot(`Failed to acquire the call lock on a new connection.\n              Another softphone running an old SDK has most likely acquired this lock.\n              Full error: ${t}`,this.logger,e.LogLevel.WARNING,e.StackLayer.JS_LIB)}})}))}releaseLockOnRemovedConnectionEmit(){this.device.connectionRemoved.pipe(wt(this.lockReleaseEvent)).subscribe((e=>this.releaseSingleCallLock(e.id.transportId)))}takeSingleCallLock(t){return Ge((()=>this.connectionCallLock.tryTakeCallLock(t.id.transportId))).pipe(Ue((n=>n.acquired?Ce(n.transportId):Re((()=>new Tt(`Failed to acquire call lock on connection ${t.id.transportId}`,e.ErrorType.SDK_USAGE_ERROR))))),bt())}releaseCallLock(){this.lockReleaseEvent.next();[...this.currentLocks.getValue()].forEach((e=>{this.releaseSingleCallLock(e)})),this.currentLocks.getValue().clear(),this.currentLocks.next(this.currentLocks.getValue())}releaseSingleCallLock(e){this.connectionCallLock.releaseCallLock(e),this.currentLocks.getValue().delete(e),this.currentLocks.next(this.currentLocks.getValue()),0!==this.currentLocks.getValue().size&&0!==this.device.currentConnections.length||(this.lockReleaseEvent.next(),this.lockHeld.next(!1))}}class Rr{constructor(e){this.transport=e}tryTakeCallLock(e){const t={action:"request-call-lock",id:e};return this.transport.writeAction(t),this.transport.consoleAppEvent.pipe(Je((t=>"response-call-lock"===t.event&&t.id===e)),Ue((e=>({transportId:e.id,acquired:e.acquired}))),dt())}releaseCallLock(e){const t={action:"release-call-lock",id:e};this.transport.writeAction(t)}}const Nr=[{usagePage:hr.GN_LED,usage:dr.OFF_HOOK,reportType:e.ReportType.OUTPUT},{usagePage:hr.GN_LED,usage:dr.RING,reportType:e.ReportType.OUTPUT},{usagePage:hr.GN_TELEPHONY,usage:pr.RINGER,reportType:e.ReportType.OUTPUT},{usagePage:hr.GN_LED,usage:dr.MIC_MUTE,reportType:e.ReportType.OUTPUT},{usagePage:hr.GN_LED,usage:dr.MUTE,reportType:e.ReportType.OUTPUT},{usagePage:hr.GN_LED,usage:dr.HOLD,reportType:e.ReportType.OUTPUT}],Sr=[e.ConnectionType.USB,e.ConnectionType.INDIRECT,e.ConnectionType.BLUETOOTH];function Ir(t,n){const{hidChannel:r}=t;return!!function(e){return Nr.some((({usagePage:t,usage:n,reportType:r})=>e.findDescriptor(t,n,r)))}(r)&&(!gn.supportsGnpOverHid(r)||n!==e.DeviceType.DONGLE&&n!==e.DeviceType.OTHER)}function Ar(e){const{currentConnections:t,type:n}=e;var r;return(r=t,[...r].sort(((e,t)=>Sr.indexOf(e.type)-Sr.indexOf(t.type)))).find((e=>Ir(e,n)))}function Lr(t,n,r,i,o){const s=Ar(t),{hidChannel:a,onDisconnect:c}=s,u=new Cr(new Rr(i),t,o);if(n)return Ce(new _r(t,a,c,u,r.softphoneInFocus,o));if(i.context===e.TransportContext.WEB_HID)return Ce(new _r(t,a,c,u,r.softphoneInFocus,o));return function(t,n){return t.findDescriptor(hr.GN_TELEPHONY,pr.GN_TELEPHONY_CONT_SET,e.ReportType.FEATURE)?Ge((()=>(t.setFeatureReport(hr.GN_TELEPHONY,pr.GN_TELEPHONY_CONT_SET,1),Ce(!0)))):n?Or(n,yr.GN_TELEPHONY):Ce(!1)}(a,s).pipe(Ue((e=>new _r(t,a,c,u,r.softphoneInFocus,o))))}class Dr{constructor(e,t){this.devComm=e,this.softphoneInFocus=new G,this.softphoneInFocus=t.pipe(dt(),Pe((e=>this.devComm.consoleAppEvent.pipe(Je((e=>"softphone-in-focus"===e.event)),Ue((e=>e.infocus)),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=se(e);return B((function(t,r){(n?Fe(e,t,n):Fe(e,t)).subscribe(r)}))}(!e),Et(1))))),this.softphoneInFocus.subscribe((()=>{}))}setSharedSoftphoneInfo(t){if(!(null==t?void 0:t.partnerKey)||!(null==t?void 0:t.appId))return void Ot("Unable to register with Jabra Direct: partnerKey or appId missing in config",null==t?void 0:t.logger,e.LogLevel.WARNING);const n=t.partnerKey+t.appId,r=new tn(5,"ns:OID",n);let{appName:i}=t;if((!t.appName||t.appName.length<3)&&(Ot("App name missing in config. Fall back to use appId as app name.",null==t?void 0:t.logger,e.LogLevel.WARNING),i=t.appId),i.length>100)return void Ot("Unable to register with Jabra Direct: appName must be below 100 characters.",null==t?void 0:t.logger,e.LogLevel.WARNING);const o={action:"set-softphone-info",name:i,id:r.toString()};this.devComm.writeAction(o)}}var Hr,Ur,Pr,kr,xr,Fr,Gr,Mr,Br,Wr;class Kr{constructor(e){var t;Hr.set(this,void 0),Ur.set(this,void 0),Pr.set(this,void 0),kr.set(this,void 0),d(this,kr,e._readyEvents.pipe(dt((e=>"ready"===e.event)),Ue((e=>e.jabraDirectInstalled))),"f"),d(this,Ur,new Dr(e._transport,h(this,kr,"f")),"f"),h(this,Ur,"f").setSharedSoftphoneInfo(e._config),d(this,Hr,e._transport,"f"),d(this,Pr,null===(t=e._config)||void 0===t?void 0:t.logger,"f")}createCallControl(t){if(!this.supportsCallControl(t))return Promise.reject(new Tt(`Device ${t.name} does not support call control.`,e.ErrorType.FEATURE_NOT_SUPPORTED));return Ie(h(this,kr,"f").pipe(Pe((e=>Lr(t,e,h(this,Ur,"f"),h(this,Hr,"f"),h(this,Pr,"f"))))))}supportsCallControl(e){return void 0!==Ar(e)}}Hr=new WeakMap,Ur=new WeakMap,Pr=new WeakMap,kr=new WeakMap,e.AcceptIncomingCallBehavior=void 0,(xr=e.AcceptIncomingCallBehavior||(e.AcceptIncomingCallBehavior={})).HOLD_CURRENT="hold-current",xr.END_CURRENT="end-current",e.MuteState=void 0,(Fr=e.MuteState||(e.MuteState={})).MUTED="muted",Fr.UNMUTED="unmuted",Fr.NO_ONGOING_CALLS="no-ongoing-calls",e.HoldState=void 0,(Gr=e.HoldState||(e.HoldState={})).ON_HOLD="on-hold",Gr.NOT_ON_HOLD="not-on-hold",Gr.NO_ONGOING_CALLS="no-ongoing-calls",function(e){e.NO_INCOMING="no-incoming",e.AWAITING_RESPONSE="awaiting-response",e.RESOLVING_RESPONSE="resolving-response",e.ACCEPTED="accepted",e.REJECTED="rejected"}(Mr||(Mr={}));class Vr{constructor(e){this.state=e.value,e.subscribe((e=>{this.state=e}))}}class Yr extends Vr{constructor(e,t,n,r,i){super(e),this.commands=t,this.deviceSignals=n,this.enableFlash=r,this.logger=i}setupSignalListeners(){const t=this.extendedSignals.pipe(vt()),n=t.pipe(Je((e=>e.allowed))),i=t.pipe(Je((e=>!e.allowed)));n.subscribe((t=>{Ot(`Accepted signal: ${e.SignalType[t.type]} [${t.value}]`,null==this?void 0:this.logger,e.LogLevel.INFO)})),i.subscribe((t=>{Ot(`Ignored signal: ${e.SignalType[t.type]} [${t.value}]`,null==this?void 0:this.logger,e.LogLevel.INFO)})),n.pipe(Je((t=>t.type===e.SignalType.HOOK_SWITCH))).subscribe((t=>{t.value&&this.state.incomingCall===Mr.AWAITING_RESPONSE?this.commands.incomingCallHandler.queueAcceptIncomingCall(e.AcceptIncomingCallBehavior.END_CURRENT,!0):(!1===t.value&&this.state.ongoingCalls>0&&this.commands.hookHandler.queueEndCall(!0),!0===t.value&&0===this.state.ongoingCalls&&this.commands.hookHandler.queueStartCall())})),n.pipe(Je((t=>t.type===e.SignalType.PHONE_MUTE))).subscribe((()=>{this.commands.muteHandler.queueToggleMute(!0)})),n.pipe(Je((t=>t.type===e.SignalType.FLASH))).subscribe((()=>r(this,void 0,void 0,(function*(){this.state.incomingCall!==Mr.AWAITING_RESPONSE?this.state.ongoingCalls>1?this.commands.swapHandler.queueSwapCalls():this.commands.holdHandler.queueToggleHold():yield this.commands.incomingCallHandler.queueAcceptIncomingCall(e.AcceptIncomingCallBehavior.HOLD_CURRENT,!0)})))),n.pipe(Je((t=>t.type===e.SignalType.REJECT_CALL))).subscribe((()=>{this.state.incomingCall===Mr.AWAITING_RESPONSE&&this.commands.incomingCallHandler.queueRejectIncomingCall()}))}get extendedSignals(){return this.deviceSignals.pipe(Pe((t=>{let n=!this.state.ignoreSignals.some((([e,n])=>t.type===e&&n===t.value));return t.type!==e.SignalType.FLASH||this.enableFlash||(n=!1),Ce(Object.assign(Object.assign({},t),{allowed:n}))})),wt(this.commands.teardownHandler.onTeardown))}}class jr{constructor(e,t,n,r,i,o,s=!0){this.logger=o,Br.set(this,void 0),this.device=e,this.onDisconnect=t,this.ringState=i.ringState,this.muteState=i.muteState,d(this,Br,r,"f"),this.onDisconnect.pipe(dt(),wt(h(this,Br,"f").teardownHandler.onTeardown)).subscribe((e=>this.teardown(!1)));new Yr(i.internalState,r,n,s,o).setupSignalListeners()}endCall(){return h(this,Br,"f").hookHandler.queueEndCall(!1)}signalIncomingCall(e=25e3){return h(this,Br,"f").incomingCallHandler.queueSignalIncomingCall(e)}rejectIncomingCall(){return h(this,Br,"f").incomingCallHandler.queueRejectIncomingCall()}mute(){return h(this,Br,"f").muteHandler.queueSetMute(e.MuteState.MUTED)}unmute(){return h(this,Br,"f").muteHandler.queueSetMute(e.MuteState.UNMUTED)}teardown(e=!0){h(this,Br,"f").teardownHandler.teardown(e)}_setInitialState(t,n=!1,r=!1){return 0===t&&(n||r)&&Ot("\n        Unable to set initial state: muted or onHold cannot be true unless a call is started.\n        Set callActive to true for SingleCallControl, or ongoingCalls to 1 or more for MultiCallControl.\n      ",null==this?void 0:this.logger,e.LogLevel.WARNING),h(this,Br,"f").deviceState.setInitialState(t,n,r)}}Br=new WeakMap;class qr extends jr{constructor(e,t,n,r,i,o){super(e,t,n,r,i,o,!0),Wr.set(this,void 0),this.ongoingCalls=i.ongoingCalls,this.holdState=i.holdState,this.swapRequest=i.swapEvents,d(this,Wr,r,"f")}startCall(){return h(this,Wr,"f").hookHandler.queueStartCall()}acceptIncomingCall(t=e.AcceptIncomingCallBehavior.END_CURRENT){return h(this,Wr,"f").incomingCallHandler.queueAcceptIncomingCall(t,!1)}hold(){return h(this,Wr,"f").holdHandler.queueSetHold(e.HoldState.ON_HOLD)}resume(){return h(this,Wr,"f").holdHandler.queueSetHold(e.HoldState.NOT_ON_HOLD)}}Wr=new WeakMap;class zr extends Vr{constructor(e,t,n){super(t),this.callControl=e,this.logger=n,this.hasLock=!1}takeCallLock(){return r(this,void 0,void 0,(function*(){if(!this.hasLock){try{this.hasLock=yield this.callControl.takeCallLock()}catch(t){this.hasLock=!0,Ot(t.message,null==this?void 0:this.logger,e.LogLevel.WARNING)}if(!this.hasLock)throw new Tt("Device used by another softphone. Only one application can use the device at a time.",e.ErrorType.SDK_USAGE_ERROR)}}))}releaseCallLock(){0===this.state.ongoingCalls&&(this.callControl.releaseCallLock(),this.hasLock=!1)}forceReleaseCallLock(){this.hasLock&&this.callControl.releaseCallLock()}}class $r{constructor(e){this.teardownHandler=e,this.queue=new Y,this.queue.pipe(rt((e=>r(this,void 0,void 0,(function*(){try{const t=yield e.command();e.callback(t)}catch(t){if(!(t instanceof Tt))throw t;e.errCallback(t)}})))),wt(this.teardownHandler.onTeardown)).subscribe()}pushToQueue(e){return new Promise(((t,n)=>{this.teardownHandler.checkActive();const r={command:e,callback:t,errCallback:n};this.queue.next(r)}))}}class Qr extends Vr{constructor(e,t,n,r){super(r),this.hookHandler=e,this.holdHandler=t,this.muteHandler=n}setInitialState(t,n,i){return r(this,void 0,void 0,(function*(){if(0===t)return yield this.hookHandler.queueStartCall(),void(yield this.hookHandler.queueEndCall(!1));for(let e=0;e<t;e+=1)yield this.hookHandler.queueStartCall();const r=n?e.MuteState.MUTED:e.MuteState.UNMUTED;yield this.muteHandler.queueSetMute(r);const o=i?e.HoldState.ON_HOLD:e.HoldState.NOT_ON_HOLD;yield this.holdHandler.queueSetHold(o)}))}}class Xr extends Vr{constructor(e,t,n,r){super(t),this.callControl=e,this.stateHandler=t,this.commandQueue=n,this.awaitSignals=r}queueSetHold(e){return this.commandQueue.pushToQueue((()=>this.setHold(e)))}queueToggleHold(){return this.commandQueue.pushToQueue((()=>r(this,void 0,void 0,(function*(){const t=this.state.holdState===e.HoldState.ON_HOLD?e.HoldState.NOT_ON_HOLD:e.HoldState.ON_HOLD;this.setHold(t)}))))}setHold(t){return r(this,void 0,void 0,(function*(){if(0===this.state.ongoingCalls){const n=t===e.HoldState.ON_HOLD?"hold":"resume";throw new Tt(`Cannot ${n} call as there are no calls in progress.`,e.ErrorType.SDK_USAGE_ERROR)}if(this.state.ongoingCalls>1&&t===e.HoldState.NOT_ON_HOLD)return void(yield this.resumeWhileMultiple());this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:t}));const n=t===e.HoldState.NOT_ON_HOLD,r=t===e.HoldState.ON_HOLD,i=[[e.SignalType.HOOK_SWITCH,n],[e.SignalType.FLASH,!0]],o=this.awaitSignals.listen(i);r?(this.callControl.hold(r),this.callControl.offHook(n)):(this.callControl.offHook(n),this.callControl.hold(r)),yield Se(o)}))}resumeWhileMultiple(){return r(this,void 0,void 0,(function*(){const t=this.awaitSignals.listen([[e.SignalType.HOOK_SWITCH,!0]]);this.callControl.offHook(!0),this.callControl.hold(!1),this.callControl.hold(!0),yield Se(t),this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:e.HoldState.NOT_ON_HOLD}))}))}}class Jr extends Vr{constructor(e,t,n,r,i){super(n),this.callControl=e,this.callLock=t,this.stateHandler=n,this.commandQueue=r,this.awaitSignals=i}queueStartCall(){return this.commandQueue.pushToQueue((()=>this.startCall()))}queueEndCall(e){return this.commandQueue.pushToQueue((()=>this.endCall(e)))}startCall(t=!1){return r(this,void 0,void 0,(function*(){if(this.state.incomingCall===Mr.AWAITING_RESPONSE)throw new Tt("Cannot start a new call while another call is incoming. If you wish to answer/accept the incoming call, please use acceptIncomingCall/rejectIncomingCall instead.",e.ErrorType.SDK_USAGE_ERROR);this.state.holdState===e.HoldState.ON_HOLD?this.startNewCallWhileOnHold():0===this.state.ongoingCalls?yield this.startFirstCall(t):this.startSubsequentCalls(),this.stateHandler.next(Object.assign(Object.assign({},this.state),{ongoingCalls:this.state.ongoingCalls+1}))}))}endCall(t){return r(this,void 0,void 0,(function*(){if(this.state.incomingCall===Mr.AWAITING_RESPONSE)throw new Tt("Cannot end a call while another call is incoming. If you wish to answer/accept the incoming call, please use acceptIncomingCall/rejectIncomingCall instead.",e.ErrorType.SDK_USAGE_ERROR);if(0===this.state.ongoingCalls)throw new Tt("Cannot end call as there are no calls in progress.",e.ErrorType.SDK_USAGE_ERROR);1===this.state.ongoingCalls?yield this.endLastCall():this.state.holdState===e.HoldState.ON_HOLD?this.endCallWhileOnHold():yield this.endCurrentCall(t)}))}startFirstCall(t){return r(this,void 0,void 0,(function*(){yield this.callLock.takeCallLock();const n=t?[]:[[e.SignalType.HOOK_SWITCH,!0]],r=this.awaitSignals.listen(n);this.callControl.offHook(!0),yield Se(r),this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:e.HoldState.NOT_ON_HOLD,muteState:e.MuteState.UNMUTED}))}))}startSubsequentCalls(){this.callControl.hold(!0)}startNewCallWhileOnHold(){this.callControl.offHook(!0),this.callControl.hold(!0),this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:e.HoldState.NOT_ON_HOLD}))}endLastCall(){return r(this,void 0,void 0,(function*(){this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:e.HoldState.NO_ONGOING_CALLS,muteState:e.MuteState.NO_ONGOING_CALLS,ongoingCalls:0})),this.callControl.mute(!1),this.callControl.offHook(!1),this.callControl.hold(!1),this.callLock.releaseCallLock()}))}endCurrentCall(e){return r(this,void 0,void 0,(function*(){this.stateHandler.next(Object.assign(Object.assign({},this.state),{ongoingCalls:this.state.ongoingCalls-1})),yield this.sendHoldCallSignalAndWaitForAck(e),yield this.resumeNextCall(e)}))}sendHoldCallSignalAndWaitForAck(t){const n=t?[[e.SignalType.HOOK_SWITCH,!1],[e.SignalType.FLASH,!0]]:[[e.SignalType.HOOK_SWITCH,!1]],r=Se(this.awaitSignals.listen(n));return this.callControl.hold(!0),this.callControl.offHook(!1),r}resumeNextCall(t){const n=t?[[e.SignalType.HOOK_SWITCH,!0],[e.SignalType.FLASH,!0]]:[[e.SignalType.HOOK_SWITCH,!0]],r=Se(this.awaitSignals.listen(n));return this.callControl.offHook(!0),this.callControl.hold(1!==this.state.ongoingCalls),r}endCallWhileOnHold(){this.stateHandler.next(Object.assign(Object.assign({},this.state),{ongoingCalls:this.state.ongoingCalls-1}))}}class Zr extends Vr{constructor(e,t,n,r,i){super(n),this.callControl=e,this.callLock=t,this.stateHandler=n,this.hookHandler=r,this.commandQueue=i}queueAcceptIncomingCall(e,t){return this.commandQueue.pushToQueue((()=>this.acceptIncomingCall(e,t)))}queueRejectIncomingCall(){return this.commandQueue.pushToQueue((()=>this.rejectIncomingCall()))}queueSignalIncomingCall(e=25e3){return new Promise(((t,n)=>{this.commandQueue.pushToQueue((()=>r(this,void 0,void 0,(function*(){(yield this.signalIncomingCall(e)).subscribe({next:e=>{t(e),this.updateIncomingCallState(Mr.NO_INCOMING)},error:e=>{t(!1)},complete:()=>{t(!1)}})})))).catch((e=>n(e)))}))}signalIncomingCall(e){return r(this,void 0,void 0,(function*(){return yield this.callLock.takeCallLock(),this.updateIncomingCallState(Mr.AWAITING_RESPONSE),this.callControl.ring(!0),this.stateHandler.pipe((t=({incomingCall:e})=>e!==Mr.NO_INCOMING,void 0===n&&(n=!1),B((function(e,r){var i=0;e.subscribe(W(r,(function(e){var o=t(e,i++);(o||n)&&r.next(e),!o&&r.complete()})))}))),Je((({incomingCall:e})=>e===Mr.ACCEPTED||e===Mr.REJECTED)),dt(),De(e),nt((e=>(this.rejectIncomingCall(),Ce(this.state)))),Ue((({incomingCall:e})=>e===Mr.ACCEPTED)));var t,n}))}acceptIncomingCall(t,n){return r(this,void 0,void 0,(function*(){if(this.state.incomingCall!==Mr.AWAITING_RESPONSE)throw new Tt("Cannot accept as there are no incoming calls.",e.ErrorType.SDK_USAGE_ERROR);this.updateIncomingCallState(Mr.RESOLVING_RESPONSE),this.callControl.ring(!1),this.state.holdState===e.HoldState.ON_HOLD||0===this.state.ongoingCalls?yield this.hookHandler.startCall(n):t===e.AcceptIncomingCallBehavior.END_CURRENT?(yield this.hookHandler.endCall(n),yield this.hookHandler.startCall(n)):t===e.AcceptIncomingCallBehavior.HOLD_CURRENT&&(yield this.hookHandler.startCall(n)),this.stateHandler.next(Object.assign(Object.assign({},this.state),{incomingCall:Mr.ACCEPTED,holdState:e.HoldState.NOT_ON_HOLD}))}))}rejectIncomingCall(){return r(this,void 0,void 0,(function*(){if(this.state.incomingCall!==Mr.AWAITING_RESPONSE)throw new Tt("Cannot reject as there are no incoming calls.",e.ErrorType.SDK_USAGE_ERROR);this.callControl.ring(!1),this.updateIncomingCallState(Mr.REJECTED),this.callLock.releaseCallLock()}))}updateIncomingCallState(e){this.stateHandler.next(Object.assign(Object.assign({},this.state),{incomingCall:e}))}}class ei extends Vr{constructor(e,t,n){super(t),this.callControl=e,this.stateHandler=t,this.commandQueue=n}queueSetMute(e){return this.commandQueue.pushToQueue((()=>this.setMute(e,!1)))}queueToggleMute(t){return this.commandQueue.pushToQueue((()=>r(this,void 0,void 0,(function*(){const n=this.state.muteState===e.MuteState.MUTED?e.MuteState.UNMUTED:e.MuteState.MUTED;this.setMute(n,t)}))))}setMute(t,n){return r(this,void 0,void 0,(function*(){if(!n&&0===this.state.ongoingCalls)throw new Tt("You cannot change mute state outside of a call.",e.ErrorType.SDK_USAGE_ERROR);if(!n&&this.state.holdState===e.HoldState.ON_HOLD)throw new Tt("You cannot change mute state while on hold.",e.ErrorType.SDK_USAGE_ERROR);this.callControl.mute(t===e.MuteState.MUTED),this.stateHandler.next(Object.assign(Object.assign({},this.state),{muteState:t}))}))}}class ti extends Vr{constructor(e,t){super(e),this.stateHandler=e,this.commandQueue=t}queueSwapCalls(){return this.commandQueue.pushToQueue((()=>this.swapCalls()))}swapCalls(){return r(this,void 0,void 0,(function*(){if(this.state.ongoingCalls<2)throw new Tt("No calls to swap between. There should be at least one current call and one call on hold.",e.ErrorType.SDK_USAGE_ERROR);this.stateHandler.next(Object.assign(Object.assign({},this.state),{swapToggle:this.state.swapToggle?0:1}))}))}}class ni{constructor(e,t,n){this.stateHandler=e,this.callLock=t,this.logger=n,this.teardownState=new q(!1),this.onTeardown=this.teardownState.pipe(yt(1),Ue(O))}teardown(t=!0){if(this.teardownState.value)throw new Tt("Easy Call Control instance already torn down.",e.ErrorType.SDK_USAGE_ERROR);this.stateHandler.unsubscribeState(),this.teardownState.next(!0),t&&this.callLock.forceReleaseCallLock(),Ot("Teardown complete. Create new Easy Call Control instance to continue usage.",null==this?void 0:this.logger,e.LogLevel.INFO)}checkActive(){if(this.teardownState.value)throw new Tt("\n        Inactive instance. Either device disconnected or teardown was called.\n        Create new EasyCallControl instance to continue usage.",e.ErrorType.SDK_USAGE_ERROR)}}class ri{constructor(e,t,n){this.deviceSignals=e,this.stateHandler=t,this.logger=n}listen(t){if(0===t.length)return Ce(void 0);this.stateHandler.next(Object.assign(Object.assign({},this.stateHandler.value),{ignoreSignals:t}));let n=0;return this.deviceSignals.pipe(mt((r=>{const[i,o]=t[n];return r.type===i&&r.value===o?(Ot(`Resolve awaited signal: ${e.SignalType[i]} [${o}]`,null==this?void 0:this.logger,e.LogLevel.INFO),n+=1,Ce(r)):ne})),ot(t.length),De(1e3),nt((()=>{const n=t.map((([t,n])=>`${e.SignalType[t]}: ${n}`));return Ot(`Missing signals for ${JSON.stringify(n)}. State recovered.`,null==this?void 0:this.logger,e.LogLevel.INFO),Ce(void 0)})),(r=()=>{this.stateHandler.next(Object.assign(Object.assign({},this.stateHandler.value),{ignoreSignals:[]}))},B((function(e,t){try{e.subscribe(t)}finally{t.add(r)}}))));var r}}class ii{constructor(e,t,n,r){const i=new zr(e,n.internalState,r);this.teardownHandler=new ni(n,i,r);const o=new $r(this.teardownHandler),s=new ri(t,n.internalState,r);this.hookHandler=new Jr(e,i,n.internalState,o,s),this.muteHandler=new ei(e,n.internalState,o),this.holdHandler=new Xr(e,n.internalState,o,s),this.incomingCallHandler=new Zr(e,i,n.internalState,this.hookHandler,o),this.swapHandler=new ti(n.internalState,o),this.deviceState=new Qr(this.hookHandler,this.holdHandler,this.muteHandler,n.internalState)}}const oi={ongoingCalls:0,muteState:e.MuteState.NO_ONGOING_CALLS,holdState:e.HoldState.NO_ONGOING_CALLS,incomingCall:Mr.NO_INCOMING,ignoreSignals:[],swapToggle:0};class si{constructor(){this.internalState=new q(oi),this.onUnsubscribe=new Y;const e=this.internalState.pipe(wt(this.onUnsubscribe));this.ongoingCalls=e.pipe(Ue((e=>e.ongoingCalls)),ct()),this.callActive=e.pipe(Ue((e=>0!==e.ongoingCalls)),ct()),this.ringState=e.pipe(Ue((e=>e.incomingCall===Mr.AWAITING_RESPONSE||e.incomingCall===Mr.RESOLVING_RESPONSE)),ct()),this.muteState=e.pipe(Ue((e=>e.muteState)),ct()),this.holdState=e.pipe(Ue((e=>e.holdState)),ct()),this.swapEvents=e.pipe(Ue((e=>e.swapToggle)),ct(),Ue((()=>{})),yt(1))}unsubscribeState(){this.onUnsubscribe.next(void 0),this.onUnsubscribe.complete(),this.internalState.complete()}}var ai,ci,ui,li;class hi extends jr{constructor(e,t,n,r,i,o){super(e,t,n,r,i,o,!1),ai.set(this,void 0),ci.set(this,void 0),this.callActive=i.callActive,d(this,ai,i.internalState,"f"),d(this,ci,r,"f")}startCall(){return r(this,void 0,void 0,(function*(){if(1===h(this,ai,"f").value.ongoingCalls)throw new Tt("Please end the call before starting a new one.",e.ErrorType.SDK_USAGE_ERROR);yield h(this,ci,"f").hookHandler.queueStartCall()}))}acceptIncomingCall(){return h(this,ci,"f").incomingCallHandler.queueAcceptIncomingCall(e.AcceptIncomingCallBehavior.END_CURRENT,!1)}}ai=new WeakMap,ci=new WeakMap;ui=new WeakMap,li=new WeakMap;var di=Object.freeze({__proto__:null,WebHidTransport:class{constructor(t,n,r){this.webHidHandler=t,this.logger=n,this.recorder=r,this.events=new Y,this.consoleAppEvent=this.events,this.webHidConnected=!1,this.context=e.TransportContext.WEB_HID}connect(){return this.webHidConnected?Promise.reject(new Tt("Already connected",e.ErrorType.UNEXPECTED_ERROR)):(this.webHidHandler.events.subscribe((e=>{var t;let n=e;this.recorder&&(n=null===(t=this.recorder)||void 0===t?void 0:t.recordInput(n)),this.events.next(n)})),this.webHidHandler.start(),this.webHidConnected=!0,Promise.resolve())}writeAction(t){var n;if(!this.webHidConnected){const t="WebHID is uninitialized.";throw Ot(t,this.logger,e.LogLevel.ERROR),new Tt(t,e.ErrorType.INIT_ERROR)}null===(n=this.recorder)||void 0===n||n.recordOutput(t),this.webHidHandler.sendMessage(t)}}});var pi=Object.freeze({__proto__:null,TransportChromeExtension:class{constructor(t,n){this.logger=t,this.recorder=n,this.events=new Y,this.consoleAppEvent=this.events,this.connectHasBeenCalled=!1,this.context=e.TransportContext.CHROME_EXTENSION}connect(){return this.connectHasBeenCalled?Promise.reject(new Tt("Already connected",e.ErrorType.UNEXPECTED_ERROR)):(this.connectHasBeenCalled=!0,window.addEventListener("message-from-jabra-chrome-extension",(e=>{var t;let n=e.detail;this.recorder&&(n=null===(t=this.recorder)||void 0===t?void 0:t.recordInput(n)),this.events.next(n)})),this.writeAction({event:"ping"}),Promise.resolve())}static checkInstallation(){return r(this,void 0,void 0,(function*(){return new Promise((e=>{const t=new CustomEvent("message-to-jabra-chrome-extension",{detail:"check-console-app-installation"});window.dispatchEvent(t),window.addEventListener("installation-status-from-jabra-chrome-extension",(t=>{e({ok:t.detail,message:t.detail?"Installation ok":"The Jabra Chromehost is not installed"})})),setTimeout((()=>{e({ok:!1,message:"The Jabra Chrome Extension is not installed"})}),3e3)}))}))}writeAction(e){var t;null===(t=this.recorder)||void 0===t||t.recordOutput(e),window.dispatchEvent(new CustomEvent("message-to-jabra-chrome-extension",{detail:e}))}}});e.CallControlFactory=Kr,e.DeviceId=rn,e.EasyCallControlFactory=class{constructor(e){var t;ui.set(this,void 0),li.set(this,void 0),d(this,ui,new Kr(e),"f"),d(this,li,null===(t=e._config)||void 0===t?void 0:t.logger,"f")}createSingleCallControl(e,t){return r(this,void 0,void 0,(function*(){const n=yield this.getSharedDependencies(e),r=new hi(n.coreDevice,n.onDisconnect,n.deviceSignals,n.commands,n.stateHandler,h(this,li,"f"));if(t){const e=t.callActive?1:0;yield r._setInitialState(e,t.muted)}return r}))}createMultiCallControl(e,t){return r(this,void 0,void 0,(function*(){const n=yield this.getSharedDependencies(e),r=new qr(n.coreDevice,n.onDisconnect,n.deviceSignals,n.commands,n.stateHandler,h(this,li,"f"));return t&&(yield r._setInitialState(t.ongoingCalls,t.muted,t.onHold)),r}))}supportsEasyCallControl(e){return h(this,ui,"f").supportsCallControl(e)}getSharedDependencies(e){return r(this,void 0,void 0,(function*(){const t=yield h(this,ui,"f").createCallControl(e),n=new si,r=t.deviceSignals.pipe(vt());return{commands:new ii(t,r,n,h(this,li,"f")),stateHandler:n,deviceSignals:r,coreDevice:t.device,onDisconnect:t.onDisconnect}}))}},e.JabraError=Tt,e.init=function(t){var n,i,o;return r(this,void 0,void 0,(function*(){const r=null==t?void 0:t.logger;Ot("Jabra SDK JS starting up...",r,e.LogLevel.INFO);const s=new Ht(t);s.validateOrganizationKey(),s.validateAppId(),s.validateAppName();const a=null!==(i=null===(n=null==t?void 0:t.internal)||void 0===n?void 0:n.testDeviceTransport)&&void 0!==i?i:yield At(r,null==t?void 0:t.transport,null===(o=null==t?void 0:t.internal)||void 0===o?void 0:o.recorder);new Lt(a,r);const c=Wn.create(a,r),u=new St(c,a,t);return yield a.connect(),u}))},e.webHidPairing=function(){return r(this,void 0,void 0,(function*(){const{hid:t}=window.navigator;if(!t)throw new Tt("WebHID not supported",e.ErrorType.INIT_ERROR);const n=yield t.requestDevice({filters:[{vendorId:qn.VENDOR_ID}]});return new BroadcastChannel(qn.PAIRING_CHANNEL).postMessage(null),n}))},Object.defineProperty(e,"__esModule",{value:!0})}));
