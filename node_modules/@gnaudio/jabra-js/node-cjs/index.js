"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("child_process"),t=require("fs"),n=require("os"),r=require("path"),o=require("url");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=i(n),a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},a(e,t)};function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function l(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function d(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function f(e){return this instanceof f?(this.v=e,this):new f(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof f?Promise.resolve(n.value.v).then(c,l):u(i[0][2],n)}catch(e){u(i[0][3],e)}var n}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function E(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=h(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}}function g(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function y(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n}function m(e){return"function"==typeof e}function _(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var b=_((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function T(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var w=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=h(i),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(m(c))try{c()}catch(e){o=e instanceof b?e.errors:[e]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var u=h(l),f=u.next();!f.done;f=u.next()){var v=f.value;try{S(v)}catch(e){o=null!=o?o:[],e instanceof b?o=d(d([],p(o)),p(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(o)throw new b(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)S(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&T(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&T(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),O=w.EMPTY;function C(e){return e instanceof w||e&&"closed"in e&&m(e.remove)&&m(e.add)&&m(e.unsubscribe)}function S(e){m(e)?e():e.unsubscribe()}var N={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},x={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=x.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,d([e,t],p(n))):setTimeout.apply(void 0,d([e,t],p(n)))},clearTimeout:function(e){var t=x.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function A(e){x.setTimeout((function(){throw e}))}function I(){}var R=L("C",void 0,void 0);function L(e,t,n){return{kind:e,value:t,error:n}}function D(e){e()}var H=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,C(t)&&t.add(n)):n.destination=B,n}return c(t,e),t.create=function(e,t,n){return new G(e,t,n)},t.prototype.next=function(e){this.isStopped?F(function(e){return L("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?F(L("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?F(R,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(w),P=Function.prototype.bind;function U(e,t){return P.call(e,t)}var k=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){M(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){M(e)}else M(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){M(e)}},e}(),G=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;m(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&N.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&U(t.next,i),error:t.error&&U(t.error,i),complete:t.complete&&U(t.complete,i)}):o=t;return s.destination=new k(o),s}return c(t,e),t}(H);function M(e){A(e)}function F(e,t){var n=N.onStoppedNotification;n&&x.setTimeout((function(){return n(e,t)}))}var B={closed:!0,next:I,error:function(e){throw e},complete:I},K="function"==typeof Symbol&&Symbol.observable||"@@observable";function W(e){return e}function j(e){return 0===e.length?W:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Y=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof H||function(e){return e&&m(e.next)&&m(e.error)&&m(e.complete)}(r)&&C(r)?e:new G(e,t,n);return D((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=V(t))((function(t,r){var o=new G({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[K]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return j(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=V(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function V(e){var t;return null!==(t=null!=e?e:N.Promise)&&void 0!==t?t:Promise}function q(e){return function(t){if(function(e){return m(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function $(e,t,n,r,o){return new z(e,t,n,r,o)}var z=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return c(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(H),Q=_((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),J=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return c(t,e),t.prototype.lift=function(e){var t=new X(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Q},t.prototype.next=function(e){var t=this;D((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=h(t.currentObservers),i=o.next();!i.done;i=o.next()){i.value.next(e)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;D((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;D((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?O:(this.currentObservers=null,i.push(e),new w((function(){t.currentObservers=null,T(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new Y;return e.source=this,e},t.create=function(e,t){return new X(e,t)},t}(Y),X=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return c(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:O},t}(J),Z=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return c(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(J),ee={now:function(){return(ee.delegate||Date).now()},delegate:void 0},te=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=ee);var o=e.call(this)||this;return o._bufferSize=t,o._windowTime=n,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,n),o}return c(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,o=n._buffer,i=n._infiniteTimeWindow,s=n._timestampProvider,a=n._windowTime;r||(o.push(t),!i&&o.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=n?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,o=e._infiniteTimeWindow,i=(o?1:2)*t;if(t<1/0&&i<r.length&&r.splice(0,r.length-i),!o){for(var s=n.now(),a=0,c=1;c<r.length&&r[c]<=s;c+=2)a=c;a&&r.splice(0,a+1)}},t}(J),ne=function(e){function t(t,n){return e.call(this)||this}return c(t,e),t.prototype.schedule=function(e,t){return this},t}(w),re={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=re.delegate;return(null==o?void 0:o.setInterval)?o.setInterval.apply(o,d([e,t],p(n))):setInterval.apply(void 0,d([e,t],p(n)))},clearInterval:function(e){var t=re.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},oe=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return c(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,o=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(o,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(o,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),re.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&re.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,T(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(ne),ie=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=ee.now,e}(),se=new(function(e){function t(t,n){void 0===n&&(n=ie.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return c(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(ie))(oe),ae=se,ce=new Y((function(e){return e.complete()}));function le(e){return e&&m(e.schedule)}function ue(e){return e[e.length-1]}function he(e){return m(ue(e))?e.pop():void 0}function pe(e){return le(ue(e))?e.pop():void 0}function de(e,t){return"number"==typeof ue(e)?e.pop():t}var fe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ve(e){return m(null==e?void 0:e.then)}function Ee(e){return m(e[K])}function ge(e){return Symbol.asyncIterator&&m(null==e?void 0:e[Symbol.asyncIterator])}function ye(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var me="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function _e(e){return m(null==e?void 0:e[me])}function be(e){return v(this,arguments,(function(){var t,n,r;return u(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,f(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,f(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,f(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Te(e){return m(null==e?void 0:e.getReader)}function we(e){if(e instanceof Y)return e;if(null!=e){if(Ee(e))return o=e,new Y((function(e){var t=o[K]();if(m(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(fe(e))return r=e,new Y((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(ve(e))return n=e,new Y((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,A)}));if(ge(e))return Oe(e);if(_e(e))return t=e,new Y((function(e){var n,r;try{for(var o=h(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(Te(e))return Oe(be(e))}var t,n,r,o;throw ye(e)}function Oe(e){return new Y((function(t){(function(e,t){var n,r,o,i;return l(this,void 0,void 0,(function(){var s,a;return u(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=E(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ce(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function Se(e,t){return void 0===t&&(t=0),q((function(n,r){n.subscribe($(r,(function(n){return Ce(r,e,(function(){return r.next(n)}),t)}),(function(){return Ce(r,e,(function(){return r.complete()}),t)}),(function(n){return Ce(r,e,(function(){return r.error(n)}),t)})))}))}function Ne(e,t){return void 0===t&&(t=0),q((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function xe(e,t){if(!e)throw new Error("Iterable cannot be null");return new Y((function(n){Ce(n,t,(function(){var r=e[Symbol.asyncIterator]();Ce(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Ae(e,t){if(null!=e){if(Ee(e))return function(e,t){return we(e).pipe(Ne(t),Se(t))}(e,t);if(fe(e))return function(e,t){return new Y((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(ve(e))return function(e,t){return we(e).pipe(Ne(t),Se(t))}(e,t);if(ge(e))return xe(e,t);if(_e(e))return function(e,t){return new Y((function(n){var r;return Ce(n,t,(function(){r=e[me](),Ce(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return m(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(Te(e))return function(e,t){return xe(be(e),t)}(e,t)}throw ye(e)}function Ie(e,t){return t?Ae(e,t):we(e)}function Re(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=pe(e);return Ie(e,n)}function Le(e,t){var n=m(e)?e:function(){return e},r=function(e){return e.error(n())};return new Y(t?function(e){return t.schedule(r,0,e)}:r)}var De=_((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function He(e,t){var n="object"==typeof t;return new Promise((function(r,o){var i,s=!1;e.subscribe({next:function(e){i=e,s=!0},error:o,complete:function(){s?r(i):n?r(t.defaultValue):o(new De)}})}))}function Pe(e,t){var n="object"==typeof t;return new Promise((function(r,o){var i=new G({next:function(e){r(e),i.unsubscribe()},error:o,complete:function(){n?r(t.defaultValue):o(new De)}});e.subscribe(i)}))}function Ue(e){return e instanceof Date&&!isNaN(e)}var ke=_((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Ge(e,t){var n=Ue(e)?{first:e}:"number"==typeof e?{each:e}:e,r=n.first,o=n.each,i=n.with,s=void 0===i?Me:i,a=n.scheduler,c=void 0===a?null!=t?t:se:a,l=n.meta,u=void 0===l?null:l;if(null==r&&null==o)throw new TypeError("No timeout provided.");return q((function(e,t){var n,i,a=null,l=0,h=function(e){i=Ce(t,c,(function(){try{n.unsubscribe(),we(s({meta:u,lastValue:a,seen:l})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe($(t,(function(e){null==i||i.unsubscribe(),l++,t.next(a=e),o>0&&h(o)}),void 0,void 0,(function(){(null==i?void 0:i.closed)||null==i||i.unsubscribe(),a=null}))),!l&&h(null!=r?"number"==typeof r?r:+r-c.now():o)}))}function Me(e){throw new ke(e)}function Fe(e,t){return q((function(n,r){var o=0;n.subscribe($(r,(function(n){r.next(e.call(t,n,o++))})))}))}var Be=Array.isArray;function Ke(e){return Fe((function(t){return function(e,t){return Be(t)?e.apply(void 0,d([],p(t))):e(t)}(e,t)}))}function We(e,t,n){return void 0===n&&(n=1/0),m(t)?We((function(n,r){return Fe((function(e,o){return t(n,e,r,o)}))(we(e(n,r)))}),n):("number"==typeof t&&(n=t),q((function(t,r){return function(e,t,n,r,o,i,s,a){var c=[],l=0,u=0,h=!1,p=function(){!h||c.length||l||t.complete()},d=function(e){return l<r?f(e):c.push(e)},f=function(e){i&&t.next(e),l++;var a=!1;we(n(e,u++)).subscribe($(t,(function(e){null==o||o(e),i?d(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{l--;for(var e=function(){var e=c.shift();s?Ce(t,s,(function(){return f(e)})):f(e)};c.length&&l<r;)e();p()}catch(e){t.error(e)}})))};return e.subscribe($(t,d,(function(){h=!0,p()}))),function(){null==a||a()}}(t,r,e,n)})))}function je(e){return void 0===e&&(e=1/0),We(W,e)}function Ye(){return je(1)}function Ve(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ye()(Ie(e,pe(e)))}function qe(e){return new Y((function(t){we(e()).subscribe(t)}))}var $e=["addListener","removeListener"],ze=["addEventListener","removeEventListener"],Qe=["on","off"];function Je(e,t,n,r){if(m(n)&&(r=n,n=void 0),r)return Je(e,t,n).pipe(Ke(r));var o=p(function(e){return m(e.addEventListener)&&m(e.removeEventListener)}(e)?ze.map((function(r){return function(o){return e[r](t,o,n)}})):function(e){return m(e.addListener)&&m(e.removeListener)}(e)?$e.map(Xe(e,t)):function(e){return m(e.on)&&m(e.off)}(e)?Qe.map(Xe(e,t)):[],2),i=o[0],s=o[1];if(!i&&fe(e))return We((function(e){return Je(e,t,n)}))(we(e));if(!i)throw new TypeError("Invalid event target");return new Y((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return i(t),function(){return s(t)}}))}function Xe(e,t){return function(n){return function(r){return e[n](t,r)}}}function Ze(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=pe(e),r=de(e,1/0),o=e;return o.length?1===o.length?we(o[0]):je(r)(Ie(o,n)):ce}var et,tt,nt,rt,ot,it,st=new Y(I),at=Array.isArray;function ct(e){return 1===e.length&&at(e[0])?e[0]:e}function lt(e,t){return function(n,r){return!e.call(t,n,r)}}function ut(e,t){return q((function(n,r){var o=0;n.subscribe($(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function ht(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===(e=ct(e)).length?we(e[0]):new Y(pt(e))}function pt(e){return function(t){for(var n=[],r=function(r){n.push(we(e[r]).subscribe($(t,(function(e){if(n){for(var o=0;o<n.length;o++)o!==r&&n[o].unsubscribe();n=null}t.next(e)}))))},o=0;n&&!t.closed&&o<e.length;o++)r(o)}}function dt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=he(e),r=ct(e);return r.length?new Y((function(e){var t=r.map((function(){return[]})),o=r.map((function(){return!1}));e.add((function(){t=o=null}));for(var i=function(i){we(r[i]).subscribe($(e,(function(r){if(t[i].push(r),t.every((function(e){return e.length}))){var s=t.map((function(e){return e.shift()}));e.next(n?n.apply(void 0,d([],p(s))):s),t.some((function(e,t){return!e.length&&o[t]}))&&e.complete()}}),(function(){o[i]=!0,!t[i].length&&e.complete()})))},s=0;!e.closed&&s<r.length;s++)i(s);return function(){t=o=null}})):ce}function ft(e){return q((function(t,n){var r,o=null,i=!1;o=t.subscribe($(n,void 0,void 0,(function(s){r=we(e(s,ft(e)(t))),o?(o.unsubscribe(),o=null,r.subscribe(n)):i=!0}))),i&&(o.unsubscribe(),o=null,r.subscribe(n))}))}function vt(e,t){return m(t)?We(e,t,1):We(e,1)}function Et(e){return q((function(t,n){var r=!1;t.subscribe($(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))}function gt(e){return e<=0?function(){return ce}:q((function(t,n){var r=0;t.subscribe($(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function yt(e,t){return void 0===t&&(t=W),e=null!=e?e:mt,q((function(n,r){var o,i=!0;n.subscribe($(r,(function(n){var s=t(n);!i&&e(o,s)||(i=!1,o=s,r.next(n))})))}))}function mt(e,t){return e===t}function _t(e){return void 0===e&&(e=bt),q((function(t,n){var r=!1;t.subscribe($(n,(function(e){r=!0,n.next(e)}),(function(){return r?n.complete():n.error(e())})))}))}function bt(){return new De}function Tt(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?ut((function(t,n){return e(t,n,r)})):W,gt(1),n?Et(t):_t((function(){return new De})))}}function wt(e){return e<=0?function(){return ce}:q((function(t,n){var r=[];t.subscribe($(n,(function(t){r.push(t),e<r.length&&r.shift()}),(function(){var e,t;try{for(var o=h(r),i=o.next();!i.done;i=o.next()){var s=i.value;n.next(s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n.complete()}),void 0,(function(){r=null})))}))}function Ot(e){return q((function(t,n){var r,o,i=!1,s=function(){r=t.subscribe($(n,void 0,void 0,(function(t){o||(o=new J,e(o).subscribe($(n,(function(){return r?s():i=!0})))),o&&o.next(t)}))),i&&(r.unsubscribe(),r=null,i=!1,s())};s()}))}function Ct(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new J}:t,r=e.resetOnError,o=void 0===r||r,i=e.resetOnComplete,s=void 0===i||i,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,r,i,a=0,l=!1,u=!1,h=function(){null==r||r.unsubscribe(),r=void 0},p=function(){h(),t=i=void 0,l=u=!1},d=function(){var e=t;p(),null==e||e.unsubscribe()};return q((function(e,f){a++,u||l||h();var v=i=null!=i?i:n();f.add((function(){0!==--a||u||l||(r=St(d,c))})),v.subscribe(f),!t&&a>0&&(t=new G({next:function(e){return v.next(e)},error:function(e){u=!0,h(),r=St(p,o,e),v.error(e)},complete:function(){l=!0,h(),r=St(p,s),v.complete()}}),we(e).subscribe(t))}))(e)}}function St(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var o=new G({next:function(){o.unsubscribe(),e()}});return t.apply(void 0,d([],p(n))).subscribe(o)}}else e()}function Nt(e,t,n){var r,o,i,s,a=!1;return e&&"object"==typeof e?(r=e.bufferSize,s=void 0===r?1/0:r,o=e.windowTime,t=void 0===o?1/0:o,a=void 0!==(i=e.refCount)&&i,n=e.scheduler):s=null!=e?e:1/0,Ct({connector:function(){return new te(s,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function xt(e){return ut((function(t,n){return e<=n}))}function At(e,t){return q((function(n,r){var o=null,i=0,s=!1,a=function(){return s&&!o&&r.complete()};n.subscribe($(r,(function(n){null==o||o.unsubscribe();var s=0,c=i++;we(e(n,c)).subscribe(o=$(r,(function(e){return r.next(t?t(n,e,c,s++):e)}),(function(){o=null,a()})))}),(function(){s=!0,a()})))}))}function It(){return At(W)}function Rt(e){return q((function(t,n){we(e).subscribe($(n,(function(){return n.complete()}),I)),!n.closed&&t.subscribe(n)}))}function Lt(e,t,n){var r=m(e)||t||n?{next:e,error:t,complete:n}:e;return r?q((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var o=!0;e.subscribe($(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;o=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;o=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;o&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):W}class Dt extends Error{constructor(e,t){super(e),this.type=t,this.type=t,Object.setPrototypeOf(this,new.target.prototype)}}function Ht(e,t,n=exports.LogLevel.ERROR,r=exports.StackLayer.JS_LIB){t?null==t||t.write({level:n,layer:r,message:e}):t||n!==exports.LogLevel.ERROR||console.error(e)}function Pt(e){return void 0!==e}exports.LogLevel=void 0,(et=exports.LogLevel||(exports.LogLevel={})).ERROR="error",et.WARNING="warning",et.INFO="info",exports.StackLayer=void 0,(tt=exports.StackLayer||(exports.StackLayer={})).CHROME_EXTENSION="chrome-extension",tt.NATIVE_CONSOLE="native-console",tt.JS_LIB="js-lib",exports.ErrorType=void 0,(nt=exports.ErrorType||(exports.ErrorType={})).SDK_USAGE_ERROR="sdk-usage-error",nt.FEATURE_NOT_SUPPORTED="feature-not-supported",nt.DEVICE_ERROR="device-error",nt.UNEXPECTED_ERROR="unexpected-error",nt.INIT_ERROR="init-error";class Ut{constructor(e,t){this.compare=t,this.remove=new J,this.itemRemoved=this.remove,this.items=new Z([]),this.itemList=this.items,this.itemAdded=e.pipe(Fe((e=>(this.addItem(e),e))),Ct()),this.itemAdded.subscribe({next:e=>{e.onDisconnect.pipe(Tt(),Fe((()=>this.removeItem(e.id))),ut(Pt)).subscribe((e=>this.remove.next(e)))},error:I}),this.itemRemoved.subscribe({error:I})}getValue(){return[...this.items.getValue()]}addItem(e){if(this.items.getValue().filter((t=>t.id.equals(e.id))).length>0)throw new Dt("This item has already been added.",exports.ErrorType.UNEXPECTED_ERROR);const t=this.items.getValue().concat([e]);t.sort(this.compare),this.items.next(t)}removeItem(e){const t=this.getValue(),n=t.findIndex((t=>t.id.equals(e)));if(-1===n)throw new Dt("Item not found and therefore cannot be removed.",exports.ErrorType.UNEXPECTED_ERROR);const r=t.splice(n,1)[0];return this.items.next(t),r}}class kt{constructor(e,t){var n;this.sdkVersion=null!==(n="4.2.1")?n:"0.0.1-local",this.consoleAppVersion=e.pipe(Tt((e=>"ready"===e.event)),Fe((e=>e.version)),Ge(1e3),Nt(1),ft((()=>Re(null)))),this.chromeExtensionVersion=e.pipe(Tt((e=>"chrome-extension-ready"===e.event)),Fe((e=>e.version)),Ge(1e3),Nt(1),ft((()=>Re(null)))),dt(this.consoleAppVersion,this.chromeExtensionVersion).subscribe((e=>{const n=`sdkVersion: ${this.sdkVersion} | chromeHostVersion: ${e[0]}`;let r;r="undefined"!=typeof process?`${n} | nodeVersion: ${process.version} | platform: ${process.platform}`:`${n} | chromeExtensionVersion: ${e[1]} | browserUserAgent: ${window.navigator.userAgent}`,Ht(r,t,exports.LogLevel.INFO)}))}}class Gt{constructor(e,t,n){this.deviceDetector=e,this.deviceAdded=this.deviceDetector.deviceObservables.itemAdded,this.deviceRemoved=this.deviceDetector.deviceObservables.itemRemoved,this.deviceList=this.deviceDetector.deviceObservables.itemList,rt.set(this,void 0),this._transport=t,this._readyEvents=t.consoleAppEvent.pipe(ut((e=>"ready"===e.event||"chrome-extension-ready"===e.event)),Nt(2)),this._readyEvents.subscribe(),this._config=n,this.transportContext=t.context,y(this,rt,new kt(this._readyEvents,null==n?void 0:n.logger),"f")}getVersion(){return g(this,rt,"f").sdkVersion}getChromehostVersion(){return Pe(g(this,rt,"f").consoleAppVersion)}getChromeExtensionVersion(){return Pe(g(this,rt,"f").chromeExtensionVersion)}}rt=new WeakMap,exports.TransportContext=void 0,(ot=exports.TransportContext||(exports.TransportContext={})).NODE="node",ot.CHROME_EXTENSION="chrome-extension",ot.WEB_HID="web-hid",exports.RequestedBrowserTransport=void 0,(it=exports.RequestedBrowserTransport||(exports.RequestedBrowserTransport={})).CHROME_EXTENSION="chrome-extension",it.WEB_HID="web-hid",it.CHROME_EXTENSION_WITH_WEB_HID_FALLBACK="chrome-extension-with-web-hid-fallback";class Mt{constructor(e,t){this.log=e.consoleAppEvent.pipe(ut((e=>"log"===e.event)),Fe((e=>({message:e.message,level:e.level,layer:e.layer})))),this.log.subscribe((e=>Ht(e.message,t,e.level,e.layer)))}}const Ft=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920];class Bt{constructor(e){this.config=e,this.messageShown=!1}validateOrganizationKey(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.partnerKey))return void this.logWarning("No partner key provided.");this.validateCrc(this.config.partnerKey)||this.logWarning("Invalid partner key.")}validateAppId(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.appId))return void this.logWarning("No app identifier provided.");if(this.config.appId.length<3)return void this.logWarning("The appId should be minimum 3 characters.",!1);if(this.config.appId.length>100)return void this.logWarning("The appId should be no longer than 100 characters.",!1);/^[A-Za-z0-9\-_]+$/.test(this.config.appId)||this.logWarning("The appId is invalid. Should consist of letters, numbers, underscores or dashes",!1)}validateAppName(){var e;if(!(null===(e=this.config)||void 0===e?void 0:e.appName))return void this.logWarning("No app name provided. Will fallback to use appId as name.",!1);if(!/^[\x20-\x7F]*$/.test(this.config.appName))return void this.logWarning("The app name can only contain ASCII characters",!1);if(this.config.appName.length>100)return void this.logWarning("The app name should be no longer than 100 characters.",!1);/^[A-Za-z0-9]+[A-Za-z0-9 &-]*$/g.test(this.config.appName)||this.logWarning("The appName is invalid. Name should consist of letters, numbers, spaces, ampersands and dashes. Name should not begin with spaces, ampersands or dashes.",!1)}logWarning(e,t=!0){if(this.messageShown)return;this.messageShown=!0;t?console.warn(`\n        ${e}\n        \n        Add keys to the config object on initialization.\n        E.g. await init({\n          partnerKey: 'my-partner-key-from-developer-zone',\n          appId: 'my-self-chosen-app-id',\n          appName: 'My App Name'\n        });\n\n        Please obtain a valid partner key from https://developer.jabra.com.\n        The key will ensure interoperability with other Jabra apps and services, and mitigate\n        some co-existence issues with other softphone applications.\n\n        The package will continue to work without the keys, but we do not recommend production release\n        without it. Read more on the Developer Zone.\n      \n      `):console.warn(e)}validateCrc(e){const[t,...n]=e.split("-"),r=function(e){let t,n,r=65535;for(n=0;n<e.length;n+=1){const o=e.charCodeAt(n);if(o>255)throw new RangeError;t=255&(o^r>>8),r=Ft[t]^r<<8}return 65535&(0^r)}(n.join("-")).toString(16).padStart(4,"0");return t===r}}var Kt,Wt,jt,Yt,Vt,qt,$t,zt;!function(e){e[e.MS_OC=0]="MS_OC",e[e.CISCO=1]="CISCO",e[e.AVAYA=2]="AVAYA",e[e.SIEMENS=3]="SIEMENS",e[e.ALCATEL=4]="ALCATEL",e[e.IBM=5]="IBM",e[e.AASTRA=6]="AASTRA",e[e.SKYPE=7]="SKYPE",e[e.GENERIC=8]="GENERIC",e[e.NORTEL=9]="NORTEL",e[e.JABRA=10]="JABRA",e[e.NEC=11]="NEC",e[e.SHORETEL=12]="SHORETEL",e[e.OTHER=255]="OTHER"}(Kt||(Kt={}));class Qt{constructor(e,t){this.gnpReadCommand=e,this.serialize=t,this.command=e.command,this.subCommand=e.subCommand}deserialize(e){return this.gnpReadCommand.deserialize(e)}}!function(e){e[e.GN_PROTOCOL=65280]="GN_PROTOCOL"}(Wt||(Wt={})),function(e){e[e.DATA=1]="DATA"}(jt||(jt={}));class Jt{constructor(e,t,n,r,o,i=new Uint8Array,s=0){this.destination=e,this.source=t,this.type=n,this.command=r,this.subCommand=o,this.payload=i,this.sequenceNumber=s}}!function(e){e[e.PC_ADDR=0]="PC_ADDR",e[e.BASE_ADDR=1]="BASE_ADDR",e[e.HS1_ADDR=4]="HS1_ADDR",e[e.HS_BT_USB_ADDR=8]="HS_BT_USB_ADDR",e[e.HS_CRADLE_ADDR=10]="HS_CRADLE_ADDR",e[e.CRADLE_ADDR=21]="CRADLE_ADDR"}(Yt||(Yt={})),function(e){e[e.EVENT=0]="EVENT",e[e.READ=1]="READ",e[e.WRITE=2]="WRITE",e[e.REPLY=3]="REPLY"}(Vt||(Vt={})),function(e){e[e.IDENT=2]="IDENT",e[e.DFU=7]="DFU",e[e.DEVICE=13]="DEVICE",e[e.FWU=15]="FWU",e[e.STATUS=18]="STATUS",e[e.CONFIG=19]="CONFIG",e[e.NACK=254]="NACK",e[e.ACK=255]="ACK"}(qt||(qt={})),function(e){e[e.CONFIG_PREFERRED_SOFTPHONE=34]="CONFIG_PREFERRED_SOFTPHONE",e[e.ID=1]="ID",e[e.IDENT_GET_AVAILABLE_SOFTPHONES=16]="IDENT_GET_AVAILABLE_SOFTPHONES",e[e.TYPE=2]="TYPE",e[e.NAME=0]="NAME",e[e.PID=17]="PID",e[e.ATTACH_EVENT=1]="ATTACH_EVENT",e[e.DETACH_EVENT=2]="DETACH_EVENT"}($t||($t={})),function(e){e[e.NO_ERROR_CODE=0]="NO_ERROR_CODE",e[e.BAD_STATE=243]="BAD_STATE",e[e.TRANSMIT_FAILED=244]="TRANSMIT_FAILED",e[e.ILLEGAL_ADDR=245]="ILLEGAL_ADDR",e[e.UNKNOWN_CMD=246]="UNKNOWN_CMD",e[e.FILE_NOT_FOUND=247]="FILE_NOT_FOUND",e[e.INTERNAL_ERROR=248]="INTERNAL_ERROR",e[e.REPLY_ERROR=249]="REPLY_ERROR",e[e.ILLEGAL_PARAM=250]="ILLEGAL_PARAM",e[e.OUT_OF_SEQUENCE=251]="OUT_OF_SEQUENCE",e[e.NO_SPACE=252]="NO_SPACE",e[e.ACCESS_DENIED=253]="ACCESS_DENIED",e[e.NO_MORE_DATA=254]="NO_MORE_DATA",e[e.UNKNOWN_SUB_CMD=255]="UNKNOWN_SUB_CMD"}(zt||(zt={}));const Xt={command:qt.DEVICE,subCommand:$t.ATTACH_EVENT,serialize:e=>Uint8Array.from([5,0])};function Zt(e){const t=e.payload,n=t[0],r=t.length-1;if(r!==n)throw new Dt(`Invalid response. Expected length: ${n}, actual: ${r}`,exports.ErrorType.DEVICE_ERROR);const o=t.slice(1);return String.fromCharCode(...Array.from(o))}class en{constructor(){var e;this.command=qt.IDENT,this.subCommand=$t.IDENT_GET_AVAILABLE_SOFTPHONES,this.deserialize=(e=e=>e,t=>{const n=t.payload,r=n[0],o=n.length-1;if(o!==r)throw new Dt(`Invalid response. Expected length: ${r}, actual: ${o}`,exports.ErrorType.DEVICE_ERROR);const i=[];return n.slice(1).forEach((t=>{i.push(e(t))})),i})}}const tn={command:qt.IDENT,subCommand:$t.NAME,deserialize:Zt},nn={command:qt.IDENT,subCommand:$t.PID,deserialize:function(e){const t=e instanceof Jt?e.payload:e;return new DataView(t.buffer).getUint16(0,!0)}},rn={command:qt.CONFIG,subCommand:$t.CONFIG_PREFERRED_SOFTPHONE,deserialize:e=>e.payload[0],serialize:e=>Uint8Array.of(e)},on={command:qt.IDENT,subCommand:$t.TYPE,deserialize:e=>e.source},sn={command:qt.IDENT,subCommand:$t.ID,deserialize:Zt};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function an(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var cn,ln,un=an((function(e){
/*!
**  Pure-UUID -- Pure JavaScript Based Universally Unique Identifier (UUID)
**  Copyright (c) 2004-2020 Dr. Ralf S. Engelschall <rse@engelschall.com>
**
**  Permission is hereby granted, free of charge, to any person obtaining
**  a copy of this software and associated documentation files (the
**  "Software"), to deal in the Software without restriction, including
**  without limitation the rights to use, copy, modify, merge, publish,
**  distribute, sublicense, and/or sell copies of the Software, and to
**  permit persons to whom the Software is furnished to do so, subject to
**  the following conditions:
**
**  The above copyright notice and this permission notice shall be included
**  in all copies or substantial portions of the Software.
**
**  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
**  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
**  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
**  IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
**  CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
**  TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
**  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
e.exports=function(){var e=function(e,t,n,r,o,i){for(var s=function(e,t){var n=e.toString(16);return n.length<2&&(n="0"+n),t&&(n=n.toUpperCase()),n},a=t;a<=n;a++)o[i++]=s(e[a],r);return o},t=function(e,t,n,r,o){for(var i=t;i<=n;i+=2)r[o++]=parseInt(e.substr(i,2),16)},n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),r=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0],o=function(e,t){if(t%4!=0)throw new Error("z85_encode: invalid input length (multiple of 4 expected)");for(var r="",o=0,i=0;o<t;)if(i=256*i+e[o++],o%4==0){for(var s=52200625;s>=1;){var a=Math.floor(i/s)%85;r+=n[a],s/=85}i=0}return r},i=function(e,t){var n=e.length;if(n%5!=0)throw new Error("z85_decode: invalid input length (multiple of 5 expected)");void 0===t&&(t=new Array(4*n/5));for(var o=0,i=0,s=0;o<n;){var a=e.charCodeAt(o++)-32;if(a<0||a>=r.length)break;if(s=85*s+r[a],o%5==0){for(var c=16777216;c>=1;)t[i++]=Math.trunc(s/c%256),c/=256;s=0}}return t},s=function(e,t){var n={ibits:8,obits:8,obigendian:!0};for(var r in t)void 0!==n[r]&&(n[r]=t[r]);for(var o,i,s,a=[],c=0,l=0,u=0,h=e.length;0===l&&(i=e.charCodeAt(c++)),o=i>>n.ibits-(l+8)&255,l=(l+8)%n.ibits,n.obigendian?0===u?s=o<<n.obits-8:s|=o<<n.obits-8-u:0===u?s=o:s|=o<<u,!(0==(u=(u+8)%n.obits)&&(a.push(s),c>=h)););return a},a=function(e,t){var n={ibits:32,ibigendian:!0};for(var r in t)void 0!==n[r]&&(n[r]=t[r]);var o="",i=4294967295;n.ibits<32&&(i=(1<<n.ibits)-1);for(var s=e.length,a=0;a<s;a++)for(var c=e[a]&i,l=0;l<n.ibits;l+=8)n.ibigendian?o+=String.fromCharCode(c>>n.ibits-8-l&255):o+=String.fromCharCode(c>>l&255);return o},c=8,l=8,u=256,h=function(e,t,n,r,o,i,s,a){return[a,s,i,o,r,n,t,e]},p=function(){return h(0,0,0,0,0,0,0,0)},d=function(e){return e.slice(0)},f=function(e){for(var t=p(),n=0;n<c;n++)t[n]=Math.floor(e%u),e/=u;return t},v=function(e){for(var t=0,n=c-1;n>=0;n--)t*=u,t+=e[n];return Math.floor(t)},E=function(e,t){for(var n=0,r=0;r<c;r++)n+=e[r]+t[r],e[r]=Math.floor(n%u),n=Math.floor(n/u);return n},g=function(e,t){for(var n=0,r=0;r<c;r++)n+=e[r]*t,e[r]=Math.floor(n%u),n=Math.floor(n/u);return n},y=function(e,t){var n,r,o,i=new Array(c+c);for(n=0;n<c+c;n++)i[n]=0;for(n=0;n<c;n++){for(o=0,r=0;r<c;r++)o+=e[n]*t[r]+i[n+r],i[n+r]=o%u,o/=u;for(;r<c+c-n;r++)o+=i[n+r],i[n+r]=o%u,o/=u}for(n=0;n<c;n++)e[n]=i[n];return i.slice(c,c)},m=function(e,t){for(var n=0;n<c;n++)e[n]&=t[n];return e},_=function(e,t){for(var n=0;n<c;n++)e[n]|=t[n];return e},b=function(e,t){var n=p();if(t%l!=0)throw new Error("ui64_rorn: only bit rotations supported with a multiple of digit bits");for(var r=Math.floor(t/l),o=0;o<r;o++){for(var i=c-1-1;i>=0;i--)n[i+1]=n[i];for(n[0]=e[0],i=0;i<c-1;i++)e[i]=e[i+1];e[i]=0}return v(n)},T=function(e,t){if(t>c*l)throw new Error("ui64_ror: invalid number of bits to shift");var n,r=new Array(c+c);for(n=0;n<c;n++)r[n+c]=e[n],r[n]=0;var o=Math.floor(t/l),i=t%l;for(n=o;n<c+c-1;n++)r[n-o]=(r[n]>>>i|r[n+1]<<l-i)&(1<<l)-1;for(r[c+c-1-o]=r[c+c-1]>>>i&(1<<l)-1,n=c+c-1-o+1;n<c+c;n++)r[n]=0;for(n=0;n<c;n++)e[n]=r[n+c];return r.slice(0,c)},w=function(e,t){if(t>c*l)throw new Error("ui64_rol: invalid number of bits to shift");var n,r=new Array(c+c);for(n=0;n<c;n++)r[n+c]=0,r[n]=e[n];var o=Math.floor(t/l),i=t%l;for(n=c-1-o;n>0;n--)r[n+o]=(r[n]<<i|r[n-1]>>>l-i)&(1<<l)-1;for(r[0+o]=r[0]<<i&(1<<l)-1,n=0+o-1;n>=0;n--)r[n]=0;for(n=0;n<c;n++)e[n]=r[n];return r.slice(c,c)},O=function(e,t){for(var n=0;n<c;n++)e[n]^=t[n]},C=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},S=function(e,t){return e<<t&4294967295|e>>>32-t&4294967295},N=function(e,t){function n(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function r(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var o=Array(80),i=1732584193,s=-271733879,a=-1732584194,c=271733878,l=-1009589776,u=0;u<e.length;u+=16){for(var h=i,p=s,d=a,f=c,v=l,E=0;E<80;E++){o[E]=E<16?e[u+E]:S(o[E-3]^o[E-8]^o[E-14]^o[E-16],1);var g=C(C(S(i,5),n(E,s,a,c)),C(C(l,o[E]),r(E)));l=c,c=a,a=S(s,30),s=i,i=g}i=C(i,h),s=C(s,p),a=C(a,d),c=C(c,f),l=C(l,v)}return[i,s,a,c,l]},x=function(e){return a(N(s(e,{ibits:8,obits:32,obigendian:!0}),8*e.length),{ibits:32,ibigendian:!0})},A=function(e,t){function n(e,t,n,r,o,i){return C(S(C(C(t,e),C(r,i)),o),n)}function r(e,t,r,o,i,s,a){return n(t&r|~t&o,e,t,i,s,a)}function o(e,t,r,o,i,s,a){return n(t&o|r&~o,e,t,i,s,a)}function i(e,t,r,o,i,s,a){return n(t^r^o,e,t,i,s,a)}function s(e,t,r,o,i,s,a){return n(r^(t|~o),e,t,i,s,a)}e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var a=1732584193,c=-271733879,l=-1732584194,u=271733878,h=0;h<e.length;h+=16){var p=a,d=c,f=l,v=u;a=r(a,c,l,u,e[h+0],7,-680876936),u=r(u,a,c,l,e[h+1],12,-389564586),l=r(l,u,a,c,e[h+2],17,606105819),c=r(c,l,u,a,e[h+3],22,-1044525330),a=r(a,c,l,u,e[h+4],7,-176418897),u=r(u,a,c,l,e[h+5],12,1200080426),l=r(l,u,a,c,e[h+6],17,-1473231341),c=r(c,l,u,a,e[h+7],22,-45705983),a=r(a,c,l,u,e[h+8],7,1770035416),u=r(u,a,c,l,e[h+9],12,-1958414417),l=r(l,u,a,c,e[h+10],17,-42063),c=r(c,l,u,a,e[h+11],22,-1990404162),a=r(a,c,l,u,e[h+12],7,1804603682),u=r(u,a,c,l,e[h+13],12,-40341101),l=r(l,u,a,c,e[h+14],17,-1502002290),a=o(a,c=r(c,l,u,a,e[h+15],22,1236535329),l,u,e[h+1],5,-165796510),u=o(u,a,c,l,e[h+6],9,-1069501632),l=o(l,u,a,c,e[h+11],14,643717713),c=o(c,l,u,a,e[h+0],20,-373897302),a=o(a,c,l,u,e[h+5],5,-701558691),u=o(u,a,c,l,e[h+10],9,38016083),l=o(l,u,a,c,e[h+15],14,-660478335),c=o(c,l,u,a,e[h+4],20,-405537848),a=o(a,c,l,u,e[h+9],5,568446438),u=o(u,a,c,l,e[h+14],9,-1019803690),l=o(l,u,a,c,e[h+3],14,-187363961),c=o(c,l,u,a,e[h+8],20,1163531501),a=o(a,c,l,u,e[h+13],5,-1444681467),u=o(u,a,c,l,e[h+2],9,-51403784),l=o(l,u,a,c,e[h+7],14,1735328473),a=i(a,c=o(c,l,u,a,e[h+12],20,-1926607734),l,u,e[h+5],4,-378558),u=i(u,a,c,l,e[h+8],11,-2022574463),l=i(l,u,a,c,e[h+11],16,1839030562),c=i(c,l,u,a,e[h+14],23,-35309556),a=i(a,c,l,u,e[h+1],4,-1530992060),u=i(u,a,c,l,e[h+4],11,1272893353),l=i(l,u,a,c,e[h+7],16,-155497632),c=i(c,l,u,a,e[h+10],23,-1094730640),a=i(a,c,l,u,e[h+13],4,681279174),u=i(u,a,c,l,e[h+0],11,-358537222),l=i(l,u,a,c,e[h+3],16,-722521979),c=i(c,l,u,a,e[h+6],23,76029189),a=i(a,c,l,u,e[h+9],4,-640364487),u=i(u,a,c,l,e[h+12],11,-421815835),l=i(l,u,a,c,e[h+15],16,530742520),a=s(a,c=i(c,l,u,a,e[h+2],23,-995338651),l,u,e[h+0],6,-198630844),u=s(u,a,c,l,e[h+7],10,1126891415),l=s(l,u,a,c,e[h+14],15,-1416354905),c=s(c,l,u,a,e[h+5],21,-57434055),a=s(a,c,l,u,e[h+12],6,1700485571),u=s(u,a,c,l,e[h+3],10,-1894986606),l=s(l,u,a,c,e[h+10],15,-1051523),c=s(c,l,u,a,e[h+1],21,-2054922799),a=s(a,c,l,u,e[h+8],6,1873313359),u=s(u,a,c,l,e[h+15],10,-30611744),l=s(l,u,a,c,e[h+6],15,-1560198380),c=s(c,l,u,a,e[h+13],21,1309151649),a=s(a,c,l,u,e[h+4],6,-145523070),u=s(u,a,c,l,e[h+11],10,-1120210379),l=s(l,u,a,c,e[h+2],15,718787259),c=s(c,l,u,a,e[h+9],21,-343485551),a=C(a,p),c=C(c,d),l=C(l,f),u=C(u,v)}return[a,c,l,u]},I=function(e){return a(A(s(e,{ibits:8,obits:32,obigendian:!1}),8*e.length),{ibits:32,ibigendian:!1})},R=function(e){this.mul=h(88,81,244,45,76,149,127,45),this.inc=h(20,5,123,126,247,103,129,79),this.mask=h(0,0,0,0,255,255,255,255),this.state=d(this.inc),this.next(),m(this.state,this.mask),e=f(void 0!==e?e>>>0:4294967295*Math.random()>>>0),_(this.state,e),this.next()};R.prototype.next=function(){var e=d(this.state);y(this.state,this.mul),E(this.state,this.inc);var t=d(e);T(t,18),O(t,e),T(t,27);var n=d(e);T(n,59),m(t,this.mask);var r=v(n),o=d(t);return w(o,32-r),T(t,r),O(t,o),v(t)};var L=new R,D=function(e,t){for(var n=[],r=0;r<e;r++)n[r]=L.next()%t;return n},H=0,P=0,U=function(){if(1===arguments.length&&"string"==typeof arguments[0])this.parse.apply(this,arguments);else if(arguments.length>=1&&"number"==typeof arguments[0])this.make.apply(this,arguments);else{if(arguments.length>=1)throw new Error("UUID: constructor: invalid arguments");for(var e=0;e<16;e++)this[e]=0}};return"undefined"!=typeof Uint8Array?U.prototype=new Uint8Array(16):Buffer?U.prototype=Buffer.alloc(16):U.prototype=new Array(16),U.prototype.constructor=U,U.prototype.make=function(e){var t,n=this;if(1===e){var r=(new Date).getTime();r!==H?P=0:P++,H=r;var o,i=f(r);g(i,1e4),E(i,h(1,178,29,210,19,129,64,0)),P>0&&E(i,f(P)),o=b(i,8),n[3]=255&o,o=b(i,8),n[2]=255&o,o=b(i,8),n[1]=255&o,o=b(i,8),n[0]=255&o,o=b(i,8),n[5]=255&o,o=b(i,8),n[4]=255&o,o=b(i,8),n[7]=255&o,o=b(i,8),n[6]=15&o;var s=D(2,255);n[8]=s[0],n[9]=s[1];var a=D(6,255);for(a[0]|=1,a[0]|=2,t=0;t<6;t++)n[10+t]=a[t]}else if(4===e){var c=D(16,255);for(t=0;t<16;t++)this[t]=c[t]}else{if(3!==e&&5!==e)throw new Error("UUID: make: invalid version");var l="",u="object"==typeof arguments[1]&&arguments[1]instanceof U?arguments[1]:(new U).parse(arguments[1]);for(t=0;t<16;t++)l+=String.fromCharCode(u[t]);l+=arguments[2];var p=3===e?I(l):x(l);for(t=0;t<16;t++)n[t]=p.charCodeAt(t)}return n[6]&=15,n[6]|=e<<4,n[8]&=63,n[8]|=128,n},U.prototype.format=function(t){var n,r;return"z85"===t?n=o(this,16):"b16"===t?(r=Array(32),e(this,0,15,!0,r,0),n=r.join("")):void 0!==t&&"std"!==t||(r=new Array(36),e(this,0,3,!1,r,0),r[8]="-",e(this,4,5,!1,r,9),r[13]="-",e(this,6,7,!1,r,14),r[18]="-",e(this,8,9,!1,r,19),r[23]="-",e(this,10,15,!1,r,24),n=r.join("")),n},U.prototype.toString=function(e){return this.format(e)},U.prototype.toJSON=function(){return this.format("std")},U.prototype.parse=function(e,n){if("string"!=typeof e)throw new Error("UUID: parse: invalid argument (type string expected)");if("z85"===n)i(e,this);else if("b16"===n)t(e,0,35,this,0);else if(void 0===n||"std"===n){var r={nil:"00000000-0000-0000-0000-000000000000","ns:DNS":"6ba7b810-9dad-11d1-80b4-00c04fd430c8","ns:URL":"6ba7b811-9dad-11d1-80b4-00c04fd430c8","ns:OID":"6ba7b812-9dad-11d1-80b4-00c04fd430c8","ns:X500":"6ba7b814-9dad-11d1-80b4-00c04fd430c8"};if(void 0!==r[e])e=r[e];else if(!e.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))throw new Error('UUID: parse: invalid string representation (expected "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx")');t(e,0,7,this,0),t(e,9,12,this,4),t(e,14,17,this,6),t(e,19,22,this,8),t(e,24,35,this,10)}return this},U.prototype.export=function(){for(var e=Array(16),t=0;t<16;t++)e[t]=this[t];return e},U.prototype.import=function(e){if(!("object"==typeof e&&e instanceof Array))throw new Error("UUID: import: invalid argument (type Array expected)");if(16!==e.length)throw new Error("UUID: import: invalid argument (Array of length 16 expected)");for(var t=0;t<16;t++){if("number"!=typeof e[t])throw new Error("UUID: import: invalid array element #"+t+" (type Number expected)");if(!isFinite(e[t])||Math.floor(e[t])!==e[t])throw new Error("UUID: import: invalid array element #"+t+" (Number with integer value expected)");if(!(e[t]>=0&&e[t]<=255))throw new Error("UUID: import: invalid array element #"+t+" (Number with integer value in range 0...255 expected)");this[t]=e[t]}return this},U.prototype.compare=function(e){if("object"!=typeof e)throw new Error("UUID: compare: invalid argument (type UUID expected)");if(!(e instanceof U))throw new Error("UUID: compare: invalid argument (type UUID expected)");for(var t=0;t<16;t++){if(this[t]<e[t])return-1;if(this[t]>e[t])return 1}return 0},U.prototype.equal=function(e){return 0===this.compare(e)},U.prototype.fold=function(e){if(void 0===e)throw new Error("UUID: fold: invalid argument (number of fold operations expected)");if(e<1||e>4)throw new Error("UUID: fold: invalid argument (1-4 fold operations expected)");for(var t=16/Math.pow(2,e),n=new Array(t),r=0;r<t;r++){for(var o=0,i=0;r+i<16;i+=t)o^=this[r+i];n[r]=o}return n},U.PCG=R,U}(),e.exports.default=e.exports}));class hn{constructor(e){this.transport=e,this.gnpLockAcquired=e.consoleAppEvent.pipe(ut((e=>"response-gnp-lock"===e.event)),Fe((e=>e.token)),Nt(1)),this.gnpLockAcquired.subscribe()}acquireGnpLock(e){const t=new un(4).toString(),n={action:"request-gnp-lock",id:e,token:t},r=this.gnpLockAcquired.pipe(Tt((e=>e===t)));return this.transport.writeAction(n),r}releaseGnpLock(e,t){const n={action:"release-gnp-lock",id:e,token:t};this.transport.writeAction(n)}}exports.ReportType=void 0,(cn=exports.ReportType||(exports.ReportType={}))[cn.INPUT=0]="INPUT",cn[cn.OUTPUT=1]="OUTPUT",cn[cn.FEATURE=2]="FEATURE",exports.ValueType=void 0,(ln=exports.ValueType||(exports.ValueType={})).ABSOLUTE="absolute",ln.RELATIVE="relative";class pn{constructor(e){this.id=e}equals(e){return this.id===e.id}startsWith(e){return this.id.startsWith(e.id)}toString(){return this.id}}function dn(e,t,n){const r=e.toString(16).padStart(4,"0"),o=t.toString(16).padStart(4,"0");return new pn(`${r}:${o}:${n}`)}class fn{constructor(e,t,n,r){this.id=e,this.usagePage=t,this.usage=n,this.value=r}isArray(){return Array.isArray(this.value)}static deserialize(e,t){return new fn(new pn(e),t.usagePage,t.usage,t.value)}}class vn{constructor(e,t,n){this.descriptor=t,this.transport=n,this.transportId=e.transportId,this.input=n.consoleAppEvent.pipe(ut((e=>e.id===this.transportId)),vn.inputReportsFilter)}output(e,t,n){const r={action:"hid-output",id:this.transportId,usagePage:e,usage:t,value:n};this.transport.writeAction(r)}getFeatureReport(e,t){const n=new un(4).toString(),r={action:"request-hid-feature",id:this.transportId,token:n,usagePage:e,usage:t};return this.transport.writeAction(r),this.transport.consoleAppEvent.pipe(Tt((e=>"response-hid-feature"===e.event&&e.token===n)),Fe((e=>e.value)))}setFeatureReport(e,t,n){const r={action:"set-hid-feature",id:this.transportId,usagePage:e,usage:t,value:n};this.transport.writeAction(r)}findDescriptor(e,t,n){return this.descriptor.find((r=>r.usagePage===e&&r.usage===t&&r.reportType===n))}}function En(e){return t=>t.pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=he(e);return q((function(t,r){for(var o=e.length,i=new Array(o),s=e.map((function(){return!1})),a=!1,c=function(t){we(e[t]).subscribe($(r,(function(e){i[t]=e,a||s[t]||(s[t]=!0,(a=s.every(W))&&(s=null))}),I))},l=0;l<o;l++)c(l);t.subscribe($(r,(function(e){if(a){var t=d([e],p(i));r.next(n?n.apply(void 0,d([],p(t))):t)}})))}))}(e),ut((([e,t])=>t)),Fe((([e,t])=>e)))}vn.inputReportsFilter=e=>e.pipe(ut((e=>"hid-input"===e.event)),Fe((e=>fn.deserialize(e.id,e))));class gn{static typeFromAttr(e){return e>>6}static packetLengthFromAttr(e){return e&this.lengthMask}static deserialize(e){const t=e[0],n=e[1],r=e[2],o=this.typeFromAttr(e[3]),i=e[4],s=e[5],a=this.packetLengthFromAttr(e[3]),c=e.slice(6,a);return new Jt(t,n,o,i,s,c,r)}}gn.lengthMask=63;class yn{constructor(){this.data=[]}hasHeader(){return this.data.length>=yn.gnpPacketHeaderLength}expectedPacketLength(){if(!this.hasHeader())throw new Dt("Unable to get expected packet length without a full header",exports.ErrorType.UNEXPECTED_ERROR);return gn.packetLengthFromAttr(this.data[3])}appendData(e){this.hasHeader()&&this.expectedPacketLength()>yn.gnpPacketMaxLength&&(this.data=[]),this.data=this.data.concat(e)}hasFullPacket(){if(!this.hasHeader())return!1;const e=this.expectedPacketLength();return this.data.length>=e}getPacketAndReset(){if(!this.hasFullPacket())throw new Dt("Trying to get packet but buffer is not complete",exports.ErrorType.UNEXPECTED_ERROR);const e=gn.deserialize(Uint8Array.from(this.data));return this.data=[],e}}yn.gnpPacketHeaderLength=6,yn.gnpPacketMaxLength=63;class mn{static attrFromTypeAndPayloadLength(e,t){return(e<<6)+(t+6)}static serialize(e){const t=new Uint8Array(6);t[0]=e.destination,t[1]=e.source,t[2]=e.sequenceNumber,t[3]=this.attrFromTypeAndPayloadLength(e.type,e.payload.length),t[4]=e.command,t[5]=e.subCommand;const n=new Uint8Array(t.length+e.payload.length);return n.set(t),n.set(e.payload,t.length),n}}const _n=()=>{};function bn(e){return Lt((t=>e()),(t=>e()),(()=>_n))}const Tn=()=>{return e=e=>e.command===qt.NACK,t=e=>{const t=e.subCommand in zt?zt[e.subCommand]:e.subCommand;return new Dt(`Got NACK response. Reason: ${t}`,exports.ErrorType.DEVICE_ERROR)},n=>n.pipe(Fe((n=>e(n)?Le(t(n)):Re(n))),It());var e,t},wn=e=>Tt((t=>t.type===Vt.REPLY&&t.sequenceNumber===e.sequenceNumber&&t.destination===e.source&&t.source===e.destination));class On{constructor(e,t,n,r,o=0){this.hidChannel=e,this.gnpLock=t,this.transportId=n,this.primaryAddress=r,this.lockQueue=[],this.packets=e.input.pipe(On.inputFilter),this.events=this.packets.pipe(On.eventsFilter),this.nextSequenceNumber=o}static get inputFilter(){return e=>{const t=e.pipe(ut((e=>e.usagePage===Wt.GN_PROTOCOL&&e.usage===jt.DATA&&e.isArray()))),n=new yn;return t.pipe(We((e=>{const t=e.value;if(n.appendData(t),n.hasFullPacket()){return Re(n.getPacketAndReset())}return st})),Ct())}}static supportsGnpOverHid(e){return void 0!==e.findDescriptor(Wt.GN_PROTOCOL,jt.DATA,exports.ReportType.OUTPUT)}getNextSequenceNumber(){const e=this.nextSequenceNumber;return this.nextSequenceNumber=(this.nextSequenceNumber+1)%255,e}doWithGnpLockHeld(e){this.lockQueue.push(e),this.lockQueue.length>1||this.processLockQueue()}processLockQueue(){this.gnpLock.acquireGnpLock(this.transportId).subscribe((e=>{(0,this.lockQueue[0])((e=>{var t;const n=null===(t=this.hidChannel.findDescriptor(Wt.GN_PROTOCOL,jt.DATA,exports.ReportType.OUTPUT))||void 0===t?void 0:t.reportSize;if(!n)throw new Dt("Cannot send GNP packets to this device.",exports.ErrorType.DEVICE_ERROR);const r=mn.serialize(e);let o=0;do{const e=Math.min(r.length-o,n),t=r.subarray(o,o+e);o+=t.length,this.hidChannel.output(Wt.GN_PROTOCOL,jt.DATA,Array.from(t))}while(o<r.length)}),this.packets,(()=>{this.gnpLock.releaseGnpLock(this.transportId,e),this.lockQueue.splice(0,1),this.lockQueue.length>0&&this.processLockQueue()}))}))}sendEvent(e,t,n=this.primaryAddress){const r=new Jt(n,Yt.PC_ADDR,Vt.EVENT,e.command,e.subCommand,e.serialize(t),0);this.doWithGnpLockHeld(((e,t,n)=>{e(r),n()}))}read(e,t=this.primaryAddress,n=2500){const r=new Qt(e,(e=>new Uint8Array));return this.readWithParams(r,null,t,n)}readWithParams(e,t,n=this.primaryAddress,r=2500){const o=new Jt(n,Yt.PC_ADDR,Vt.READ,e.command,e.subCommand,e.serialize(t),this.getNextSequenceNumber()),i=new J;return this.doWithGnpLockHeld(((t,n,s)=>{n.pipe(wn(o),Tn(),Tt((e=>e.command===o.command&&e.subCommand===o.subCommand)),Ge(r),bn(s),Fe((t=>e.deserialize(t)))).subscribe(i),t(o)})),i}write(e,t,n=this.primaryAddress,r=2500){const o=new Jt(n,Yt.PC_ADDR,Vt.WRITE,e.command,e.subCommand,e.serialize(t),this.getNextSequenceNumber()),i=new J;return this.doWithGnpLockHeld(((e,t,n)=>{t.pipe(wn(o),Tn(),Tt((e=>e.command===qt.ACK)),Ge(r),bn(n),Fe((()=>!0))).subscribe(i),e(o)})),i}}On.eventsFilter=e=>e.pipe(ut((e=>e.type===Vt.EVENT)));class Cn{constructor(e,t){this.parentGnpChannel=e,this.primaryAddress=t,this.events=e.events.pipe(ut((e=>e.source===this.primaryAddress)))}sendEvent(e,t,n){this.parentGnpChannel.sendEvent(e,t,this.primaryAddress)}read(e,t,n){return this.parentGnpChannel.read(e,this.primaryAddress,n)}readWithParams(e,t,n,r){return this.parentGnpChannel.readWithParams(e,t,this.primaryAddress,r)}write(e,t,n,r){return this.parentGnpChannel.write(e,t,this.primaryAddress,r)}}function Sn(e,t,n,r){if(!On.supportsGnpOverHid(e))return Le((()=>new Dt("Device does not support GNP commands.",exports.ErrorType.DEVICE_ERROR)));const o=Re(Yt.HS_BT_USB_ADDR,Yt.BASE_ADDR,Yt.CRADLE_ADDR,Yt.HS1_ADDR,Yt.HS_CRADLE_ADDR).pipe(Fe(((r,o)=>qe((()=>{const i=new On(e,new hn(t),n,r,o);return i.read(on,r,500).pipe(Fe((e=>i)),ft((()=>ce)))})))),Ye(),gt(1),_t((()=>new Dt("GNP probe failed.",exports.ErrorType.DEVICE_ERROR))));return ht(r.pipe(We((e=>Le((()=>new Dt("Device was suddenly disconnected.",exports.ErrorType.DEVICE_ERROR)))))),o).pipe(Ct())}function Nn(e,t){return new Cn(e,t)}class xn{constructor(){this.primaryAddress=Yt.BASE_ADDR,this.events=st}subscribeToEvent(e,t){return Le((()=>new Dt("This device does not support GNP commands.",exports.ErrorType.FEATURE_NOT_SUPPORTED)))}sendEvent(e,t,n){throw new Dt("This device does not support GNP commands.",exports.ErrorType.FEATURE_NOT_SUPPORTED)}read(e,t,n){return Le((()=>new Dt("This device does not support GNP commands.",exports.ErrorType.FEATURE_NOT_SUPPORTED)))}readWithParams(e,t,n,r){return Le((()=>new Dt("This device does not support GNP commands.",exports.ErrorType.FEATURE_NOT_SUPPORTED)))}write(e,t,n,r){return Le((()=>new Dt("This device does not support GNP commands.",exports.ErrorType.FEATURE_NOT_SUPPORTED)))}}class An{constructor(e){this.transportId=e,this.isChild=!1}equals(e){return this.isChild===e.isChild&&this.transportId===e.transportId}toString(){return this.transportId}}class In{constructor(e,t){this.parentId=e,this.gnpAddress=t,this.isChild=!0,this.transportId=e.transportId}equals(e){if(this.isChild===e.isChild){const t=e;return this.parentId.equals(t.parentId)&&this.gnpAddress===t.gnpAddress}return!1}toString(){return`0x${e=this.gnpAddress,e.toString(16).padStart(2,"0").toUpperCase()}@${this.transportId}`;var e}}var Rn,Ln,Dn;exports.TrackingOptions=void 0,(Rn=exports.TrackingOptions||(exports.TrackingOptions={})).NO_TRACKING="no-tracking",Rn.TRACK_ERRORS="track-errors",Rn.TRACK_USAGE="track-usage",Rn.TRACK_ALL="track-all",exports.ConnectionType=void 0,(Ln=exports.ConnectionType||(exports.ConnectionType={}))[Ln.BLUETOOTH=0]="BLUETOOTH",Ln[Ln.INDIRECT=1]="INDIRECT",Ln[Ln.USB=2]="USB",exports.DeviceType=void 0,(Dn=exports.DeviceType||(exports.DeviceType={}))[Dn.BASE=0]="BASE",Dn[Dn.HEADSET=1]="HEADSET",Dn[Dn.DESKSTAND=2]="DESKSTAND",Dn[Dn.OTHER=3]="OTHER",Dn[Dn.DONGLE=4]="DONGLE",Dn[Dn.PC=5]="PC",Dn[Dn.EHS=6]="EHS",Dn[Dn.USB=7]="USB",Dn[Dn.SPEAKER_PHONE=8]="SPEAKER_PHONE",Dn[Dn.INDICATOR=9]="INDICATOR",Dn[Dn.MOBILE=10]="MOBILE",Dn[Dn.NONE=11]="NONE",Dn[Dn.LOCAL=12]="LOCAL",Dn[Dn.DISPLAY=13]="DISPLAY",Dn[Dn.HS_CRADLE=14]="HS_CRADLE",Dn[Dn.HS_CRADLE2=15]="HS_CRADLE2",Dn[Dn.MOBILE_IAP=16]="MOBILE_IAP",Dn[Dn.CRADLE=17]="CRADLE",Dn[Dn.VIDEO=18]="VIDEO",Dn[Dn.NOT_GN=252]="NOT_GN",Dn[Dn.ANY_GN=253]="ANY_GN",Dn[Dn.NOT_INIT=254]="NOT_INIT",Dn[Dn.ANY=255]="ANY";class Hn{constructor(e,t,n,r,o,i,s,a,c,l,u){this.id=e,this.type=t,this.hidChannel=n,this.events=r,this.primaryAddress=o,this.sendEvent=i,this.read=s,this.readWithParams=a,this.write=c,this.onDisconnect=l,this.parentConnectionId=u,this.onDisconnect.subscribe({error:I})}static createConnection(e,t,n,r,o,i){const s=r.sendEvent.bind(r),a=r.read.bind(r),c=r.readWithParams.bind(r),l=r.write.bind(r);return new Hn(e,t,n,r.events,r.primaryAddress,s,a,c,l,o,i)}}const Pn=(e=3,t=500)=>n=>n.pipe(We(((n,r)=>{const o=r+1;return o>e?Le((()=>n)):function(e,t,n){void 0===e&&(e=0),void 0===n&&(n=ae);var r=-1;return null!=t&&(le(t)?n=t:r=t),new Y((function(t){var o=Ue(e)?+e-n.now():e;o<0&&(o=0);var i=0;return n.schedule((function(){t.closed||(t.next(i++),0<=r?this.schedule(void 0,r):t.complete())}),o)}))}(o*o*t)})));function Un(e,t,n,r=1e3,o=3,i=100){return qe((()=>e.read(t,n,r))).pipe(Ot(Pn(o,i)))}function kn(e,t,n){const{deviceType:r,address:o}=n;return{transportId:t.transportId,vid:t.vid,pid:Un(e,nn,o),name:Un(e,tn,o),serialNumber:Un(e,sn,o),capabilities:t.capabilities,deviceType:r,connectionGnpAddress:o}}class Gn{constructor(e,t,n=kn,r=Hn.createConnection,o=Nn){this.parentConnection=t,this.connectionCreator=r,this.createChildGnpChannel=o;const i=t.events.pipe(ut((e=>e.command===qt.DEVICE&&e.subCommand===$t.ATTACH_EVENT)),Fe((e=>({deviceType:e.payload[0],address:e.payload[1]})))).pipe(Fe(n.bind(null,t,e)));this.connectionEvents=i.pipe(Fe((e=>{const n=ht(t.events.pipe(Tt((t=>t.command===qt.DEVICE&&t.subCommand===$t.DETACH_EVENT&&t.payload[1]===e.connectionGnpAddress)),Fe(I)),t.onDisconnect);return{attach:e,detach:n}})),We((e=>dt(Re(e.attach),this.createConnection(e.attach,e.detach)))),Fe((([e,t])=>({event:e,connection:t}))),Rt(t.onDisconnect)),t.sendEvent(Xt,[])}createConnection(e,t){const n=e.connectionGnpAddress,r=this.createChildGnpChannel(this.parentConnection,n),o=new In(this.parentConnection.id,n);return Re(this.connectionCreator(o,exports.ConnectionType.INDIRECT,this.parentConnection.hidChannel,r,t,this.parentConnection.id))}}const Mn={command:qt.IDENT,subCommand:$t.TYPE,deserialize:e=>{const{payload:t}=e,n=t[0];if(n<1||n>=t.length)throw new Dt("Cannot get device type.",exports.ErrorType.DEVICE_ERROR);return t[1]}};function Fn(e,t,n,r=exports.LogLevel.ERROR,o=exports.StackLayer.JS_LIB){const i=`${e} ${function(e){if(e instanceof Dt){const t=e;return`JabraError: ${t.message} (type: ${t.type})`}if(e instanceof Error){const t=e;return`Error: ${t.message} (name: ${t.name})`}return`Unknown error: ${e}`}(t)}`;Ht(i,n,r,o)}function Bn(e){return new Gn(e.event,e.connection).connectionEvents}class Kn{constructor(e,t,n=((e,t,n)=>new vn(e,t,n)),r=Sn,o=Bn,i=Hn.createConnection){this.transport=e,this.logger=t,this.createHidChannel=n,this.createRootGnpChannel=r,this.connectionCreator=i;const s=this.transport.consoleAppEvent.pipe(ut((e=>"attach"===e.event)),Fe(Kn.createAttachEvent),ft(((e,t)=>(Fn("",e,this.logger),t)))).pipe(Fe((e=>{const t=this.transport.consoleAppEvent.pipe(ut((e=>"detach"===e.event)),Tt((t=>Kn.getTransportId(t)===e.transportId)),Fe(I),Nt());return t.subscribe(),{attach:e,detach:t}})),We((e=>this.createConnection(e.attach,e.detach))),Ct()),a=s.pipe(ut((e=>e.event.deviceType===exports.DeviceType.DONGLE)),ut((e=>On.supportsGnpOverHid(e.connection.hidChannel))),We((e=>o(e))));this.connectionEvents=Ze(s,a).pipe(Ct())}static convertToReportType(e){switch(e){case"input":return exports.ReportType.INPUT;case"output":return exports.ReportType.OUTPUT;case"feature":return exports.ReportType.FEATURE;default:throw new Dt(`${e} is not a valid ReportType`,exports.ErrorType.UNEXPECTED_ERROR)}}static convertToValueType(e){switch(e){case"absolute":return exports.ValueType.ABSOLUTE;case"relative":return exports.ValueType.RELATIVE;default:throw new Dt(`${e} Not a valid ValueType`,exports.ErrorType.UNEXPECTED_ERROR)}}static createDescriptor(e){return e.map((e=>({reportType:Kn.convertToReportType(e.reportType),usagePage:e.usagePage,usage:e.usage,valueType:Kn.convertToValueType(e.valueType),reportSize:e.reportSize})))}static getMandatoryField(e,t){const n=e[t];if(void 0===n)throw new Dt(`JSON event lacks required field "${t}: ${JSON.stringify(e)}`,exports.ErrorType.UNEXPECTED_ERROR);return n}static getTransportId(e){return Kn.getMandatoryField(e,"id")}static createAttachEvent(e){return{transportId:Kn.getTransportId(e),vid:Kn.getMandatoryField(e,"vid"),pid:Re(Kn.getMandatoryField(e,"pid")),name:Re(Kn.getMandatoryField(e,"name")),serialNumber:Re(Kn.getMandatoryField(e,"serialNumber")),capabilities:Kn.createDescriptor(Kn.getMandatoryField(e,"descriptor"))}}createConnection(e,t,n=3,r=100){const{capabilities:o,transportId:i}=e,s=new An(i),a=this.createHidChannel(s,o,this.transport),c=this.createRootGnpChannel(a,this.transport,i,t).pipe(ft(((e,t)=>(e.type&&e.type===exports.ErrorType.DEVICE_ERROR&&this.transport.context===exports.TransportContext.WEB_HID&&Ht("Child devices are not yet supported when using WebHID.",this.logger,exports.LogLevel.WARNING,exports.StackLayer.JS_LIB),Re(new xn)))),Ct()),l=c.pipe(We((e=>e.read(Mn))),Ot(Pn(n,r)),ft((e=>Re(exports.DeviceType.ANY))));return dt(c,l).pipe(Rt(t),Fe((([n,r])=>({event:Object.assign(Object.assign({},e),{deviceType:r,connectionGnpAddress:n.primaryAddress}),connection:this.connectionCreator(s,exports.ConnectionType.USB,a,n,t)}))))}}var Wn,jn,Yn,Vn,qn,$n,zn,Qn,Jn,Xn,Zn,er,tr,nr,rr;class or{constructor(e,t,n,r,o,i){this.vendorId=e,this.productId=t,this.serialNumber=n,this.name=r,this.type=o,jn.set(this,void 0),y(this,jn,new Ut(i,g(or,Wn,"m",Vn)),"f"),this.connectionAdded=g(this,jn,"f").itemAdded,this.connectionRemoved=g(this,jn,"f").itemRemoved,this.connectionList=g(this,jn,"f").itemList,this.onDisconnect=g(this,jn,"f").itemList.pipe(xt(1),Tt((e=>0===e.length)),Fe(I),Ct())}get id(){return dn(this.vendorId,this.productId,this.serialNumber)}get currentConnections(){return g(this,jn,"f").getValue()}get browserLabel(){return`${this.vendorId.toString(16).padStart(4,"0")}:${this.productId.toString(16).padStart(4,"0")}`}}Wn=or,jn=new WeakMap,Vn=function(e,t){return g(or,Wn,"f",Yn).indexOf(e.type)-g(or,Wn,"f",Yn).indexOf(t.type)},Yn={value:[exports.ConnectionType.USB,exports.ConnectionType.INDIRECT,exports.ConnectionType.BLUETOOTH]};class ir{constructor(e){this.deviceObservables=new Ut(e)}static exceptionToUndefined(e){try{return e()}catch(e){if(e instanceof Dt)return;throw e}}connectionExists(e){return void 0!==ir.exceptionToUndefined((()=>this.findConnectionById(e)))}findConnectionById(e){for(const t of this.deviceObservables.getValue())for(const n of t.currentConnections)if(n.id.equals(e))return n;throw new Dt(`Could not find connection with id ${e.toString()}`,exports.ErrorType.UNEXPECTED_ERROR)}findDeviceByDeviceId(e){return this.deviceObservables.getValue().find((t=>t.id.startsWith(e)||e.startsWith(t.id)))}}class sr{constructor(e,t){this.logger=t;const[n,r]=(o=e.pipe(ut((e=>!this.deviceCollection.connectionExists(e.connection.id))),vt((e=>this.force(e)))),[ut(i=({event:e,pid:t,serialNumber:n})=>!this.deviceCollection.findDeviceByDeviceId(dn(e.event.vid,t,n)),s)(we(o)),ut(lt(i,s))(we(o))]);var o,i,s;const a=n.pipe(Fe((e=>sr.createDevice(e,r))));this.deviceCollection=new ir(a),this.deviceObservables=this.deviceCollection.deviceObservables}force(e){const{name:t,pid:n,serialNumber:r}=e.event,o=e.connection.onDisconnect.pipe((i=Le((()=>new Error(`Connection with ID ${e.connection.id} disconnected`))),m(s)?vt((function(){return i}),s):vt((function(){return i}))));var i,s;return dt(t,n,r).pipe(Fe((([t,n,r])=>({event:e,name:t,pid:n,serialNumber:r}))),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length?q((function(t,n){pt(d([t],p(e)))(n)})):W}(o),ft((e=>(Ht(`Failed to retrieve child connection information. Error: ${e}`,this.logger,exports.LogLevel.WARNING,exports.StackLayer.JS_LIB),ce))))}static createDevice(e,t){const{event:n,pid:r,name:o,serialNumber:i}=e,{vid:s,deviceType:a}=n.event,c=t.pipe(ut((t=>sr.isSameDevice(e,t))),Fe((e=>e.event.connection))),l=Ve(Re(n.connection),c);return new or(s,r,i,o,a,l)}static isSameDevice(e,t){const n=dn(e.event.event.vid,e.pid,e.serialNumber),r=dn(t.event.event.vid,t.pid,t.serialNumber);return n.startsWith(r)||r.startsWith(n)}static create(e,t){const n=new Kn(e,t);return new sr(n.connectionEvents)}}!function(e){e.UsageReport=class{constructor(e,t){this.usage=e,this.value=t}}}(qn||(qn={})),an((function(e){!function(t){var n=function(e,t,n){if(!(e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&e instanceof Buffer))throw new Error("Must specify a valid ArrayBuffer or Buffer.");t=t||0,n=n||e.byteLength||e.length,this._view=new Uint8Array(e.buffer||e,t,n),this.bigEndian=!1};n._scratch=new DataView(new ArrayBuffer(8)),Object.defineProperty(n.prototype,"buffer",{get:function(){return"undefined"!=typeof Buffer?Buffer.from(this._view.buffer):this._view.buffer},enumerable:!0,configurable:!1}),Object.defineProperty(n.prototype,"byteLength",{get:function(){return this._view.length},enumerable:!0,configurable:!1}),n.prototype._setBit=function(e,t){t?this._view[e>>3]|=1<<(7&e):this._view[e>>3]&=~(1<<(7&e))},n.prototype.getBits=function(e,t,n){var r=8*this._view.length-e;if(t>r)throw new Error("Cannot get "+t+" bit(s) from offset "+e+", "+r+" available");for(var o=0,i=0;i<t;){var s=t-i,a=7&e,c=this._view[e>>3],l=Math.min(s,8-a);this.bigEndian?(o<<=l,o|=c>>8-l-a&~(255<<l)):o|=(c>>a&~(255<<l))<<i,e+=l,i+=l}return n?(32!==t&&o&1<<t-1&&(o|=-1^(1<<t)-1),o):o>>>0},n.prototype.setBits=function(e,t,n){var r=8*this._view.length-e;if(n>r)throw new Error("Cannot set "+n+" bit(s) from offset "+e+", "+r+" available");for(var o=0;o<n;){var i,s,a,c=n-o,l=7&e,u=e>>3,h=Math.min(c,8-l);if(this.bigEndian){s=t>>n-o-h&(i=~(-1<<h));var p=8-l-h;a=~(i<<p),this._view[u]=this._view[u]&a|s<<p}else s=t&(i=~(255<<h)),t>>=h,a=~(i<<l),this._view[u]=this._view[u]&a|s<<l;e+=h,o+=h}},n.prototype.getBoolean=function(e){return 0!==this.getBits(e,1,!1)},n.prototype.getInt8=function(e){return this.getBits(e,8,!0)},n.prototype.getUint8=function(e){return this.getBits(e,8,!1)},n.prototype.getInt16=function(e){return this.getBits(e,16,!0)},n.prototype.getUint16=function(e){return this.getBits(e,16,!1)},n.prototype.getInt32=function(e){return this.getBits(e,32,!0)},n.prototype.getUint32=function(e){return this.getBits(e,32,!1)},n.prototype.getFloat32=function(e){return n._scratch.setUint32(0,this.getUint32(e)),n._scratch.getFloat32(0)},n.prototype.getFloat64=function(e){return n._scratch.setUint32(0,this.getUint32(e)),n._scratch.setUint32(4,this.getUint32(e+32)),n._scratch.getFloat64(0)},n.prototype.setBoolean=function(e,t){this.setBits(e,t?1:0,1)},n.prototype.setInt8=n.prototype.setUint8=function(e,t){this.setBits(e,t,8)},n.prototype.setInt16=n.prototype.setUint16=function(e,t){this.setBits(e,t,16)},n.prototype.setInt32=n.prototype.setUint32=function(e,t){this.setBits(e,t,32)},n.prototype.setFloat32=function(e,t){n._scratch.setFloat32(0,t),this.setBits(e,n._scratch.getUint32(0),32)},n.prototype.setFloat64=function(e,t){n._scratch.setFloat64(0,t),this.setBits(e,n._scratch.getUint32(0),32),this.setBits(e+32,n._scratch.getUint32(4),32)},n.prototype.getArrayBuffer=function(e,t){for(var n=new Uint8Array(t),r=0;r<t;r++)n[r]=this.getUint8(e+8*r);return n};var r=function(e,t){return function(){if(this._index+t>this._length)throw new Error("Trying to read past the end of the stream");var n=this._view[e](this._index);return this._index+=t,n}},o=function(e,t){return function(n){this._view[e](this._index,n),this._index+=t}};function i(e,t,n){if(0===t)return"";var r=0,o=[],i=!0,s=!!t;for(t||(t=Math.floor((e._length-e._index)/8));r<t;){var a=e.readUint8();if(0===a&&(i=!1,!s))break;i&&o.push(a),r++}var c=String.fromCharCode.apply(null,o);if(!n)return c;try{return decodeURIComponent(escape(c))}catch(e){return c}}var s=function(e,t,r){var o=e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&e instanceof Buffer;if(!(e instanceof n||o))throw new Error("Must specify a valid BitView, ArrayBuffer or Buffer");this._view=o?new n(e,t,r):e,this._index=0,this._startIndex=0,this._length=8*this._view.byteLength};Object.defineProperty(s.prototype,"index",{get:function(){return this._index-this._startIndex},set:function(e){this._index=e+this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"length",{get:function(){return this._length-this._startIndex},set:function(e){this._length=e+this._startIndex},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"bitsLeft",{get:function(){return this._length-this._index},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"byteIndex",{get:function(){return Math.ceil(this._index/8)},set:function(e){this._index=8*e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"buffer",{get:function(){return this._view.buffer},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"bigEndian",{get:function(){return this._view.bigEndian},set:function(e){this._view.bigEndian=e},enumerable:!0,configurable:!1}),s.prototype.readBits=function(e,t){var n=this._view.getBits(this._index,e,t);return this._index+=e,n},s.prototype.writeBits=function(e,t){this._view.setBits(this._index,e,t),this._index+=t},s.prototype.readBoolean=r("getBoolean",1),s.prototype.readInt8=r("getInt8",8),s.prototype.readUint8=r("getUint8",8),s.prototype.readInt16=r("getInt16",16),s.prototype.readUint16=r("getUint16",16),s.prototype.readInt32=r("getInt32",32),s.prototype.readUint32=r("getUint32",32),s.prototype.readFloat32=r("getFloat32",32),s.prototype.readFloat64=r("getFloat64",64),s.prototype.writeBoolean=o("setBoolean",1),s.prototype.writeInt8=o("setInt8",8),s.prototype.writeUint8=o("setUint8",8),s.prototype.writeInt16=o("setInt16",16),s.prototype.writeUint16=o("setUint16",16),s.prototype.writeInt32=o("setInt32",32),s.prototype.writeUint32=o("setUint32",32),s.prototype.writeFloat32=o("setFloat32",32),s.prototype.writeFloat64=o("setFloat64",64),s.prototype.readASCIIString=function(e){return function(e,t){return i(e,t,!1)}(this,e)},s.prototype.readUTF8String=function(e){return function(e,t){return i(e,t,!0)}(this,e)},s.prototype.writeASCIIString=function(e,t){!function(e,t,n){for(var r=n||t.length+1,o=0;o<r;o++)e.writeUint8(o<t.length?t.charCodeAt(o):0)}(this,e,t)},s.prototype.writeUTF8String=function(e,t){!function(e,t,n){for(var r=function(e){var t,n,r=[];for(t=0;t<e.length;t++)(n=e.charCodeAt(t))<=127?r.push(n):n<=2047?(r.push(n>>6|192),r.push(63&n|128)):n<=65535?(r.push(n>>12|224),r.push(n>>6&63|128),r.push(63&n|128)):(r.push(n>>18|240),r.push(n>>12&63|128),r.push(n>>6&63|128),r.push(63&n|128));return r}(t),o=n||r.length+1,i=0;i<o;i++)e.writeUint8(i<r.length?r[i]:0)}(this,e,t)},s.prototype.readBitStream=function(e){var t=new s(this._view);return t._startIndex=this._index,t._index=this._index,t.length=e,this._index+=e,t},s.prototype.writeBitStream=function(e,t){var n;for(t||(t=e.bitsLeft);t>0;)n=Math.min(t,32),this.writeBits(e.readBits(n),n),t-=n},s.prototype.readArrayBuffer=function(e){var t=this._view.getArrayBuffer(this._index,e);return this._index+=8*e,t},s.prototype.writeArrayBuffer=function(e,t){this.writeBitStream(new s(e),8*t)},e.exports&&(e.exports={BitView:n,BitStream:s})}()})),function(e){e[e.VENDOR_ID=2830]="VENDOR_ID",e.PAIRING_CHANNEL="jabra-webhid-pairing-channel"}($n||($n={})),exports.SignalType=void 0,(zn=exports.SignalType||(exports.SignalType={}))[zn.HOOK_SWITCH=32]="HOOK_SWITCH",zn[zn.GN_PSEUDO_HOOK_SWITCH=65531]="GN_PSEUDO_HOOK_SWITCH",zn[zn.FLASH=33]="FLASH",zn[zn.ALT_HOLD=35]="ALT_HOLD",zn[zn.REDIAL=36]="REDIAL",zn[zn.ONLINE=42]="ONLINE",zn[zn.SPEAKER_PHONE=43]="SPEAKER_PHONE",zn[zn.PHONE_MUTE=47]="PHONE_MUTE",zn[zn.SEND=49]="SEND",zn[zn.SPEED_DIAL=80]="SPEED_DIAL",zn[zn.VOICE_MAIL=112]="VOICE_MAIL",zn[zn.ANSWER_ON_OFF=116]="ANSWER_ON_OFF",zn[zn.LINE_BUSY=151]="LINE_BUSY",zn[zn.RINGER=158]="RINGER",zn[zn.PHONE_KEY_0=176]="PHONE_KEY_0",zn[zn.PHONE_KEY_1=177]="PHONE_KEY_1",zn[zn.PHONE_KEY_2=178]="PHONE_KEY_2",zn[zn.PHONE_KEY_3=179]="PHONE_KEY_3",zn[zn.PHONE_KEY_4=180]="PHONE_KEY_4",zn[zn.PHONE_KEY_5=181]="PHONE_KEY_5",zn[zn.PHONE_KEY_6=182]="PHONE_KEY_6",zn[zn.PHONE_KEY_7=183]="PHONE_KEY_7",zn[zn.PHONE_KEY_8=184]="PHONE_KEY_8",zn[zn.PHONE_KEY_9=185]="PHONE_KEY_9",zn[zn.PHONE_KEY_STAR=186]="PHONE_KEY_STAR",zn[zn.PHONE_KEY_POUND=187]="PHONE_KEY_POUND",zn[zn.ALT_VOLUME_UP=233]="ALT_VOLUME_UP",zn[zn.ALT_VOLUME_DOWN=234]="ALT_VOLUME_DOWN",zn[zn.REJECT_CALL=65533]="REJECT_CALL";class ar{constructor(e,t,n){this.type=e,this.value=t,this.valueType=n}toString(){return void 0===exports.SignalType[this.type]?`Unknown signal: type: ${this.type}, value: ${this.value}, valueType: ${this.valueType}`:`Signal: type: ${exports.SignalType[this.type]}, value: ${this.value}, valueType: ${this.valueType}`}}!function(e){e[e.BUTTON=9]="BUTTON",e[e.CONSUMER=12]="CONSUMER",e[e.LED=8]="LED",e[e.TELEPHONY=11]="TELEPHONY",e[e.GN_CONSUMER=65312]="GN_CONSUMER",e[e.GN_EXT_BUTTONS=65360]="GN_EXT_BUTTONS",e[e.GN_LED=65344]="GN_LED",e[e.GN_MISC=65376]="GN_MISC",e[e.GN_TELEPHONY=65328]="GN_TELEPHONY"}(Qn||(Qn={})),function(e){e[e.MUTE=9]="MUTE",e[e.OFF_HOOK=23]="OFF_HOOK",e[e.RING=24]="RING",e[e.MESSAGE_WAIT=25]="MESSAGE_WAIT",e[e.HOLD=32]="HOLD",e[e.MIC_MUTE=33]="MIC_MUTE",e[e.ONLINE=42]="ONLINE",e[e.HID_OFFLINE=43]="HID_OFFLINE"}(Jn||(Jn={})),function(e){e[e.HOOK_SWITCH=32]="HOOK_SWITCH",e[e.FLASH=33]="FLASH",e[e.HOLD=35]="HOLD",e[e.REDIAL=36]="REDIAL",e[e.ONLINE=42]="ONLINE",e[e.SPEAKER_PHONE=43]="SPEAKER_PHONE",e[e.MUTE=47]="MUTE",e[e.HID_SEND=49]="HID_SEND",e[e.SPEED_DIAL=80]="SPEED_DIAL",e[e.VOICE_MAIL=112]="VOICE_MAIL",e[e.ANSWER_ON_OFF=116]="ANSWER_ON_OFF",e[e.LINE_BUSY=151]="LINE_BUSY",e[e.RINGER=158]="RINGER",e[e.PHONE_KEY_0=176]="PHONE_KEY_0",e[e.PHONE_KEY_1=177]="PHONE_KEY_1",e[e.PHONE_KEY_2=178]="PHONE_KEY_2",e[e.PHONE_KEY_3=179]="PHONE_KEY_3",e[e.PHONE_KEY_4=180]="PHONE_KEY_4",e[e.PHONE_KEY_5=181]="PHONE_KEY_5",e[e.PHONE_KEY_6=182]="PHONE_KEY_6",e[e.PHONE_KEY_7=183]="PHONE_KEY_7",e[e.PHONE_KEY_8=184]="PHONE_KEY_8",e[e.PHONE_KEY_9=185]="PHONE_KEY_9",e[e.PHONE_KEY_STAR=186]="PHONE_KEY_STAR",e[e.PHONE_KEY_POUND=187]="PHONE_KEY_POUND",e[e.HID_ALT_VOLUME_UP=233]="HID_ALT_VOLUME_UP",e[e.HID_ALT_VOLUME_DOWN=234]="HID_ALT_VOLUME_DOWN",e[e.GN_PSEUDO_HOOK_SWITCH=65531]="GN_PSEUDO_HOOK_SWITCH",e[e.GN_OUT_OF_RANGE=65532]="GN_OUT_OF_RANGE",e[e.GN_REJECT_CALL=65533]="GN_REJECT_CALL",e[e.GN_TELEPHONY_CONT_SET=65535]="GN_TELEPHONY_CONT_SET"}(Xn||(Xn={}));class cr{constructor(e,t,n,r,o){this.hidChannel=e,this.onDisconnect=t,this.isSoftphoneInFocus=n,this.lockHeld=r,this.logger=o,this.cachedSignals=new Map}setup(){const e=this.filter().pipe(Ct());return e.subscribe(),e}filter(){const e=this.hidChannel.input.pipe(ut((e=>e.usagePage===Qn.GN_TELEPHONY&&!e.isArray())),We((e=>{const t=this.hidChannel.findDescriptor(e.usagePage,e.usage,exports.ReportType.INPUT);return(null==t?void 0:t.valueType)?Re(Object.assign(Object.assign({},e),{valueType:t.valueType})):(Fn("",new Dt(`Unable to find value-type in descriptor for UsagePage: ${e.usagePage} and Usage: ${e.usage}`,exports.ErrorType.FEATURE_NOT_SUPPORTED),this.logger),ce)})),ut((e=>{if(e.valueType===exports.ValueType.RELATIVE)return Boolean(e.value);return this.cachedSignals.get(e.usage)!==e.value})),Lt((e=>{this.cachedSignals.set(e.usage,e.value)})),Rt(this.onDisconnect),Ct()),t=[exports.SignalType.HOOK_SWITCH,exports.SignalType.REDIAL],n=e.pipe(En(this.isSoftphoneInFocus),ut((e=>t.includes(e.usage)&&!this.lockHeld.getValue())));return Ze(e.pipe(ut((e=>this.lockHeld.getValue()))),n).pipe(Fe((e=>new ar(e.usage,0!==e.value,e.valueType))),ft((e=>(Ht(e.message,this.logger),ce))))}}class lr{constructor(e,t,n,r,o,i){this.device=e,this.onDisconnect=n,Zn.set(this,void 0),er.set(this,new Z(!1)),tr.set(this,void 0),nr.set(this,!1),this.deviceSignals=new J,y(this,Zn,r,"f"),g(this,Zn,"f").lockHeld.subscribe(g(this,er,"f")),y(this,tr,t,"f"),this.onDisconnect.pipe(Tt(),Fe((()=>!0))).subscribe((e=>{y(this,nr,e,"f")}));const s=new cr(g(this,tr,"f"),this.onDisconnect,o,g(this,er,"f"),i);this.deviceSignals=s.setup()}checkCallLockHeld(e){if(!g(this,er,"f").getValue())throw new Dt(e,exports.ErrorType.SDK_USAGE_ERROR)}checkCallLockNotHeld(e){if(g(this,er,"f").getValue())throw new Dt(e,exports.ErrorType.SDK_USAGE_ERROR)}checkHasDisconnected(){if(g(this,nr,"f"))throw new Dt("CallControl cannot be performed as the connection has disconnected.",exports.ErrorType.SDK_USAGE_ERROR)}takeCallLock(){return this.checkHasDisconnected(),this.checkCallLockNotHeld("Trying to take the call lock, but it is already held!"),He(g(this,Zn,"f").tryTakeCallLock())}releaseCallLock(){this.checkHasDisconnected(),this.checkCallLockHeld("Trying to release the call lock, but it is not held!"),g(this,Zn,"f").releaseCallLock()}offHook(e){this.checkHasDisconnected(),this.checkCallLockHeld("Calls can only be started and stopped when the call lock is held.");const t=g(this,tr,"f").findDescriptor(Qn.GN_LED,Jn.OFF_HOOK,exports.ReportType.OUTPUT);if(!t)throw new Dt(`Device ${this.device.name} does not support any offHook functionality.`,exports.ErrorType.FEATURE_NOT_SUPPORTED);const n=e?1:0;g(this,tr,"f").output(t.usagePage,t.usage,n)}ring(e){this.checkHasDisconnected(),this.checkCallLockHeld("The ringer state can only be modified when the call lock is held.");const t=g(this,tr,"f").findDescriptor(Qn.GN_LED,Jn.RING,exports.ReportType.OUTPUT),n=g(this,tr,"f").findDescriptor(Qn.GN_TELEPHONY,Xn.RINGER,exports.ReportType.OUTPUT);if(!t&&!n)throw new Dt(`Device ${this.device.name} does not support any ring functionality.`,exports.ErrorType.FEATURE_NOT_SUPPORTED);if(n){const t=e?1:0;g(this,tr,"f").output(n.usagePage,n.usage,t)}if(t){const n=e?1:0;g(this,tr,"f").output(t.usagePage,t.usage,n)}}mute(e){this.checkHasDisconnected(),this.checkCallLockHeld("The mute state can only be modified when the call lock is held.");let t=g(this,tr,"f").findDescriptor(Qn.GN_LED,Jn.MIC_MUTE,exports.ReportType.OUTPUT);if(t||(t=g(this,tr,"f").findDescriptor(Qn.GN_LED,Jn.MUTE,exports.ReportType.OUTPUT)),!t)throw new Dt(`Device ${this.device.name} does not support any mute functionality.`,exports.ErrorType.FEATURE_NOT_SUPPORTED);const n=e?1:0;g(this,tr,"f").output(t.usagePage,t.usage,n)}hold(e){this.checkHasDisconnected(),this.checkCallLockHeld("The hold state can only be modified when the call lock is held.");const t=g(this,tr,"f").findDescriptor(Qn.GN_LED,Jn.HOLD,exports.ReportType.OUTPUT);if(!t)throw new Dt(`Device ${this.device.name} does not support hold functionality.`,exports.ErrorType.FEATURE_NOT_SUPPORTED);const n=e?1:0;g(this,tr,"f").output(t.usagePage,t.usage,n)}}Zn=new WeakMap,er=new WeakMap,tr=new WeakMap,nr=new WeakMap,function(e){e[e.STD_TELEPHONY=0]="STD_TELEPHONY",e[e.GN_TELEPHONY=1]="GN_TELEPHONY"}(rr||(rr={}));const ur={[Kt.SKYPE]:rr.GN_TELEPHONY,[Kt.CISCO]:rr.GN_TELEPHONY,[Kt.AVAYA]:rr.GN_TELEPHONY,[Kt.SIEMENS]:rr.GN_TELEPHONY,[Kt.IBM]:rr.GN_TELEPHONY,[Kt.AASTRA]:rr.GN_TELEPHONY,[Kt.JABRA]:rr.GN_TELEPHONY,[Kt.NEC]:rr.GN_TELEPHONY,[Kt.SHORETEL]:rr.GN_TELEPHONY,[Kt.MS_OC]:rr.STD_TELEPHONY,[Kt.ALCATEL]:rr.STD_TELEPHONY,[Kt.OTHER]:rr.STD_TELEPHONY,[Kt.NORTEL]:null,[Kt.GENERIC]:null};function hr(e,t){const n=e.read(rn).pipe(Fe((e=>ur[e]===t))),r=e.read(new en).pipe(Fe((e=>e.find((e=>ur[e]===t))))).pipe(Fe((t=>t?e.write(rn,t):Re(!1))),It());return n.pipe((o=Re(!0),i=r,e=>e.pipe(Fe((e=>e?o:i)),It())));var o,i}class pr{constructor(e,t,n){this.connectionCallLock=e,this.device=t,this.logger=n,this.lockHeld=new Z(!1),this.currentLocks=new Z(new Set),this.lockReleaseEvent=new J}tryTakeCallLock(){const{currentConnections:e}=this.device,t=new Set,n=qe((()=>Ie(e).pipe(vt((e=>this.takeSingleCallLock(e).pipe(ft((e=>(Fn("DeviceCallLock:",e,this.logger),Re(""))))))),Lt((e=>t.add(e)))))).pipe(function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?ut((function(t,n){return e(t,n,r)})):W,wt(1),n?Et(t):_t((function(){return new De})))}}(),Fe((n=>(t.delete(""),this.currentLocks.next(t),t.size!==e.length?(this.releaseCallLock(),!1):(this.lockHeld.next(!0),!0)))),Nt());return n.subscribe((e=>{e&&(this.acquireLockOnNextConnectionEmit(),this.releaseLockOnRemovedConnectionEmit())})),n}acquireLockOnNextConnectionEmit(){this.device.connectionAdded.pipe(Rt(this.lockReleaseEvent)).subscribe((e=>{this.takeSingleCallLock(e).pipe(Rt(this.lockReleaseEvent),Fe((e=>(this.currentLocks.getValue().add(e),this.currentLocks.next(this.currentLocks.getValue()),I))),Ot(Pn())).subscribe({error:e=>{Ht(`Failed to acquire the call lock on a new connection.\n              Another softphone running an old SDK has most likely acquired this lock.\n              Full error: ${e}`,this.logger,exports.LogLevel.WARNING,exports.StackLayer.JS_LIB)}})}))}releaseLockOnRemovedConnectionEmit(){this.device.connectionRemoved.pipe(Rt(this.lockReleaseEvent)).subscribe((e=>this.releaseSingleCallLock(e.id.transportId)))}takeSingleCallLock(e){return qe((()=>this.connectionCallLock.tryTakeCallLock(e.id.transportId))).pipe(Fe((t=>t.acquired?Re(t.transportId):Le((()=>new Dt(`Failed to acquire call lock on connection ${e.id.transportId}`,exports.ErrorType.SDK_USAGE_ERROR))))),It())}releaseCallLock(){this.lockReleaseEvent.next();[...this.currentLocks.getValue()].forEach((e=>{this.releaseSingleCallLock(e)})),this.currentLocks.getValue().clear(),this.currentLocks.next(this.currentLocks.getValue())}releaseSingleCallLock(e){this.connectionCallLock.releaseCallLock(e),this.currentLocks.getValue().delete(e),this.currentLocks.next(this.currentLocks.getValue()),0!==this.currentLocks.getValue().size&&0!==this.device.currentConnections.length||(this.lockReleaseEvent.next(),this.lockHeld.next(!1))}}class dr{constructor(e){this.transport=e}tryTakeCallLock(e){const t={action:"request-call-lock",id:e};return this.transport.writeAction(t),this.transport.consoleAppEvent.pipe(ut((t=>"response-call-lock"===t.event&&t.id===e)),Fe((e=>({transportId:e.id,acquired:e.acquired}))),Tt())}releaseCallLock(e){const t={action:"release-call-lock",id:e};this.transport.writeAction(t)}}const fr=[{usagePage:Qn.GN_LED,usage:Jn.OFF_HOOK,reportType:exports.ReportType.OUTPUT},{usagePage:Qn.GN_LED,usage:Jn.RING,reportType:exports.ReportType.OUTPUT},{usagePage:Qn.GN_TELEPHONY,usage:Xn.RINGER,reportType:exports.ReportType.OUTPUT},{usagePage:Qn.GN_LED,usage:Jn.MIC_MUTE,reportType:exports.ReportType.OUTPUT},{usagePage:Qn.GN_LED,usage:Jn.MUTE,reportType:exports.ReportType.OUTPUT},{usagePage:Qn.GN_LED,usage:Jn.HOLD,reportType:exports.ReportType.OUTPUT}],vr=[exports.ConnectionType.USB,exports.ConnectionType.INDIRECT,exports.ConnectionType.BLUETOOTH];function Er(e,t){const{hidChannel:n}=e;return!!function(e){return fr.some((({usagePage:t,usage:n,reportType:r})=>e.findDescriptor(t,n,r)))}(n)&&(!On.supportsGnpOverHid(n)||t!==exports.DeviceType.DONGLE&&t!==exports.DeviceType.OTHER)}function gr(e){const{currentConnections:t,type:n}=e;var r;return(r=t,[...r].sort(((e,t)=>vr.indexOf(e.type)-vr.indexOf(t.type)))).find((e=>Er(e,n)))}function yr(e,t,n,r,o){const i=gr(e),{hidChannel:s,onDisconnect:a}=i,c=new pr(new dr(r),e,o);if(t)return Re(new lr(e,s,a,c,n.softphoneInFocus,o));if(r.context===exports.TransportContext.WEB_HID)return Re(new lr(e,s,a,c,n.softphoneInFocus,o));return function(e,t){return e.findDescriptor(Qn.GN_TELEPHONY,Xn.GN_TELEPHONY_CONT_SET,exports.ReportType.FEATURE)?qe((()=>(e.setFeatureReport(Qn.GN_TELEPHONY,Xn.GN_TELEPHONY_CONT_SET,1),Re(!0)))):t?hr(t,rr.GN_TELEPHONY):Re(!1)}(s,i).pipe(Fe((t=>new lr(e,s,a,c,n.softphoneInFocus,o))))}class mr{constructor(e,t){this.devComm=e,this.softphoneInFocus=new Y,this.softphoneInFocus=t.pipe(Tt(),We((e=>this.devComm.consoleAppEvent.pipe(ut((e=>"softphone-in-focus"===e.event)),Fe((e=>e.infocus)),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=pe(e);return q((function(t,r){(n?Ve(e,t,n):Ve(e,t)).subscribe(r)}))}(!e),Nt(1))))),this.softphoneInFocus.subscribe((()=>{}))}setSharedSoftphoneInfo(e){if(!(null==e?void 0:e.partnerKey)||!(null==e?void 0:e.appId))return void Ht("Unable to register with Jabra Direct: partnerKey or appId missing in config",null==e?void 0:e.logger,exports.LogLevel.WARNING);const t=e.partnerKey+e.appId,n=new un(5,"ns:OID",t);let{appName:r}=e;if((!e.appName||e.appName.length<3)&&(Ht("App name missing in config. Fall back to use appId as app name.",null==e?void 0:e.logger,exports.LogLevel.WARNING),r=e.appId),r.length>100)return void Ht("Unable to register with Jabra Direct: appName must be below 100 characters.",null==e?void 0:e.logger,exports.LogLevel.WARNING);const o={action:"set-softphone-info",name:r,id:n.toString()};this.devComm.writeAction(o)}}var _r,br,Tr,wr,Or,Cr,Sr,Nr,xr,Ar;class Ir{constructor(e){var t;_r.set(this,void 0),br.set(this,void 0),Tr.set(this,void 0),wr.set(this,void 0),y(this,wr,e._readyEvents.pipe(Tt((e=>"ready"===e.event)),Fe((e=>e.jabraDirectInstalled))),"f"),y(this,br,new mr(e._transport,g(this,wr,"f")),"f"),g(this,br,"f").setSharedSoftphoneInfo(e._config),y(this,_r,e._transport,"f"),y(this,Tr,null===(t=e._config)||void 0===t?void 0:t.logger,"f")}createCallControl(e){if(!this.supportsCallControl(e))return Promise.reject(new Dt(`Device ${e.name} does not support call control.`,exports.ErrorType.FEATURE_NOT_SUPPORTED));return Pe(g(this,wr,"f").pipe(We((t=>yr(e,t,g(this,br,"f"),g(this,_r,"f"),g(this,Tr,"f"))))))}supportsCallControl(e){return void 0!==gr(e)}}_r=new WeakMap,br=new WeakMap,Tr=new WeakMap,wr=new WeakMap,exports.AcceptIncomingCallBehavior=void 0,(Or=exports.AcceptIncomingCallBehavior||(exports.AcceptIncomingCallBehavior={})).HOLD_CURRENT="hold-current",Or.END_CURRENT="end-current",exports.MuteState=void 0,(Cr=exports.MuteState||(exports.MuteState={})).MUTED="muted",Cr.UNMUTED="unmuted",Cr.NO_ONGOING_CALLS="no-ongoing-calls",exports.HoldState=void 0,(Sr=exports.HoldState||(exports.HoldState={})).ON_HOLD="on-hold",Sr.NOT_ON_HOLD="not-on-hold",Sr.NO_ONGOING_CALLS="no-ongoing-calls",function(e){e.NO_INCOMING="no-incoming",e.AWAITING_RESPONSE="awaiting-response",e.RESOLVING_RESPONSE="resolving-response",e.ACCEPTED="accepted",e.REJECTED="rejected"}(Nr||(Nr={}));class Rr{constructor(e){this.state=e.value,e.subscribe((e=>{this.state=e}))}}class Lr extends Rr{constructor(e,t,n,r,o){super(e),this.commands=t,this.deviceSignals=n,this.enableFlash=r,this.logger=o}setupSignalListeners(){const e=this.extendedSignals.pipe(Ct()),t=e.pipe(ut((e=>e.allowed))),n=e.pipe(ut((e=>!e.allowed)));t.subscribe((e=>{Ht(`Accepted signal: ${exports.SignalType[e.type]} [${e.value}]`,null==this?void 0:this.logger,exports.LogLevel.INFO)})),n.subscribe((e=>{Ht(`Ignored signal: ${exports.SignalType[e.type]} [${e.value}]`,null==this?void 0:this.logger,exports.LogLevel.INFO)})),t.pipe(ut((e=>e.type===exports.SignalType.HOOK_SWITCH))).subscribe((e=>{e.value&&this.state.incomingCall===Nr.AWAITING_RESPONSE?this.commands.incomingCallHandler.queueAcceptIncomingCall(exports.AcceptIncomingCallBehavior.END_CURRENT,!0):(!1===e.value&&this.state.ongoingCalls>0&&this.commands.hookHandler.queueEndCall(!0),!0===e.value&&0===this.state.ongoingCalls&&this.commands.hookHandler.queueStartCall())})),t.pipe(ut((e=>e.type===exports.SignalType.PHONE_MUTE))).subscribe((()=>{this.commands.muteHandler.queueToggleMute(!0)})),t.pipe(ut((e=>e.type===exports.SignalType.FLASH))).subscribe((()=>l(this,void 0,void 0,(function*(){this.state.incomingCall!==Nr.AWAITING_RESPONSE?this.state.ongoingCalls>1?this.commands.swapHandler.queueSwapCalls():this.commands.holdHandler.queueToggleHold():yield this.commands.incomingCallHandler.queueAcceptIncomingCall(exports.AcceptIncomingCallBehavior.HOLD_CURRENT,!0)})))),t.pipe(ut((e=>e.type===exports.SignalType.REJECT_CALL))).subscribe((()=>{this.state.incomingCall===Nr.AWAITING_RESPONSE&&this.commands.incomingCallHandler.queueRejectIncomingCall()}))}get extendedSignals(){return this.deviceSignals.pipe(We((e=>{let t=!this.state.ignoreSignals.some((([t,n])=>e.type===t&&n===e.value));return e.type!==exports.SignalType.FLASH||this.enableFlash||(t=!1),Re(Object.assign(Object.assign({},e),{allowed:t}))})),Rt(this.commands.teardownHandler.onTeardown))}}class Dr{constructor(e,t,n,r,o,i,s=!0){this.logger=i,xr.set(this,void 0),this.device=e,this.onDisconnect=t,this.ringState=o.ringState,this.muteState=o.muteState,y(this,xr,r,"f"),this.onDisconnect.pipe(Tt(),Rt(g(this,xr,"f").teardownHandler.onTeardown)).subscribe((e=>this.teardown(!1)));new Lr(o.internalState,r,n,s,i).setupSignalListeners()}endCall(){return g(this,xr,"f").hookHandler.queueEndCall(!1)}signalIncomingCall(e=25e3){return g(this,xr,"f").incomingCallHandler.queueSignalIncomingCall(e)}rejectIncomingCall(){return g(this,xr,"f").incomingCallHandler.queueRejectIncomingCall()}mute(){return g(this,xr,"f").muteHandler.queueSetMute(exports.MuteState.MUTED)}unmute(){return g(this,xr,"f").muteHandler.queueSetMute(exports.MuteState.UNMUTED)}teardown(e=!0){g(this,xr,"f").teardownHandler.teardown(e)}_setInitialState(e,t=!1,n=!1){return 0===e&&(t||n)&&Ht("\n        Unable to set initial state: muted or onHold cannot be true unless a call is started.\n        Set callActive to true for SingleCallControl, or ongoingCalls to 1 or more for MultiCallControl.\n      ",null==this?void 0:this.logger,exports.LogLevel.WARNING),g(this,xr,"f").deviceState.setInitialState(e,t,n)}}xr=new WeakMap;class Hr extends Dr{constructor(e,t,n,r,o,i){super(e,t,n,r,o,i,!0),Ar.set(this,void 0),this.ongoingCalls=o.ongoingCalls,this.holdState=o.holdState,this.swapRequest=o.swapEvents,y(this,Ar,r,"f")}startCall(){return g(this,Ar,"f").hookHandler.queueStartCall()}acceptIncomingCall(e=exports.AcceptIncomingCallBehavior.END_CURRENT){return g(this,Ar,"f").incomingCallHandler.queueAcceptIncomingCall(e,!1)}hold(){return g(this,Ar,"f").holdHandler.queueSetHold(exports.HoldState.ON_HOLD)}resume(){return g(this,Ar,"f").holdHandler.queueSetHold(exports.HoldState.NOT_ON_HOLD)}}Ar=new WeakMap;class Pr extends Rr{constructor(e,t,n){super(t),this.callControl=e,this.logger=n,this.hasLock=!1}takeCallLock(){return l(this,void 0,void 0,(function*(){if(!this.hasLock){try{this.hasLock=yield this.callControl.takeCallLock()}catch(e){this.hasLock=!0,Ht(e.message,null==this?void 0:this.logger,exports.LogLevel.WARNING)}if(!this.hasLock)throw new Dt("Device used by another softphone. Only one application can use the device at a time.",exports.ErrorType.SDK_USAGE_ERROR)}}))}releaseCallLock(){0===this.state.ongoingCalls&&(this.callControl.releaseCallLock(),this.hasLock=!1)}forceReleaseCallLock(){this.hasLock&&this.callControl.releaseCallLock()}}class Ur{constructor(e){this.teardownHandler=e,this.queue=new J,this.queue.pipe(vt((e=>l(this,void 0,void 0,(function*(){try{const t=yield e.command();e.callback(t)}catch(t){if(!(t instanceof Dt))throw t;e.errCallback(t)}})))),Rt(this.teardownHandler.onTeardown)).subscribe()}pushToQueue(e){return new Promise(((t,n)=>{this.teardownHandler.checkActive();const r={command:e,callback:t,errCallback:n};this.queue.next(r)}))}}class kr extends Rr{constructor(e,t,n,r){super(r),this.hookHandler=e,this.holdHandler=t,this.muteHandler=n}setInitialState(e,t,n){return l(this,void 0,void 0,(function*(){if(0===e)return yield this.hookHandler.queueStartCall(),void(yield this.hookHandler.queueEndCall(!1));for(let t=0;t<e;t+=1)yield this.hookHandler.queueStartCall();const r=t?exports.MuteState.MUTED:exports.MuteState.UNMUTED;yield this.muteHandler.queueSetMute(r);const o=n?exports.HoldState.ON_HOLD:exports.HoldState.NOT_ON_HOLD;yield this.holdHandler.queueSetHold(o)}))}}class Gr extends Rr{constructor(e,t,n,r){super(t),this.callControl=e,this.stateHandler=t,this.commandQueue=n,this.awaitSignals=r}queueSetHold(e){return this.commandQueue.pushToQueue((()=>this.setHold(e)))}queueToggleHold(){return this.commandQueue.pushToQueue((()=>l(this,void 0,void 0,(function*(){const e=this.state.holdState===exports.HoldState.ON_HOLD?exports.HoldState.NOT_ON_HOLD:exports.HoldState.ON_HOLD;this.setHold(e)}))))}setHold(e){return l(this,void 0,void 0,(function*(){if(0===this.state.ongoingCalls){const t=e===exports.HoldState.ON_HOLD?"hold":"resume";throw new Dt(`Cannot ${t} call as there are no calls in progress.`,exports.ErrorType.SDK_USAGE_ERROR)}if(this.state.ongoingCalls>1&&e===exports.HoldState.NOT_ON_HOLD)return void(yield this.resumeWhileMultiple());this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:e}));const t=e===exports.HoldState.NOT_ON_HOLD,n=e===exports.HoldState.ON_HOLD,r=[[exports.SignalType.HOOK_SWITCH,t],[exports.SignalType.FLASH,!0]],o=this.awaitSignals.listen(r);n?(this.callControl.hold(n),this.callControl.offHook(t)):(this.callControl.offHook(t),this.callControl.hold(n)),yield He(o)}))}resumeWhileMultiple(){return l(this,void 0,void 0,(function*(){const e=this.awaitSignals.listen([[exports.SignalType.HOOK_SWITCH,!0]]);this.callControl.offHook(!0),this.callControl.hold(!1),this.callControl.hold(!0),yield He(e),this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:exports.HoldState.NOT_ON_HOLD}))}))}}class Mr extends Rr{constructor(e,t,n,r,o){super(n),this.callControl=e,this.callLock=t,this.stateHandler=n,this.commandQueue=r,this.awaitSignals=o}queueStartCall(){return this.commandQueue.pushToQueue((()=>this.startCall()))}queueEndCall(e){return this.commandQueue.pushToQueue((()=>this.endCall(e)))}startCall(e=!1){return l(this,void 0,void 0,(function*(){if(this.state.incomingCall===Nr.AWAITING_RESPONSE)throw new Dt("Cannot start a new call while another call is incoming. If you wish to answer/accept the incoming call, please use acceptIncomingCall/rejectIncomingCall instead.",exports.ErrorType.SDK_USAGE_ERROR);this.state.holdState===exports.HoldState.ON_HOLD?this.startNewCallWhileOnHold():0===this.state.ongoingCalls?yield this.startFirstCall(e):this.startSubsequentCalls(),this.stateHandler.next(Object.assign(Object.assign({},this.state),{ongoingCalls:this.state.ongoingCalls+1}))}))}endCall(e){return l(this,void 0,void 0,(function*(){if(this.state.incomingCall===Nr.AWAITING_RESPONSE)throw new Dt("Cannot end a call while another call is incoming. If you wish to answer/accept the incoming call, please use acceptIncomingCall/rejectIncomingCall instead.",exports.ErrorType.SDK_USAGE_ERROR);if(0===this.state.ongoingCalls)throw new Dt("Cannot end call as there are no calls in progress.",exports.ErrorType.SDK_USAGE_ERROR);1===this.state.ongoingCalls?yield this.endLastCall():this.state.holdState===exports.HoldState.ON_HOLD?this.endCallWhileOnHold():yield this.endCurrentCall(e)}))}startFirstCall(e){return l(this,void 0,void 0,(function*(){yield this.callLock.takeCallLock();const t=e?[]:[[exports.SignalType.HOOK_SWITCH,!0]],n=this.awaitSignals.listen(t);this.callControl.offHook(!0),yield He(n),this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:exports.HoldState.NOT_ON_HOLD,muteState:exports.MuteState.UNMUTED}))}))}startSubsequentCalls(){this.callControl.hold(!0)}startNewCallWhileOnHold(){this.callControl.offHook(!0),this.callControl.hold(!0),this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:exports.HoldState.NOT_ON_HOLD}))}endLastCall(){return l(this,void 0,void 0,(function*(){this.stateHandler.next(Object.assign(Object.assign({},this.state),{holdState:exports.HoldState.NO_ONGOING_CALLS,muteState:exports.MuteState.NO_ONGOING_CALLS,ongoingCalls:0})),this.callControl.mute(!1),this.callControl.offHook(!1),this.callControl.hold(!1),this.callLock.releaseCallLock()}))}endCurrentCall(e){return l(this,void 0,void 0,(function*(){this.stateHandler.next(Object.assign(Object.assign({},this.state),{ongoingCalls:this.state.ongoingCalls-1})),yield this.sendHoldCallSignalAndWaitForAck(e),yield this.resumeNextCall(e)}))}sendHoldCallSignalAndWaitForAck(e){const t=e?[[exports.SignalType.HOOK_SWITCH,!1],[exports.SignalType.FLASH,!0]]:[[exports.SignalType.HOOK_SWITCH,!1]],n=He(this.awaitSignals.listen(t));return this.callControl.hold(!0),this.callControl.offHook(!1),n}resumeNextCall(e){const t=e?[[exports.SignalType.HOOK_SWITCH,!0],[exports.SignalType.FLASH,!0]]:[[exports.SignalType.HOOK_SWITCH,!0]],n=He(this.awaitSignals.listen(t));return this.callControl.offHook(!0),this.callControl.hold(1!==this.state.ongoingCalls),n}endCallWhileOnHold(){this.stateHandler.next(Object.assign(Object.assign({},this.state),{ongoingCalls:this.state.ongoingCalls-1}))}}class Fr extends Rr{constructor(e,t,n,r,o){super(n),this.callControl=e,this.callLock=t,this.stateHandler=n,this.hookHandler=r,this.commandQueue=o}queueAcceptIncomingCall(e,t){return this.commandQueue.pushToQueue((()=>this.acceptIncomingCall(e,t)))}queueRejectIncomingCall(){return this.commandQueue.pushToQueue((()=>this.rejectIncomingCall()))}queueSignalIncomingCall(e=25e3){return new Promise(((t,n)=>{this.commandQueue.pushToQueue((()=>l(this,void 0,void 0,(function*(){(yield this.signalIncomingCall(e)).subscribe({next:e=>{t(e),this.updateIncomingCallState(Nr.NO_INCOMING)},error:e=>{t(!1)},complete:()=>{t(!1)}})})))).catch((e=>n(e)))}))}signalIncomingCall(e){return l(this,void 0,void 0,(function*(){return yield this.callLock.takeCallLock(),this.updateIncomingCallState(Nr.AWAITING_RESPONSE),this.callControl.ring(!0),this.stateHandler.pipe((t=({incomingCall:e})=>e!==Nr.NO_INCOMING,void 0===n&&(n=!1),q((function(e,r){var o=0;e.subscribe($(r,(function(e){var i=t(e,o++);(i||n)&&r.next(e),!i&&r.complete()})))}))),ut((({incomingCall:e})=>e===Nr.ACCEPTED||e===Nr.REJECTED)),Tt(),Ge(e),ft((e=>(this.rejectIncomingCall(),Re(this.state)))),Fe((({incomingCall:e})=>e===Nr.ACCEPTED)));var t,n}))}acceptIncomingCall(e,t){return l(this,void 0,void 0,(function*(){if(this.state.incomingCall!==Nr.AWAITING_RESPONSE)throw new Dt("Cannot accept as there are no incoming calls.",exports.ErrorType.SDK_USAGE_ERROR);this.updateIncomingCallState(Nr.RESOLVING_RESPONSE),this.callControl.ring(!1),this.state.holdState===exports.HoldState.ON_HOLD||0===this.state.ongoingCalls?yield this.hookHandler.startCall(t):e===exports.AcceptIncomingCallBehavior.END_CURRENT?(yield this.hookHandler.endCall(t),yield this.hookHandler.startCall(t)):e===exports.AcceptIncomingCallBehavior.HOLD_CURRENT&&(yield this.hookHandler.startCall(t)),this.stateHandler.next(Object.assign(Object.assign({},this.state),{incomingCall:Nr.ACCEPTED,holdState:exports.HoldState.NOT_ON_HOLD}))}))}rejectIncomingCall(){return l(this,void 0,void 0,(function*(){if(this.state.incomingCall!==Nr.AWAITING_RESPONSE)throw new Dt("Cannot reject as there are no incoming calls.",exports.ErrorType.SDK_USAGE_ERROR);this.callControl.ring(!1),this.updateIncomingCallState(Nr.REJECTED),this.callLock.releaseCallLock()}))}updateIncomingCallState(e){this.stateHandler.next(Object.assign(Object.assign({},this.state),{incomingCall:e}))}}class Br extends Rr{constructor(e,t,n){super(t),this.callControl=e,this.stateHandler=t,this.commandQueue=n}queueSetMute(e){return this.commandQueue.pushToQueue((()=>this.setMute(e,!1)))}queueToggleMute(e){return this.commandQueue.pushToQueue((()=>l(this,void 0,void 0,(function*(){const t=this.state.muteState===exports.MuteState.MUTED?exports.MuteState.UNMUTED:exports.MuteState.MUTED;this.setMute(t,e)}))))}setMute(e,t){return l(this,void 0,void 0,(function*(){if(!t&&0===this.state.ongoingCalls)throw new Dt("You cannot change mute state outside of a call.",exports.ErrorType.SDK_USAGE_ERROR);if(!t&&this.state.holdState===exports.HoldState.ON_HOLD)throw new Dt("You cannot change mute state while on hold.",exports.ErrorType.SDK_USAGE_ERROR);this.callControl.mute(e===exports.MuteState.MUTED),this.stateHandler.next(Object.assign(Object.assign({},this.state),{muteState:e}))}))}}class Kr extends Rr{constructor(e,t){super(e),this.stateHandler=e,this.commandQueue=t}queueSwapCalls(){return this.commandQueue.pushToQueue((()=>this.swapCalls()))}swapCalls(){return l(this,void 0,void 0,(function*(){if(this.state.ongoingCalls<2)throw new Dt("No calls to swap between. There should be at least one current call and one call on hold.",exports.ErrorType.SDK_USAGE_ERROR);this.stateHandler.next(Object.assign(Object.assign({},this.state),{swapToggle:this.state.swapToggle?0:1}))}))}}class Wr{constructor(e,t,n){this.stateHandler=e,this.callLock=t,this.logger=n,this.teardownState=new Z(!1),this.onTeardown=this.teardownState.pipe(xt(1),Fe(I))}teardown(e=!0){if(this.teardownState.value)throw new Dt("Easy Call Control instance already torn down.",exports.ErrorType.SDK_USAGE_ERROR);this.stateHandler.unsubscribeState(),this.teardownState.next(!0),e&&this.callLock.forceReleaseCallLock(),Ht("Teardown complete. Create new Easy Call Control instance to continue usage.",null==this?void 0:this.logger,exports.LogLevel.INFO)}checkActive(){if(this.teardownState.value)throw new Dt("\n        Inactive instance. Either device disconnected or teardown was called.\n        Create new EasyCallControl instance to continue usage.",exports.ErrorType.SDK_USAGE_ERROR)}}class jr{constructor(e,t,n){this.deviceSignals=e,this.stateHandler=t,this.logger=n}listen(e){if(0===e.length)return Re(void 0);this.stateHandler.next(Object.assign(Object.assign({},this.stateHandler.value),{ignoreSignals:e}));let t=0;return this.deviceSignals.pipe(At((n=>{const[r,o]=e[t];return n.type===r&&n.value===o?(Ht(`Resolve awaited signal: ${exports.SignalType[r]} [${o}]`,null==this?void 0:this.logger,exports.LogLevel.INFO),t+=1,Re(n)):ce})),gt(e.length),Ge(1e3),ft((()=>{const t=e.map((([e,t])=>`${exports.SignalType[e]}: ${t}`));return Ht(`Missing signals for ${JSON.stringify(t)}. State recovered.`,null==this?void 0:this.logger,exports.LogLevel.INFO),Re(void 0)})),(n=()=>{this.stateHandler.next(Object.assign(Object.assign({},this.stateHandler.value),{ignoreSignals:[]}))},q((function(e,t){try{e.subscribe(t)}finally{t.add(n)}}))));var n}}class Yr{constructor(e,t,n,r){const o=new Pr(e,n.internalState,r);this.teardownHandler=new Wr(n,o,r);const i=new Ur(this.teardownHandler),s=new jr(t,n.internalState,r);this.hookHandler=new Mr(e,o,n.internalState,i,s),this.muteHandler=new Br(e,n.internalState,i),this.holdHandler=new Gr(e,n.internalState,i,s),this.incomingCallHandler=new Fr(e,o,n.internalState,this.hookHandler,i),this.swapHandler=new Kr(n.internalState,i),this.deviceState=new kr(this.hookHandler,this.holdHandler,this.muteHandler,n.internalState)}}const Vr={ongoingCalls:0,muteState:exports.MuteState.NO_ONGOING_CALLS,holdState:exports.HoldState.NO_ONGOING_CALLS,incomingCall:Nr.NO_INCOMING,ignoreSignals:[],swapToggle:0};class qr{constructor(){this.internalState=new Z(Vr),this.onUnsubscribe=new J;const e=this.internalState.pipe(Rt(this.onUnsubscribe));this.ongoingCalls=e.pipe(Fe((e=>e.ongoingCalls)),yt()),this.callActive=e.pipe(Fe((e=>0!==e.ongoingCalls)),yt()),this.ringState=e.pipe(Fe((e=>e.incomingCall===Nr.AWAITING_RESPONSE||e.incomingCall===Nr.RESOLVING_RESPONSE)),yt()),this.muteState=e.pipe(Fe((e=>e.muteState)),yt()),this.holdState=e.pipe(Fe((e=>e.holdState)),yt()),this.swapEvents=e.pipe(Fe((e=>e.swapToggle)),yt(),Fe((()=>{})),xt(1))}unsubscribeState(){this.onUnsubscribe.next(void 0),this.onUnsubscribe.complete(),this.internalState.complete()}}var $r,zr,Qr,Jr;class Xr extends Dr{constructor(e,t,n,r,o,i){super(e,t,n,r,o,i,!1),$r.set(this,void 0),zr.set(this,void 0),this.callActive=o.callActive,y(this,$r,o.internalState,"f"),y(this,zr,r,"f")}startCall(){return l(this,void 0,void 0,(function*(){if(1===g(this,$r,"f").value.ongoingCalls)throw new Dt("Please end the call before starting a new one.",exports.ErrorType.SDK_USAGE_ERROR);yield g(this,zr,"f").hookHandler.queueStartCall()}))}acceptIncomingCall(){return g(this,zr,"f").incomingCallHandler.queueAcceptIncomingCall(exports.AcceptIncomingCallBehavior.END_CURRENT,!1)}}$r=new WeakMap,zr=new WeakMap;Qr=new WeakMap,Jr=new WeakMap;class Zr{constructor(){this.buffer=Buffer.from([]),this.head=4}get hasCompleteMessage(){if(this.buffer.length<this.head)return!1;const e=this.buffer.readUInt32LE();return this.buffer.length-this.head>=e}getAndRemoveMessage(){if(!this.hasCompleteMessage)throw new Dt("No complete message has been received",exports.ErrorType.UNEXPECTED_ERROR);const e=this.buffer.readUInt32LE(),t=this.buffer.slice(this.head,this.head+e).toString();try{return this.buffer=this.buffer.slice(e+this.head),JSON.parse(t)}catch(e){throw new Dt("JSON from console app malformed",exports.ErrorType.UNEXPECTED_ERROR)}}receiveChunk(e){this.buffer=Buffer.concat([this.buffer,e])}}class eo{constructor(e,t,n){this.failures=t,this.logger=n,this.serializer=new Zr,this.failures.subscribe((e=>{Ht(`Device Connector error: ${e}`,this.logger,exports.LogLevel.ERROR)})),this.events=e.pipe(Lt((e=>{this.serializer.receiveChunk(e)})),ut((()=>this.serializer.hasCompleteMessage)),Fe((()=>this.serializer.getAndRemoveMessage())),Ct())}initSuccessful(){return ht(this.events.pipe(Fe((()=>!0))),this.failures.pipe(Fe((()=>!1))))}}var to=Object.freeze({__proto__:null,TransportNode:class{constructor(e,t){this.logger=e,this.recorder=t,this.events=new J,this.consoleAppEvent=this.events,this.context=exports.TransportContext.NODE}connect(){return l(this,void 0,void 0,(function*(){if(this.cliApp)throw new Dt("Already connected",exports.ErrorType.UNEXPECTED_ERROR);let n="",i="";const a={stdio:["pipe","pipe","pipe"]};try{i=__dirname}catch(e){i=r.dirname(o.fileURLToPath("undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("index.js",document.baseURI).href))}switch(s.default.platform()){case"win32":n=r.join("win32","jabra-console.exe");break;case"linux":n=r.join("linux","jabra-console"),a.stdio[2]="ignore";break;case"darwin":n=r.join("darwin","jabra-console");break;default:throw new Dt(`OS not supported: ${s.default.platform()}`,exports.ErrorType.INIT_ERROR)}let c=r.join(i,"../jabra-console"),l=r.join(c,n);if(l.includes("app.asar")&&!l.includes("app.asar.unpacked")&&(l=l.replace("app.asar","app.asar.unpacked")),t.existsSync(l)||(c=r.join(i,"/jabra-console"),l=r.join(c,n)),!t.existsSync(l))throw new Dt(function(e){return`\n    CRITICAL ERROR!\n\n    Cannot find the Device Connector - unable to initialize jabra-js.\n\n    The Device Connector allows the node application to bridge a connection to\n    Jabra USB devices. It consists of an embedded executable spawned by node in\n    a separate process. Node expects to find the application at a specific relative\n    path within your node_modules folder.\n\n    If you see this error message, it is most likely caused by one of three things:\n\n      1. You try to run a node-build in the browser. To solve this, try to import jabra-js\n      from one of the browser-builds instead: browser-esm or browser-umd. Read more under\n      "Module Import Strategies" in the documentation on the Developer Zone.\n      2. You try to run the library from an Electron renderer process. To solve this, try to\n      run the library from the main process or import jabra-js from one of the browser-builds\n      as described in step 1.\n      3. Your build tool has partially moved or copied library files to an unknown location.\n\n    To solve step 3:\n    We have seen this issue occur with some build configurations, namely Webpack, where the JavaScript\n    code gets included in the main bundle, but the Device Connector (i.e. jabra-console) is left behind.\n    To solve this, you need to setup a manual build step for copying the missing files. The Jabra library\n    expects the jabra-console folder to be located at "${e}",\n    hence, your build task should copy the folder from "node_modules/@gnaudio/jabra-js/jabra-console" to here.\n\n    For Webpack, this can be done with the copy-webpack-plugin like this:\n\n    $ npm install copy-webpack-plugin --save-dev\n\n    ---\n\n    import CopyPlugin from "copy-webpack-plugin"\n\n    const config = {\n      ...otherConfig,\n      plugins: [\n        new CopyPlugin({\n          patterns: [\n            {\n              from: "node_modules/@gnaudio/jabra-js/jabra-console",\n              to: "${e}"\n            },\n          ],\n        }),\n      ],\n    }\n\n    (rewrite the "to" value to a relative path)\n  `}(c),exports.ErrorType.INIT_ERROR);this.cliApp=e.spawn(l,a);const u=Je(this.cliApp.stdout,"data"),h=Ze(Je(this.cliApp,"error"),Je(this.cliApp,"exit"),Je(this.cliApp,"close")),p=new eo(u,h,this.logger);p.events.subscribe((e=>{var t;this.events.next(e),null===(t=this.recorder)||void 0===t||t.recordInput(e)}));if(!(yield Pe(p.initSuccessful())))throw new Dt("Failed to initialize the Device Connector.",exports.ErrorType.UNEXPECTED_ERROR)}))}writeAction(e){var t;if(!this.cliApp){const e="Cmd line app is uninitialized";throw Ht(e,this.logger,exports.LogLevel.ERROR),new Dt(e,exports.ErrorType.INIT_ERROR)}const n=JSON.stringify(e),r=Buffer.alloc(4),o=Buffer.from(n,"utf-8");r.writeUInt32LE(o.length),this.cliApp.stdin.write(r),this.cliApp.stdin.write(o),null===(t=this.recorder)||void 0===t||t.recordOutput(e)}}});exports.CallControlFactory=Ir,exports.DeviceId=pn,exports.EasyCallControlFactory=class{constructor(e){var t;Qr.set(this,void 0),Jr.set(this,void 0),y(this,Qr,new Ir(e),"f"),y(this,Jr,null===(t=e._config)||void 0===t?void 0:t.logger,"f")}createSingleCallControl(e,t){return l(this,void 0,void 0,(function*(){const n=yield this.getSharedDependencies(e),r=new Xr(n.coreDevice,n.onDisconnect,n.deviceSignals,n.commands,n.stateHandler,g(this,Jr,"f"));if(t){const e=t.callActive?1:0;yield r._setInitialState(e,t.muted)}return r}))}createMultiCallControl(e,t){return l(this,void 0,void 0,(function*(){const n=yield this.getSharedDependencies(e),r=new Hr(n.coreDevice,n.onDisconnect,n.deviceSignals,n.commands,n.stateHandler,g(this,Jr,"f"));return t&&(yield r._setInitialState(t.ongoingCalls,t.muted,t.onHold)),r}))}supportsEasyCallControl(e){return g(this,Qr,"f").supportsCallControl(e)}getSharedDependencies(e){return l(this,void 0,void 0,(function*(){const t=yield g(this,Qr,"f").createCallControl(e),n=new qr,r=t.deviceSignals.pipe(Ct());return{commands:new Yr(t,r,n,g(this,Jr,"f")),stateHandler:n,deviceSignals:r,coreDevice:t.device,onDisconnect:t.onDisconnect}}))}},exports.JabraError=Dt,exports.init=function(e){var t,n,r;return l(this,void 0,void 0,(function*(){const o=null==e?void 0:e.logger;Ht("Jabra SDK JS starting up...",o,exports.LogLevel.INFO);const i=new Bt(e);i.validateOrganizationKey(),i.validateAppId(),i.validateAppName();const s=null!==(n=null===(t=null==e?void 0:e.internal)||void 0===t?void 0:t.testDeviceTransport)&&void 0!==n?n:yield function(e,t=exports.RequestedBrowserTransport.CHROME_EXTENSION,n){return l(this,void 0,void 0,(function*(){return new((yield Promise.resolve().then((function(){return to})).catch((()=>{throw new Dt("Failed to dynamically import file. Please contact a Jabra representative as we would love to learn about scenarios where this could happen!",exports.ErrorType.UNEXPECTED_ERROR)}))).TransportNode)(e,n)}))}(o,null==e?void 0:e.transport,null===(r=null==e?void 0:e.internal)||void 0===r?void 0:r.recorder);new Mt(s,o);const a=sr.create(s,o),c=new Gt(a,s,e);return yield s.connect(),c}))},exports.webHidPairing=function(){return l(this,void 0,void 0,(function*(){const{hid:e}=window.navigator;if(!e)throw new Dt("WebHID not supported",exports.ErrorType.INIT_ERROR);const t=yield e.requestDevice({filters:[{vendorId:$n.VENDOR_ID}]});return new BroadcastChannel($n.PAIRING_CHANNEL).postMessage(null),t}))};
